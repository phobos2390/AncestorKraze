var Model;
(function(m){(function(e){(function(e){var h=m.Generator.Definitions.Graph,d=m.Generator.Definitions.Tree,c=m.Generator.Definitions.NumberOfBranchesStrategy,b=m.Generator.Definitions.InitializingState,a=m.Generator.Definitions.NewBranchState,g=m.Generator.Definitions.NewLeafState,f=m.Generator.Definitions.RandomizedPopulator,l=function(){function l(a,f){this.factory=a;this.numberOfKeys=f}l.prototype.setCurrentState=function(a){this.currentState=a};l.prototype.setToInitial=function(a){this.currentIter=this.rootTree=
new d(a)};l.prototype.addChildToTreeGettingGenerated=function(a){this.currentIter.addChild(new d(a))};l.prototype.spacesAreEqual=function(a,f){return a.getX()==f.getX()&&a.getY()==f.getY()};l.prototype.setIteratorToData=function(a){this.currentIter=this.findData(this.rootTree,a)};l.prototype.getIteratorData=function(){return this.currentIter.getData()};l.prototype.getNumberOfIteratorChildren=function(){return this.currentIter.getChildren().length};l.prototype.getTotalNumberOfBranches=function(){var a=
new c;a.traverse(this.rootTree);return a.getBranches()};l.prototype.getNumberOfBranchesBelow=function(a){this.setIteratorToData(a);a=new c;a.traverse(this.currentIter);return a.getBranches()};l.prototype.getNumberOfBranchesAboveNode=function(a){a=0;for(var f=this.currentIter;null!=f;)1<f.getChildren().length&&a++,f=f.getParent();return a};l.prototype.getNumberOfMarked=function(a){for(var f=0,b=0;b<a.length;b++)a[b].isMarked()&&f++;return f};l.prototype.moveUpToStartOfBranch=function(){for(var a=this.currentIter;null!=
a&&2>a.getChildren().length-this.getNumberOfMarked(a.getChildren());)this.currentIter.getData(),this.currentIter=a,a=a.getParent()};l.prototype.moveIteratorUp=function(a){null!=this.currentIter&&0<a&&(this.currentIter=this.currentIter.getParent(),this.moveIteratorUp(a-1))};l.prototype.findData=function(a,f){if(this.spacesAreEqual(a.getData(),f))return a;for(var b=a.getChildren(),g=0;g<b.length;g++){var l=b[g];if(this.spacesAreEqual(l.getData(),f))return l;l=this.findData(l,f);if(null!=l)return l}return null};
l.prototype.visit=function(a){this.currentState.read(a)};l.prototype.createRandomSpanningTree=function(){var f=new g(this,null),l=new b(this,f),c=new a(this,f);f.setNextState(c);this.currentState=l;this.rootTree=new d(this.factory.createSpace(0,0));this.graph.traverse(this);return this.rootTree};l.prototype.setSize=function(a,f){this.height=a;this.width=f;this.graphHeight=(a-1)/2;this.graphWidth=(f-1)/2;this.positions=[];for(var b=0;b<this.graphHeight;b++){this.positions.push([]);for(var g=0;g<this.graphWidth;g++){var l=
this.factory.createSpace(2*b+1,2*g+1);this.positions[b].push(l)}}};l.prototype.createGraph=function(){this.graph=new h;this.edges=[];for(var a=0;a<this.positions.length;a++)for(var f=0;f<this.positions[a].length;f++){this.graph.addNode(this.positions[a][f]);for(var b=this.positions[a][f],g=0;2>g;g++){var l=2*g-1,c=a+l,l=f+l,n=0<=c&&c<this.graphHeight,d=!1;n?this.graph.setAdjacent(b,this.positions[c][f]):d=!0;(n=0<=l&&l<this.graphWidth)?this.graph.setAdjacent(b,this.positions[a][l]):d=!0;d&&this.edges.push(b)}}return this.graph};
l.prototype.recCreateFromTree=function(a,f){for(var b=f,g=a.getChildren(),l=a.getData(),c=0;c<g.length;c++){var n=g[c].getData();b.setEmpty(this.factory.createSpace((l.getX()+n.getX())/2,(l.getY()+n.getY())/2));b=this.recCreateFromTree(g[c],b)}return b};l.prototype.markCurrentIterator=function(){this.currentIter.mark()};l.prototype.initializeKeyList=function(a){a.addEmptyToStack();a.addEmptyToStack();for(var f=0;f<this.numberOfKeys;f++)a.addKeyAndDoorPairToStack(this.factory.createKeyParams(f+1),
this.factory.createDoorParams(f+1))};l.prototype.getNumberOfKeys=function(){return this.numberOfKeys};l.prototype.getFactory=function(){return this.factory};l.prototype.getAverageNumberOfBranches=function(a,f,b){this.setSize(a,f);this.createGraph();for(f=a=0;f<b;f++){this.createRandomSpanningTree();var g=this.getTotalNumberOfBranches();console.log("Branches: "+g);a+=g}return a/b};l.prototype.createMaze=function(a,b){var g=this.factory.createBuilder();g.setHeight(a).setWidth(b);g.setBaseFilledPattern(this.factory.createSpace(0,
0),b,a);this.setSize(a,b);this.createGraph();for(var l=this.createRandomSpanningTree(),c=this.getTotalNumberOfBranches(),n=this.factory.createSpace(a-2,b-2),d=this.getNumberOfBranchesBelow(n);c-d+1<this.numberOfKeys+3;)console.log("Not enough branches! We have only "+c+" branches"),l=this.createRandomSpanningTree(),c=this.getTotalNumberOfBranches();g=this.recCreateFromTree(l,g);this.initializeKeyList(g);g.setExit(this.factory.createSpace(a-2,b-1));this.setIteratorToData(n);this.moveUpToStartOfBranch();
c=this.getIteratorData();this.markCurrentIterator();this.moveIteratorUp(1);n=this.getIteratorData();g.setDoorBetweenTwoSpaces(c,n,g.peek());g.pop();for(c=new f(this,g);!g.peek().objectIsOfType("BlankSpace");)l.traverse(c);g.setPlayer(this.factory.createSpace(1,1),this.factory.createPlayer());return g.build()};return l}();e.StandardMazeCreator=l})(e.Definitions||(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));var __extends=this.__extends||function(m,e){function k(){this.constructor=m}for(var h in e)e.hasOwnProperty(h)&&(m[h]=e[h]);k.prototype=e.prototype;m.prototype=new k};
(function(m){(function(e){(function(e){var h=function(d){function c(b,a){d.call(this,b,a);this.keys=[]}__extends(c,d);c.prototype.addKey=function(b){this.keys.push(b)};c.prototype.initializeKeyList=function(b){b.addEmptyToStack();b.addEmptyToStack();for(var a=0;a<this.getNumberOfKeys();a++)b.addKeyAndDoorPairToStack(this.getFactory().createKeyParams(this.keys[a]),this.getFactory().createDoorParams(this.keys[a]))};return c}(m.Generator.Definitions.StandardMazeCreator);e.AncestorMazeCreator=h})(e.Definitions||
(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.data=c;this.parent=null;this.marked=!1;this.subTree=[];this.minDepth=4}d.prototype.mark=function(){this.marked=!0};d.prototype.unmark=function(){this.marked=!1};d.prototype.isMarked=function(){return this.marked};d.prototype.getParent=function(){return this.parent};d.prototype.getData=function(){return this.data};d.prototype.setData=function(c){this.data=c};d.prototype.getChild=function(c){return this.subTree[c]};d.prototype.getChildren=
function(){return this.subTree};d.prototype.addChild=function(c){this.subTree.push(c);c.parent=this};d.prototype.traverse=function(c){this.recTraverse(c,0)};d.prototype.recTraverse=function(c,b){for(var a=[],g=0;g<this.subTree.length;g++)this.subTree[g].isMarked()||a.push(this.subTree[g]);g=a.length;g=Math.floor(Math.random()*g);0==this.subTree.length||0==a.length?c.visit(this.data):this.marked&&null!=this.parent?c.visit(this.data):a[g].recTraverse(c,b+1)};return d}();e.Tree=h})(e.Definitions||(e.Definitions=
{}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.branches=1}d.prototype.traverse=function(c){c=c.getChildren();var b=c.length;this.visit(b);for(var a=0;a<b;a++){var g=c[a];g.isMarked()||this.traverse(g)}};d.prototype.visit=function(c){0<c&&(this.branches+=c-1)};d.prototype.getBranches=function(){return this.branches};return d}();e.NumberOfBranchesStrategy=h})(e.Definitions||(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c,b){this.creator=c;this.builder=b}d.prototype.visit=function(c){this.builder.setKey(c,this.builder.peek());this.builder.pop();this.creator.setIteratorToData(c);this.creator.moveUpToStartOfBranch();c=this.creator.getIteratorData();this.creator.markCurrentIterator();this.creator.moveIteratorUp(1);var b=this.creator.getIteratorData();this.builder.setDoorBetweenTwoSpaces(c,b,this.builder.peek());this.builder.pop()};return d}();e.RandomizedPopulator=
h})(e.Definitions||(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.dict={};this.nodes=[]}d.prototype.addNode=function(c){this.nodes.push(c);this.dict[c.toString()]=[]};d.prototype.setAdjacent=function(c,b){this.dict[c.toString()].push(b)};d.prototype.getAdjacencies=function(c){return this.dict[c.toString()]};d.prototype.traverse=function(c){for(var b=[],a=0;a<this.nodes.length;a++)b.push(!1);for(var g=0,f=this.nodes[g];-1!=b.indexOf(!1);){c.visit(f);b[g]=!0;for(var l=this.dict[f],n=[],d=[],
a=0;a<l.length;a++){var e=l[a],k=this.nodes.indexOf(e);b[k]?d.push(e):n.push(e)}a=n.length;if(1<a)0<d.length&&c.visit(f),g=Math.floor(Math.random()*a),g=this.nodes.indexOf(n[g]),f=this.nodes[g];else if(0<a)c.visit(f),g=this.nodes.indexOf(n[0]),f=this.nodes[g];else if(-1!=b.indexOf(!1)){g=b.indexOf(!1);f=this.nodes[g];l=this.dict[f];n=[];d=[];for(a=0;a<l.length;a++)e=l[a],k=this.nodes.indexOf(e),b[k]?d.push(e):n.push(e);c.visit(d[0])}}};return d}();e.Graph=h})(e.Definitions||(e.Definitions={}))})(m.Generator||
(m.Generator={}))})(Model||(Model={}));__extends=this.__extends||function(m,e){function k(){this.constructor=m}for(var h in e)e.hasOwnProperty(h)&&(m[h]=e[h]);k.prototype=e.prototype;m.prototype=new k};
(function(m){(function(e){(function(e){var h=function(d){function c(b,a){d.call(this,b,a)}__extends(c,d);c.prototype.read=function(b){d.prototype.getCreator.call(this).setToInitial(b);d.prototype.advanceCreatorToNextState.call(this)};return c}(m.Generator.Definitions.AbstractTreeTraversalState);e.InitializingState=h})(e.Definitions||(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));__extends=this.__extends||function(m,e){function k(){this.constructor=m}for(var h in e)e.hasOwnProperty(h)&&(m[h]=e[h]);k.prototype=e.prototype;m.prototype=new k};
(function(m){(function(e){(function(e){var h=function(d){function c(b,a){d.call(this,b,a)}__extends(c,d);c.prototype.read=function(b){d.prototype.getCreator.call(this).setIteratorToData(b);d.prototype.advanceCreatorToNextState.call(this)};return c}(m.Generator.Definitions.AbstractTreeTraversalState);e.NewBranchState=h})(e.Definitions||(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));__extends=this.__extends||function(m,e){function k(){this.constructor=m}for(var h in e)e.hasOwnProperty(h)&&(m[h]=e[h]);k.prototype=e.prototype;m.prototype=new k};
(function(m){(function(e){(function(e){var h=function(d){function c(b,a){d.call(this,b,a)}__extends(c,d);c.prototype.read=function(b){d.prototype.getCreator.call(this).addChildToTreeGettingGenerated(b);d.prototype.advanceCreatorToNextState.call(this)};return c}(m.Generator.Definitions.AbstractTreeTraversalState);e.NewLeafState=h})(e.Definitions||(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c,b){this.creator=c;this.nextState=b}d.prototype.setNextState=function(c){this.nextState=c};d.prototype.advanceCreatorToNextState=function(){this.creator.setCurrentState(this.nextState)};d.prototype.getCreator=function(){return this.creator};d.prototype.read=function(c){throw Error("This method is abstract");};return d}();e.AbstractTreeTraversalState=h})(e.Definitions||(e.Definitions={}))})(m.Generator||(m.Generator={}))})(Model||
(Model={}));(function(m){(function(e){(function(e){var h=m.Definitions.FamilyHistory.AncestorDoor,d=m.Definitions.FamilyHistory.AncestorBuilder,c=m.Definitions.Standard.StandardFactory,b=function(){function a(){this.factory=new c}a.prototype.createKey=function(a){return new e.AncestorName(a.getName())};a.prototype.createPlayer=function(){return new e.AncestorPlayer};a.prototype.createDoor=function(a){return new h(a.getRequirement())};a.prototype.createEmptySpace=function(){return this.factory.createEmptySpace()};
a.prototype.createSpace=function(a,f){return this.factory.createSpace(a,f)};a.prototype.createRequirement=function(a){a=a.getAncestorNameParams();return new e.AncestorNameRequirement(a,this)};a.prototype.createBuilder=function(){return new d(this)};a.prototype.createWinSpace=function(){return this.factory.createWinSpace()};a.prototype.createWallSpace=function(){return this.factory.createWallSpace()};a.prototype.createMove=function(a){return this.factory.createMove(a)};a.prototype.createKeyParams=
function(a){return new e.AncestorNameParams(a)};a.prototype.createDoorParams=function(a){return new e.AncestorDoorParams(a)};a.prototype.createRequirementParams=function(a){return new e.AncestorRequirementParams(a)};return a}();e.AncestorFactory=b})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.requirement=c;this.doorString="IDoor"}d.prototype.getRequirement=function(){return this.requirement};d.prototype.canEnterSpace=function(){return!0};d.prototype.getSpaceType=function(){return this.getRequirement().toString().replace(/ /g,"")};d.prototype.objectIsOfType=function(c){return c.valueOf()==this.doorString.valueOf()||c.valueOf()==this.getRequirement().toString().valueOf()};return d}();e.AncestorDoor=h})(e.FamilyHistory||
(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c,b){this.ancestorName=c;this.factory=b}d.prototype.playerFulfillsRequirement=function(c){return c.hasKey(this.factory.createKey(this.factory.createKeyParams(this.ancestorName)))};d.prototype.toString=function(){return this.ancestorName};return d}();e.AncestorNameRequirement=h})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.name=c}d.prototype.canEnterSpace=function(){return!0};d.prototype.getSpaceType=function(){return"IKey"};d.prototype.objectIsOfType=function(c){return c.valueOf()==this.name.valueOf()||c.valueOf()==this.getSpaceType().valueOf()};d.prototype.toString=function(){return this.name};return d}();e.AncestorName=h})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.factory=new e.AncestorFactory;this.ancestorName=c;this.params=this.factory.createRequirementParams(this.ancestorName)}d.prototype.getRequirement=function(){return this.factory.createRequirement(this.params)};return d}();e.AncestorDoorParams=h})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.keys=[]}d.prototype.fulfillsRequirement=function(c){return c.playerFulfillsRequirement(this)};d.prototype.addKey=function(c){this.keys.push(c)};d.prototype.hasKey=function(c){for(var b=0;b<this.keys.length;b++)if(this.keys[b].objectIsOfType(c.toString()))return!0;return!1};d.prototype.numberOfKeys=function(){return this.keys.length};return d}();e.AncestorPlayer=h})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions=
{}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=m.Definitions.Standard.StandardModelBuilder,d=m.Definitions.FamilyHistory.AncestorModel,c=function(){function b(a){this.factory=a;this.base=new h(this.factory)}b.prototype.setHeight=function(a){return this.base.setHeight(a)};b.prototype.setWidth=function(a){return this.base.setWidth(a)};b.prototype.setWall=function(a){return this.base.setWall(a)};b.prototype.setKey=function(a,b){return this.base.setKey(a,b)};b.prototype.setDoor=function(a,b){return this.base.setDoor(a,
b)};b.prototype.setExit=function(a){return this.base.setExit(a)};b.prototype.setEmpty=function(a){return this.base.setEmpty(a)};b.prototype.setWalls=function(a,b,f){return this.base.setWalls(a,b,f)};b.prototype.setEmpties=function(a,b,f){return this.base.setEmpties(a,b,f)};b.prototype.setWallsAroundSpace=function(a,b,f){return this.base.setWallsAroundSpace(a,b,f)};b.prototype.setBaseFilledPattern=function(a,b,f){return this.base.setBaseFilledPattern(a,b,f)};b.prototype.setDoorBetweenTwoSpaces=function(a,
b,f){return this.base.setDoorBetweenTwoSpaces(a,b,f)};b.prototype.setPlayer=function(a,b){return this.base.setPlayer(a,b)};b.prototype.peek=function(){return this.base.peek()};b.prototype.pop=function(){return this.base.pop()};b.prototype.setInitialDoor=function(a){return this.base.setInitialDoor(a)};b.prototype.addKeyAndDoorPairToStack=function(a,b){return this.base.addKeyAndDoorPairToStack(a,b)};b.prototype.addEmptyToStack=function(){return this.base.addEmptyToStack()};b.prototype.build=function(){return new d(this.base.getSpaces(),
this.base.getPlayerSpace(),this.base.getPlayer(),this.factory)};return b}();e.AncestorBuilder=c})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=m.Definitions.Standard.StandardModel,d=function(){function c(b,a,g,f){this.factory=f;this.baseModel=new h(b,a,g,this.factory);this.playerSpace=a}c.prototype.getSpace=function(b,a){return this.baseModel.getSpace(b,a)};c.prototype.movePlayer=function(b){this.baseModel.movePlayer(b)};c.prototype.canMovePlayer=function(b){return this.baseModel.canMovePlayer(b)};c.prototype.fulfillRequirement=function(b){};c.prototype.won=function(){return this.baseModel.won()};
c.prototype.getPlayer=function(){return this.baseModel.getPlayer()};c.prototype.getCurrentSpace=function(){return this.baseModel.getCurrentSpace()};c.prototype.getObjectInSpace=function(b,a){return this.baseModel.getObjectInSpace(b,a)};c.prototype.registerObserver=function(b){this.baseModel.registerObserver(b)};c.prototype.update=function(){this.baseModel.update()};c.prototype.pickedUpNewKey=function(){return this.baseModel.pickedUpNewKey()};c.prototype.newKey=function(){return this.baseModel.newKey()};
c.prototype.attemptedToGetInADoor=function(){return this.baseModel.attemptedToGetInADoor()};c.prototype.doorRequirement=function(){return this.baseModel.doorRequirement()};return c}();e.AncestorModel=d})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.name=c}d.prototype.getName=function(){return this.name};return d}();e.AncestorNameParams=h})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.name=c}d.prototype.getAncestorNameParams=function(){return this.name};return d}();e.AncestorRequirementParams=h})(e.FamilyHistory||(e.FamilyHistory={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.factory=c;this.spaces=null;this.sizeSet=this.widthSet=this.heightSet=!1;this.width=this.height=0;this.keyAndDoorStack=[]}d.prototype.createBoard=function(){if(this.heightSet&&this.widthSet){this.spaces=[];for(var c=0;c<this.height;c++){for(var b=[],a=0;a<this.width;a++)b.push(this.factory.createSpace(c,a));this.spaces.push(b)}this.sizeSet=!0}};d.prototype.setHeight=function(c){this.height=c;this.heightSet=!0;this.createBoard();
return this};d.prototype.setWidth=function(c){this.width=c;this.widthSet=!0;this.createBoard();return this};d.prototype.addSpace=function(c){this.sizeSet&&(this.spaces[c.getX()][c.getY()]=c)};d.prototype.setWall=function(c){c.setSpaceObject(this.factory.createWallSpace());this.addSpace(c);return this};d.prototype.setKey=function(c,b){c.setSpaceObject(b);this.addSpace(c);return this};d.prototype.setDoor=function(c,b){c.setSpaceObject(b);this.addSpace(c);return this};d.prototype.setExit=function(c){c.setSpaceObject(this.factory.createWinSpace());
this.addSpace(c);return this};d.prototype.setEmpty=function(c){c.setSpaceObject(this.factory.createEmptySpace());this.addSpace(c);return this};d.prototype.setWalls=function(c,b,a){for(var g=0;g<b;g++)for(var f=0;f<a;f++){var l=c.getX()+g,n=c.getY()+f,l=this.factory.createSpace(l,n);this.setWall(l)}return this};d.prototype.setEmpties=function(c,b,a){for(var g=0;g<b;g++)for(var f=0;f<a;f++){var l=c.getX()+g,n=c.getY()+f,l=this.factory.createSpace(l,n);this.setEmpty(l)}return this};d.prototype.setWallsAroundSpace=
function(c,b,a){var g=this.factory.createSpace(c.getX()+b-1,c.getY()),f=this.factory.createSpace(c.getX(),c.getY()+a-1);this.setWalls(c,1,a);this.setWalls(c,b,1);this.setWalls(f,b,1);this.setWalls(g,1,a);return this};d.prototype.setBaseFilledPattern=function(c,b,a){for(var g=!0,f=!0,l=0;l<a;l++){for(var n=0;n<b;n++){var d=c.getX()+l,e=c.getY()+n,d=this.factory.createSpace(d,e);g||f?this.setWall(d):this.setEmpty(d);f=!f||g}g=!g}return this};d.prototype.setDoorBetweenTwoSpaces=function(c,b,a){this.setDoor(this.factory.createSpace((c.getX()+
b.getX())/2,(c.getY()+b.getY())/2),a);return this};d.prototype.setPlayer=function(c,b){this.player=b;this.playerSpace=c;return this};d.prototype.peek=function(){return this.keyAndDoorStack[this.keyAndDoorStack.length-1]};d.prototype.pop=function(){return this.keyAndDoorStack.pop()};d.prototype.setInitialDoor=function(c){this.keyAndDoorStack.push(this.factory.createDoor(c));return this};d.prototype.addKeyAndDoorPairToStack=function(c,b){this.keyAndDoorStack.push(this.factory.createKey(c));this.keyAndDoorStack.push(this.factory.createDoor(b));
return this};d.prototype.addEmptyToStack=function(){this.keyAndDoorStack.push(this.factory.createEmptySpace());return this};d.prototype.build=function(){return new e.StandardModel(this.spaces,this.playerSpace,this.player,this.factory)};d.prototype.getSpaces=function(){return this.spaces};d.prototype.getPlayerSpace=function(){return this.playerSpace};d.prototype.getPlayer=function(){return this.player};return d}();e.StandardModelBuilder=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions=
{}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=m.Definitions.Standard.StandardKey,d=m.Definitions.Standard.StandardPlayer,c=m.Definitions.Standard.StandardDoor,b=m.Definitions.Standard.StandardSpace,a=m.Definitions.Standard.StandardRequirement,g=m.Definitions.Standard.StandardModelBuilder,f=m.Definitions.Standard.StandardWinObject,l=m.Definitions.Standard.StandardWall,n=m.Definitions.Standard.StandardMove,r=m.Definitions.Standard.StandardKeyParams,q=m.Definitions.Standard.StandardDoorParams,u=m.Definitions.Standard.StandardRequirementParams,
p=m.Definitions.Standard.StandardEmptySpace,t=function(){function e(){}e.prototype.createKey=function(a){return new h};e.prototype.createPlayer=function(){return new d};e.prototype.createDoor=function(a){return new c(a.getRequirement())};e.prototype.createSpace=function(a,f){return new b(a,f)};e.prototype.createRequirement=function(f){return new a(f.getNumberOfKeys())};e.prototype.createBuilder=function(){return new g(this)};e.prototype.createWinSpace=function(){return new f};e.prototype.createWallSpace=
function(){return new l};e.prototype.createEmptySpace=function(){return new p};e.prototype.createMove=function(a){var f=0,b=0;"up"==a?(b=0,f=-1):"down"==a?(b=0,f=1):"left"==a?(b=-1,f=0):"right"==a?(b=1,f=0):b=f=0;return new n(f,b)};e.prototype.createKeyParams=function(a){return new r};e.prototype.createDoorParams=function(a){return new q(a,this)};e.prototype.createRequirementParams=function(a){return new u(a)};return e}();e.StandardFactory=t})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions=
{}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){return function(){}}();e.StandardKeyParams=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.wallString="IWallObject"}d.prototype.canEnterSpace=function(){return!1};d.prototype.getSpaceType=function(){return this.wallString};d.prototype.objectIsOfType=function(c){return this.wallString.valueOf()==c.valueOf()};return d}();e.StandardWall=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.numberOfKeys=c}d.prototype.playerFulfillsRequirement=function(c){return c.numberOfKeys()>=this.numberOfKeys};d.prototype.toString=function(){return this.numberOfKeys.toString()};return d}();e.StandardRequirement=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.winString="IWinSpaceObject"}d.prototype.canEnterSpace=function(){return!0};d.prototype.getSpaceType=function(){return this.winString};d.prototype.objectIsOfType=function(c){return this.winString.valueOf()==c.valueOf()};return d}();e.StandardWinObject=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=m.Definitions.Standard.StandardEmptySpace,d=function(){function c(b,a){this.x=b;this.y=a;this.spaceObject=new h;this.hasBeenSeen=!1}c.prototype.getX=function(){return this.x};c.prototype.getY=function(){return this.y};c.prototype.setSpaceObject=function(b){this.spaceObject=b};c.prototype.getSpaceObject=function(){return this.spaceObject};c.prototype.canEnterSpace=function(){return this.spaceObject.canEnterSpace()};c.prototype.toString=function(){return"("+
this.getX()+","+this.getY()+")"};c.prototype.setSeen=function(){this.hasBeenSeen=!0};c.prototype.seen=function(){return this.hasBeenSeen};return c}();e.StandardSpace=d})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.keys=0}d.prototype.fulfillsRequirement=function(c){return c.playerFulfillsRequirement(this)};d.prototype.addKey=function(c){this.keys++};d.prototype.hasKey=function(c){return!0};d.prototype.numberOfKeys=function(){return this.keys};return d}();e.StandardPlayer=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.numberOfKeys=c}d.prototype.getNumberOfKeys=function(){return this.numberOfKeys};return d}();e.StandardRequirementParams=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c){this.requirement=c;this.doorString="IDoor"}d.prototype.getRequirement=function(){return this.requirement};d.prototype.canEnterSpace=function(){return!0};d.prototype.getSpaceType=function(){return"Door"+this.getRequirement().toString()};d.prototype.objectIsOfType=function(c){return c.valueOf()==this.doorString.valueOf()||c.valueOf()==this.getRequirement().toString().valueOf()};return d}();e.StandardDoor=h})(e.Standard||(e.Standard=
{}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c,b){this.numberOfKeys=c;this.factory=b;this.params=this.factory.createRequirementParams(this.numberOfKeys)}d.prototype.getRequirement=function(){return this.factory.createRequirement(this.params)};return d}();e.StandardDoorParams=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.keyString="IKey"}d.prototype.canEnterSpace=function(){return!0};d.prototype.getSpaceType=function(){return this.keyString};d.prototype.objectIsOfType=function(c){return this.keyString.valueOf()==c.valueOf()};d.prototype.toString=function(){return this.keyString};return d}();e.StandardKey=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c,b,a,g){this.observers=[];this.spaces=c;this.hasWon=!1;this.playerSpace=b;this.player=a;this.factory=g}d.prototype.getSpace=function(c,b){return 0<=c&&c<this.spaces.length&&0<=b&&b<this.spaces[c].length?this.spaces[c][b]:null};d.prototype.offsetSpace=function(c,b){return this.factory.createSpace(c.getDeltaX()+b.getX(),c.getDeltaY()+b.getY())};d.prototype.moveSpace=function(c){c=this.offsetSpace(c,this.playerSpace);return c=this.getSpace(c.getX(),
c.getY())};d.prototype.movePlayer=function(c){var b=this.moveSpace(c),a=b.getSpaceObject();a.objectIsOfType("IKey")?(this.pickedUpKey=!0,this.key=a,this.update(),this.pickedUpKey=!1,b.setSpaceObject(this.factory.createEmptySpace())):a.objectIsOfType("IWinSpaceObject")&&(this.hasWon=!0);this.setSeenAlongFaceDir(c,b.getX(),b.getY());this.setSeenNAwayFromPath(2,b.getX(),b.getY());this.playerSpace=b;this.update()};d.prototype.setSeenAlongFaceDir=function(c,b,a){var g=this.getSpace(b,a);if(0!=c.getDeltaX()||
0!=c.getDeltaY())for(;null!=g;)g.getSpaceObject().objectIsOfType("BlankSpace")?(this.setSeenAroundSpace(b,a),b+=c.getDeltaX(),a+=c.getDeltaY(),g=this.getSpace(b,a)):(g.setSeen(),g=null)};d.prototype.setSeenAroundSpace=function(c,b){for(var a=0;3>a;a++)for(var g=0;3>g;g++){var f=this.getSpace(a-1+c,g-1+b);null!=f&&f.setSeen()}};d.prototype.setSeenNAwayFromPath=function(c,b,a){if(0<c)for(var g=0;2>g;g++){var f=2*g-1,l=f+b,f=f+a,n=this.getSpace(l,a),d=this.getSpace(b,f);null!=n&&n.getSpaceObject().objectIsOfType("BlankSpace")&&
(this.setSeenAroundSpace(l,a),this.setSeenNAwayFromPath(c-1,l,a));null!=d&&d.getSpaceObject().objectIsOfType("BlankSpace")&&(this.setSeenAroundSpace(b,f),this.setSeenNAwayFromPath(c-1,b,f))}};d.prototype.canMovePlayer=function(c){c=this.moveSpace(c);c.getSpaceObject().objectIsOfType("IDoor")?(this.requirement=c.getSpaceObject().getRequirement(),this.triedToGetInDoor=!0,this.update(),this.triedToGetInDoor=!1,c=this.player.fulfillsRequirement(this.requirement)):c=c.getSpaceObject().canEnterSpace();
return c&&!this.hasWon};d.prototype.fulfillRequirement=function(c){};d.prototype.won=function(){return this.hasWon};d.prototype.getPlayer=function(){return this.player};d.prototype.getCurrentSpace=function(){return this.playerSpace};d.prototype.getObjectInSpace=function(c,b){return this.getSpace(c,b).getSpaceObject()};d.prototype.registerObserver=function(c){this.observers.push(c)};d.prototype.update=function(){for(var c=0;c<this.observers.length;c++)this.observers[c].update(this)};d.prototype.pickedUpNewKey=
function(){return this.pickedUpKey};d.prototype.newKey=function(){return this.key};d.prototype.attemptedToGetInADoor=function(){return this.triedToGetInDoor};d.prototype.doorRequirement=function(){return this.requirement};return d}();e.StandardModel=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(){this.type="BlankSpace"}d.prototype.canEnterSpace=function(){return!0};d.prototype.getSpaceType=function(){return this.type};d.prototype.objectIsOfType=function(c){return this.type.valueOf()==c.valueOf()};return d}();e.StandardEmptySpace=h})(e.Standard||(e.Standard={}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));(function(m){(function(e){(function(e){var h=function(){function d(c,b){this.deltaX=c;this.deltaY=b;this.directions=["up","left","none","right","down"];var a=this.getDXY()+2;this.moveDirection=this.directions[a]}d.prototype.getDeltaX=function(){return this.deltaX};d.prototype.getDeltaY=function(){return this.deltaY};d.prototype.getDXY=function(){return 2*this.deltaX+this.deltaY};d.prototype.getMoveString=function(){return this.moveDirection};return d}();e.StandardMove=h})(e.Standard||(e.Standard=
{}))})(m.Definitions||(m.Definitions={}))})(Model||(Model={}));var StandardFactory=Model.Definitions.Standard.StandardFactory,ModelFacade=function(){function m(){this.factory=new StandardFactory;this.model=null}m.prototype.getModel=function(){return this.model};m.prototype.setModel=function(e){this.model=e};m.prototype.getFactory=function(){return this.factory};m.prototype.setFactory=function(e){this.factory=e};return m}();!function(m){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=m();else if("function"==typeof define&&define.amd)define([],m);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.FamilySearch=m()}}(function(){return function e(k,h,d){function c(a,f){if(!h[a]){if(!k[a]){var l="function"==typeof require&&require;if(!f&&l)return l(a,!0);if(b)return b(a,!0);l=Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",
l;}l=h[a]={exports:{}};k[a][0].call(l.exports,function(f){var b=k[a][1][f];return c(b?b:f)},l,l.exports,e,k,h,d)}return h[a].exports}for(var b="function"==typeof require&&require,a=0;a<d.length;a++)c(d[a]);return c}({1:[function(e,k,h){function d(a,f){q.prototype[f]=function(){return this[a][f].apply(this[a],arguments)}}var c=e("./globals"),b=e("./utils"),a=e("./angularjs-wrappers"),g=e("./jquery-wrappers"),f=e("./nodejs-wrappers"),l=e("./helpers"),n=e("./plumbing"),r=0,q=k.exports=function(d){var e=
this;if(e.settings=b.extend(e.settings,c),e.settings.instanceId=++r,e.helpers=new l(e),e.plumbing=new n(e),d=d||{},!d.client_id&&!d.app_key)throw"client_id must be set";if(e.settings.clientId=d.client_id||d.app_key,!d.environment)throw"environment must be set";if(e.settings.environment=d.environment,!d.http_function&&!window.jQuery)throw"http must be set; e.g., jQuery.ajax";var q=d.http_function||window.jQuery.ajax;if(e.settings.httpWrapper=q.pendingRequests?a.httpWrapper(q,e):q.cookie?f.httpWrapper(q,
e):g.httpWrapper(q,e),!d.deferred_function&&!window.jQuery)throw"deferred_function must be set; e.g., jQuery.Deferred";var q=d.deferred_function||window.jQuery.Deferred,h=q();h.resolve();e.settings.deferredWrapper=b.isFunction(h.promise)?g.deferredWrapper(q):b.isFunction(q.nfcall)?f.deferredWrapper(q):a.deferredWrapper(q);var k=d.timeout_function;k?(e.settings.setTimeout=function(a,f){return k(a,f)},e.settings.clearTimeout=function(a){k.cancel(a)}):(e.settings.setTimeout=function(a,f){return setTimeout(a,
f)},e.settings.clearTimeout=function(a){clearTimeout(a)});e.settings.redirectUri=d.redirect_uri||d.auth_callback;e.settings.autoSignin=d.auto_signin;e.settings.autoExpire=d.auto_expire;e.settings.expireCallback=d.expire_callback;d.save_access_token&&(e.settings.saveAccessToken=!0,e.helpers.readAccessToken());d.access_token&&(e.settings.accessToken=d.access_token);e.settings.debug=d.debug;e.settings.discoveryPromise=e.plumbing.get(e.settings.discoveryUrl);e.settings.discoveryPromise.then(function(a){e.settings.discoveryResource=
a})};e("./modules/authorities");e("./modules/authentication");e("./modules/changeHistory");e("./modules/discussions");e("./modules/memories");e("./modules/notes");e("./modules/parentsAndChildren");e("./modules/pedigree");e("./modules/persons");e("./modules/redirect");e("./modules/searchAndMatch");e("./modules/sourceBox");e("./modules/sources");e("./modules/spouses");e("./modules/users");e("./classes/base");e("./classes/agent");e("./classes/attribution");e("./classes/change");e("./classes/childAndParents");
e("./classes/collection");e("./classes/comment");e("./classes/couple");e("./classes/date");e("./classes/discussion");e("./classes/discussionRef");e("./classes/fact");e("./classes/memoryArtifactRef");e("./classes/memoryPersona");e("./classes/memoryPersonaRef");e("./classes/memory");e("./classes/name");e("./classes/note");e("./classes/person");e("./classes/place");e("./classes/searchResult");e("./classes/sourceDescription");e("./classes/sourceRef");e("./classes/user");d("plumbing","del");d("plumbing",
"get");d("plumbing","getTotalProcessingTime");d("plumbing","getUrl");d("plumbing","http");d("plumbing","post");d("plumbing","put");d("plumbing","setTotalProcessingTime")},{"./angularjs-wrappers":2,"./classes/agent":3,"./classes/attribution":4,"./classes/base":5,"./classes/change":6,"./classes/childAndParents":7,"./classes/collection":8,"./classes/comment":9,"./classes/couple":10,"./classes/date":11,"./classes/discussion":12,"./classes/discussionRef":13,"./classes/fact":14,"./classes/memory":15,"./classes/memoryArtifactRef":16,
"./classes/memoryPersona":17,"./classes/memoryPersonaRef":18,"./classes/name":19,"./classes/note":20,"./classes/person":21,"./classes/place":22,"./classes/searchResult":23,"./classes/sourceDescription":24,"./classes/sourceRef":25,"./classes/user":26,"./globals":27,"./helpers":28,"./jquery-wrappers":29,"./modules/authentication":30,"./modules/authorities":31,"./modules/changeHistory":32,"./modules/discussions":33,"./modules/memories":34,"./modules/notes":35,"./modules/parentsAndChildren":36,"./modules/pedigree":37,
"./modules/persons":38,"./modules/redirect":39,"./modules/searchAndMatch":40,"./modules/sourceBox":41,"./modules/sources":42,"./modules/spouses":43,"./modules/users":44,"./nodejs-wrappers":45,"./plumbing":46,"./utils":48}],2:[function(e,k,h){var d=e("./utils");h={httpWrapper:function(c,b){return function(a,g,f,l,n){var r=d.extend({method:a,url:g,responseType:"json",data:l,transformRequest:function(a){return a}},n);r.headers=d.extend({},f,n.headers);"multipart/form-data"===r.headers["Content-Type"]&&
(r.headers["Content-Type"]=void 0);a=c(r);var e=b.settings.deferredWrapper();g=e.promise;var h=null,p=null;return a.then(function(a){h=a.status;p=a.headers;e.resolve(a.data)},function(a){h=a.status;p=a.headers;e.reject(a)}),g.getStatusCode=function(){return h},g.getResponseHeader=function(a){return p(a)},g.getAllResponseHeaders=function(){return p()},g.getRequest=function(){return r},g}},deferredWrapper:function(c){return function(){var b=c();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}}};
k.exports=h},{"./utils":48}],3:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.Agent=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createAgent=function(a){return new b(this,a)};b.prototype={constructor:b,$getName:function(){return c(c(this.names)[0]).value},$getAccountName:function(){return c(c(this.accounts)[0]).accountName},$getEmail:function(){var a=c(c(this.emails)[0]).resource;return a?a.replace(/^mailto:/,""):a},$getPhoneNumber:function(){return c(c(this.phones)[0]).resource},
$getAddress:function(){return c(c(this.addresses)[0]).value}}},{"./../FamilySearch":1,"./../utils":48}],4:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Attribution=function(a,f){d.BaseClass.call(this,a,f);c.isString(f)&&(this.changeMessage=f)};d.prototype.createAttribution=function(b){return new a(this,b)};a.prototype={constructor:a,$getAgentId:function(){return b(this.contributor).resourceId},$getAgentUrl:function(){return this.$client.helpers.removeAccessToken(b(this.contributor).resource)},
$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())}}},{"./../FamilySearch":1,"./../utils":48}],5:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils");k.BaseClass=function(c,b){d.isObject(b)&&d.extend(this,b);this.$client=c;this.$helpers=c.helpers;this.$plumbing=c.plumbing;this.$serialize=function(){return JSON.stringify(this,function(a,b){return 0!==a.indexOf("$")?b:void 0})}}},{"./../FamilySearch":1,"./../utils":48}],6:[function(e,k,h){var d=e("./../FamilySearch"),
c=e("./../utils").maybe,b=d.Change=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createChange=function(a){return new b(this,a)};b.prototype={constructor:b,$getAgentName:function(){return c(c(this.contributors)[0]).name},$getChangeReason:function(){return c(c(this.changeInfo)[0]).reason},$getAgentUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links).agent).href)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl())},$restore:function(a){return this.$client.changeHistory.restoreChange(this.id,
a)}}},{"./../FamilySearch":1,"./../utils":48}],7:[function(e,k,h){var d=e("../FamilySearch"),c=e("../relationshipHelpers"),b=e("../utils"),a=b.maybe,g=d.ChildAndParents=function(a,g){d.BaseClass.call(this,a,g);g&&(g.$father&&(this.$setFather(g.$father),delete this.$father),g.$mother&&(this.$setMother(g.$mother),delete this.$mother),g.$child&&(this.$setChild(g.$child),delete this.$child),g.fatherFacts&&b.forEach(this.fatherFacts,function(b,g){b instanceof d.Fact||(this.fatherFacts[g]=a.createFact(b))},
this),g.motherFacts&&b.forEach(this.motherFacts,function(b,g){b instanceof d.Fact||(this.motherFacts[g]=a.createFact(b))},this))};d.prototype.createChildAndParents=function(a){return new g(this,a)};g.prototype={constructor:g,$getChildAndParentsUrl:function(){return this.$helpers.removeAccessToken(a(a(this.links).relationship).href)},$getFatherFacts:function(){return this.fatherFacts||[]},$getMotherFacts:function(){return this.motherFacts||[]},$getFatherId:function(){return a(this.father).resourceId},
$getFatherUrl:function(){return this.$helpers.removeAccessToken(a(this.father).resource)},$getFather:function(){return this.$client.getPerson(this.$getFatherUrl()||this.$getFatherId())},$getMotherId:function(){return a(this.mother).resourceId},$getMotherUrl:function(){return this.$helpers.removeAccessToken(a(this.mother).resource)},$getMother:function(){return this.$client.getPerson(this.$getMotherUrl()||this.$getMotherId())},$getChildId:function(){return a(this.child).resourceId},$getChildUrl:function(){return this.$helpers.removeAccessToken(a(this.child).resource)},
$getChild:function(){return this.$client.getPerson(this.$getChildUrl()||this.$getChildId())},$getNotes:function(){return this.$client.getChildAndParentsNotes(this.$helpers.removeAccessToken(a(a(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getChildAndParentsSourceRefs(this.id)},$getSources:function(){return this.$client.getChildAndParentsSourcesQuery(this.id)},$getChanges:function(){return this.$client.getChildAndParentsChanges(this.$helpers.removeAccessToken(a(this.links["change-history"]).href))},
$setFather:function(a){return c.setMember.call(this,"father",a),this.$fatherChanged=!0,this},$setMother:function(a){return c.setMember.call(this,"mother",a),this.$motherChanged=!0,this},$setChild:function(a){return c.setMember.call(this,"child",a),this},$deleteFather:function(a){return c.deleteMember.call(this,"father",a),this},$deleteMother:function(a){return c.deleteMember.call(this,"mother",a),this},$setFatherFacts:function(a,b){return c.setFacts.call(this,"fatherFacts",a,b),this},$addFatherFact:function(a){return c.addFact.call(this,
"fatherFacts",a),this},$deleteFatherFact:function(a,b){return c.deleteFact.call(this,"fatherFacts",a,b),this},$setMotherFacts:function(a,b){return c.setFacts.call(this,"motherFacts",a,b),this},$addMotherFact:function(a){return c.addFact.call(this,"motherFacts",a),this},$deleteMotherFact:function(a,b){return c.deleteFact.call(this,"motherFacts",a,b),this},$save:function(a,g,n){var d=this.$client.createChildAndParents(),e=!1,h=this.id,p=this;(!this.id||this.$fatherChanged)&&(d.father=this.father,e=
!0);(!this.id||this.$motherChanged)&&(d.mother=this.mother,e=!0);this.id||(d.child=this.child,e=!0);a&&(d.attribution=p.$client.createAttribution(a));b.forEach(["fatherFacts","motherFacts"],function(a){b.forEach(p[a],function(f){h&&f.id&&!f.$changed||(c.addFact.call(d,a,f),e=!0)})});var k=[];e&&k.push(p.$helpers.chainHttpPromises(h?p.$plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:h}):p.$plumbing.getUrl("relationships"),function(a){return b.forEach(["father","mother","child"],
function(a){d[a]&&!d[a].resource&&d[a].resourceId&&(d[a].resource=d[a].resourceId)}),p.$plumbing.post(a,{childAndParentsRelationships:[d]},{"Content-Type":"application/x-fs-v1+json"},n,p.$helpers.getResponseEntityId)}));b.forEach(["father","mother"],function(b){if(p.id&&p.$deletedMembers&&p.$deletedMembers.hasOwnProperty(b)&&!p[b]){var g=p.$deletedMembers[b]||a;k.push(p.$helpers.chainHttpPromises(p.$plumbing.getUrl("child-and-parents-relationship-parent-template",null,{caprid:h,role:b}),function(a){var f=
{"Content-Type":"application/x-fs-v1+json"};return g&&(f["X-Reason"]=g),p.$plumbing.del(a,f,n)}))}});h&&p.$deletedFacts&&b.forEach(p.$deletedFacts,function(b,g){b=b||a;var l={"Content-Type":"application/x-fs-v1+json"};b&&(l["X-Reason"]=b);k.push(p.$plumbing.del(g,l,n))});var v=p.$helpers.promiseAll(k).then(function(a){var f=h?h:a[0];return p.$helpers.extendHttpPromise(v,k[0]),g?p.$client.getChildAndParents(f,{},n).then(function(a){return b.deletePropertiesPartial(p,b.appFieldRejector),b.extend(p,
a.getRelationship()),f}):f});return v},$delete:function(a,b){return this.$client.deleteChildAndParents(this.$getChildAndParentsUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../relationshipHelpers":47,"../utils":48}],8:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Collection=function(a,f){d.BaseClass.call(this,a,f);f&&f.attribution&&(this.attribution=a.createAttribution(f.attribution))};d.prototype.createCollection=function(b){return new a(this,b)};a.prototype={constructor:a,
$getCollectionUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).self).href)},$getSourceDescriptions:function(a){return this.$client.getCollectionSourceDescriptions(this.$helpers.removeAccessToken(this.links["source-descriptions"].href),a)},$save:function(a,f){var b=this,n=b.$helpers.chainHttpPromises(b.id?b.$plumbing.getUrl("user-collection-template",null,{udcid:b.id}):b.$plumbing.getUrl("user-collections"),function(a){return b.$plumbing.post(a,{collections:[b]},{},f,function(a,
f){return b.id||f.getResponseHeader("X-ENTITY-ID")})}),d=n.then(function(e){return b.$helpers.extendHttpPromise(d,n),a?b.$client.getCollection(e,{},f).then(function(a){return c.deletePropertiesPartial(b,c.appFieldRejector),c.extend(b,a.getCollection()),e}):e});return d},$delete:function(a){return this.$client.deleteCollection(this.$getCollectionUrl()||this.id,a)}}},{"./../FamilySearch":1,"./../utils":48}],9:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.Comment=function(a,
b){d.BaseClass.call(this,a,b)};d.prototype.createComment=function(a){return new b(this,a)};b.prototype={constructor:b,$getCommentUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links).comment).href)},$getAgentId:function(){return c(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(c(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(a,b){var f=this;return f.$helpers.chainHttpPromises(f.$plumbing.getUrl(this.$memoryId?
"memory-comments-template":"discussion-comments-template",null,{did:f.$discussionId,mid:f.$memoryId}),function(a){return f.$plumbing.post(a,{discussions:[{comments:[f]}]},{"Content-Type":"application/x-fs-v1+json"},b,function(a,b){return f.id||(f.id=b.getResponseHeader("X-ENTITY-ID")),f.$getCommentUrl()||(f.links={comment:{href:b.getResponseHeader("Location")}}),f.id})})},$delete:function(a,b){return this.$discussionId?this.$client.deleteDiscussionComment(this.$getCommentUrl()||this.$discussionId,
this.id,a,b):this.$client.deleteMemoryComment(this.$getCommentUrl()||this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],10:[function(e,k,h){var d=e("../FamilySearch"),c=e("../relationshipHelpers"),b=e("../utils"),a=b.maybe,g=d.Couple=function(a,g){d.BaseClass.call(this,a,g);g&&(g.$husband&&this.$setHusband(g.$husband),g.$wife&&this.$setWife(g.$wife),g.facts&&b.forEach(this.facts,function(b,g){b instanceof d.Fact||(this.facts[g]=a.createFact(b))},this))};d.prototype.createCouple=
function(a){return new g(this,a)};g.prototype={constructor:g,$getCoupleUrl:function(){return this.$helpers.removeAccessToken(a(a(this.links).relationship).href)},$getFacts:function(){return this.facts||[]},$getMarriageFact:function(){return b.find(this.facts,{type:"http://gedcomx.org/Marriage"})},$getHusbandId:function(){return a(this.person1).resourceId},$getHusbandUrl:function(){return this.$helpers.removeAccessToken(a(this.person1).resource)},$getHusband:function(){return this.$client.getPerson(this.$getHusbandUrl()||
this.$getHusbandId())},$getWifeId:function(){return a(this.person2).resourceId},$getWifeUrl:function(){return this.$helpers.removeAccessToken(a(this.person2).resource)},$getWife:function(){return this.$client.getPerson(this.$getWifeUrl()||this.$getWifeId())},$getSpouseId:function(f){return a(this.person1).resourceId===f?a(this.person2).resourceId:a(this.person1).resourceId},$getSpouseUrl:function(f){return this.$helpers.removeAccessToken(a(this.person1).resourceId===f?a(this.person2).resource:a(this.person1).resource)},
$getSpouse:function(a){return this.$client.getPerson(this.$getSpouseUrl(a)||this.$getSpouseId(a))},$getNotes:function(){return this.$client.getCoupleNotes(this.$helpers.removeAccessToken(a(a(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getCoupleSourceRefs(this.id)},$getSources:function(){return this.$client.getCoupleSourcesQuery(this.id)},$getChanges:function(){return this.$client.getCoupleChanges(this.$helpers.removeAccessToken(a(this.links["change-history"]).href))},
$setHusband:function(a){return c.setMember.call(this,"person1",a),this.$husbandChanged=!0,this},$setWife:function(a){return c.setMember.call(this,"person2",a),this.$wifeChanged=!0,this},$setFacts:function(a,b){return c.setFacts.call(this,"facts",a,b),this},$addFact:function(a){return c.addFact.call(this,"facts",a),this},$deleteFact:function(a,b){return c.deleteFact.call(this,"facts",a,b),this},$save:function(a,g,n){var d=this.$client.createCouple(),e=!1,h=this.id,p=this;(!this.id||this.$husbandChanged||
this.$wifeChanged)&&(d.person1=this.person1,d.person2=this.person2,e=!0);a&&(d.attribution=p.$client.createAttribution(a));b.forEach(this.facts,function(a){h&&a.id&&!a.$changed||(c.addFact.call(d,"facts",a),e=!0)});var k=[];e&&(h||(d.type="http://gedcomx.org/Couple"),k.push(p.$helpers.chainHttpPromises(h?p.$plumbing.getUrl("couple-relationship-template",null,{crid:h}):p.$plumbing.getUrl("relationships"),function(a){return b.forEach(["person1","person2"],function(a){d[a]&&!d[a].resource&&d[a].resourceId&&
(d[a].resource=d[a].resourceId)}),p.$plumbing.post(a,{relationships:[d]},{},n,p.$helpers.getResponseEntityId)})));h&&this.$deletedFacts&&b.forEach(this.$deletedFacts,function(b,g){b=b||a;k.push(p.$plumbing.del(g,b?{"X-Reason":b}:{},n))});var v=this,x=p.$helpers.promiseAll(k).then(function(a){var f=h?h:a[0];return p.$helpers.extendHttpPromise(x,k[0]),g?p.$client.getCouple(f,{},n).then(function(a){return b.deletePropertiesPartial(v,b.appFieldRejector),b.extend(v,a.getRelationship()),f}):f});return x},
$delete:function(a,b){return this.$client.deleteCouple(this.$getCoupleUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../relationshipHelpers":47,"../utils":48}],11:[function(e,k,h){var d=e("./../FamilySearch"),c=function(a,b){var f,l="",c="",d="",e="",h="+",k=0;"about"===a[k]?(b||(l="A"),k++):"before"===a[k]?(b||(l="A/"),k++):"after"===a[k]&&(b||(l="A",c="/"),k++);2>=a[k].length&&(d=(1===a[k].length?"0":"")+a[k],k++);var t="january february march april may june july august september october november december".split(" ").indexOf(a[k])+
1;return 0<t&&(e=(10>t?"0":"")+t.toString(),k++),f=a[k],k++,k<a.length&&"bc"===a[k]&&(h="-"),l+h+f+(e?"-":"")+e+(d?"-":"")+d+c},b=d.Date=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createDate=function(a){return new b(this,a)};b.prototype={constructor:b,$getFormalDate:function(){var a="";if(this.normalized){var b=this.normalized.trim().toLowerCase().split(" "),f=b.indexOf("/");0<=f&&(b=b.slice(0,f));"from"===b[0]?(f=b.indexOf("to"),a=c(b.slice(1,f),!0)+"/"+c(b.slice(f+1),!0)):a=c(b,!1)}return a}}},
{"./../FamilySearch":1}],12:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Discussion=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createDiscussion=function(b){return new a(this,b)};a.prototype={constructor:a,$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).discussion).href)},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).comments).href)},$getComments:function(){return this.$client.getDiscussionComments(this.$getCommentsUrl())},
$getAgentId:function(){return b(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(b(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(a,b,l){var n=this,d=n.$helpers.chainHttpPromises(n.id?n.$plumbing.getUrl("discussion-template",null,{did:n.id}):n.$plumbing.getUrl("discussions"),function(a){return n.$plumbing.post(a,{discussions:[n]},{"Content-Type":"application/x-fs-v1+json"},
l,function(a,b){return n.id||b.getResponseHeader("X-ENTITY-ID")})}),e=d.then(function(a){return n.$helpers.extendHttpPromise(e,d),b?n.$client.getDiscussion(a,{},l).then(function(b){return c.deletePropertiesPartial(n,c.appFieldRejector),c.extend(n,b.getDiscussion()),a}):a});return e},$delete:function(a,b){return this.$client.deleteDiscussion(this.$getDiscussionUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],13:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=
d.DiscussionRef=function(a,b){d.BaseClass.call(this,a,b);b&&b.discussion&&this.$setDiscussion(b.discussion)};d.prototype.createDiscussionRef=function(a){return new b(this,a)};b.prototype={constructor:b,$getDiscussionRefUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links)["discussion-reference"]).href)},$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getDiscussion:function(){return this.$client.getDiscussion(this.$getDiscussionUrl()||this.resourceId)},
$setDiscussion:function(a){return a instanceof d.Discussion?(this.resource=a.$getDiscussionUrl(),this.resourceId=a.id):this.$helpers.isAbsoluteUrl(a)?this.resource=this.$helpers.removeAccessToken(a):this.resourceId=a,this},$save:function(a,b){var f=this;return f.$helpers.chainHttpPromises(f.$plumbing.getUrl("person-discussion-references-template",null,{pid:f.$personId}),function(l){!f.resource&&f.resourceId&&(f.resource=f.resourceId);var c={persons:[{id:f.$personId,"discussion-references":[{resource:f.resource}]}]};
a&&(c.persons[0].attribution=f.$client.createAttribution(a));return f.$plumbing.post(l,c,{"Content-Type":"application/x-fs-v1+json"},b,function(a,b){return f.$getDiscussionRefUrl()||(f.links={"discussion-reference":{href:b.getResponseHeader("Location"),title:"Discussion Reference"}}),f.$getDiscussionRefUrl()})})},$delete:function(a,b){return this.$client.deleteDiscussionRef(this.$getDiscussionRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],14:[function(e,k,h){var d=
e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Fact=function(a,b){d.BaseClass.call(this,a,b);b&&(b.$date&&(this.$setDate(b.$date),delete this.$date),b.$formalDate&&(this.$setFormalDate(b.$formalDate),delete this.$formalDate),b.$place&&(this.$setPlace(b.$place),delete this.$place),b.$normalizedPlace&&(this.$setNormalizedPlace(b.$normalizedPlace),delete this.$normalizedPlace),b.$changeMessage&&(this.$setChangeMessage(b.$changeMessage),delete this.$changeMessage),!b.attribution||b.attribution instanceof
d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createFact=function(b){return new a(this,b)};a.prototype={constructor:a,$getDate:function(){return b(this.date).original},$getNormalizedDate:function(){return b(b(b(this.date).normalized)[0]).value},$getFormalDate:function(){return b(this.date).formal},$getPlace:function(){return b(this.place).original},$getNormalizedPlace:function(){return b(b(b(this.place).normalized)[0]).value},$getNormalizedPlaceId:function(){var a=
b(this.place).description;return a&&"#"===a.charAt(0)?a.substr(1):""},$isCustomNonEvent:function(){if(this.qualifiers){var a=c.find(this.qualifiers,{name:"http://familysearch.org/v1/Event"});return!!a&&"false"===a.value}return!1},$setType:function(a){return this.$changed=!0,this.type=a,this},$setCustomNonEvent:function(a){var b;return a?(this.qualifiers||(this.qualifiers=[]),b=c.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),0>b&&(b=this.qualifiers.push({name:"http://familysearch.org/v1/Event"})-
1),this.qualifiers[b].value="false"):this.qualifiers&&(b=c.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),0<=b&&this.qualifiers.splice(b,1),0===this.qualifiers.length&&delete this.qualifiers),this.$changed=!0,this},$setDate:function(a){this.$changed=!0;var b;return c.isString(a)?b=a:a instanceof d.Date?(b=a.original,this.$setFormalDate(a.$getFormalDate()),this.$setNormalizedDate(a.normalized)):c.isObject(a)&&(b=a.$original,this.$setFormalDate(a.$formal),this.$setNormalizedDate(a.$normalized)),
b?(this.date||(this.date={}),this.date.original=b):delete this.date,this},$setFormalDate:function(a){return this.$changed=!0,a?(this.date||(this.date={}),this.date.formal=a):this.date&&delete this.date.formal,this},$setNormalizedDate:function(a){return this.$changed=!0,a?(this.date||(this.date={}),this.date.normalized=[{value:a}]):this.date&&delete this.date.normalized,this},$setPlace:function(a){this.$changed=!0;var b;return c.isString(a)||null==a?b=a:a instanceof d.Place?(b=a.original,this.$setNormalizedPlace(a.$getNormalizedPlace())):
c.isObject(a)&&(b=a.$original,this.$setNormalizedPlace(a.$normalized)),b?(this.place||(this.place={}),this.place.original=b):delete this.place,this},$setNormalizedPlace:function(a){return this.$changed=!0,a?(this.place||(this.place={}),this.place.normalized=[{value:a}]):this.place&&delete this.place.normalized,this},$setChangeMessage:function(a){return this.attribution=this.$client.createAttribution(a),this}}},{"./../FamilySearch":1,"./../utils":48}],15:[function(e,k,h){var d=e("./../FamilySearch"),
c=e("./../utils"),b=c.maybe,a=d.Memory=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemory=function(b){return new a(this,b)};a.prototype={constructor:a,$getTitle:function(){return b(b(this.titles)[0]).value},$getDescription:function(){return b(b(this.description)[0]).value},$getIconUrl:function(){return this.$helpers.appendAccessToken(b(b(this.links)["image-icon"]).href)},$getThumbnailUrl:function(){return this.$helpers.appendAccessToken(b(b(this.links)["image-thumbnail"]).href)},$getImageUrl:function(){return this.$helpers.appendAccessToken(b(b(this.links).image).href)},
$getMemoryArtifactUrl:function(){return this.$helpers.appendAccessToken(this.$helpers.removeAccessToken(this.about))},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).description).href)},$getArtifactFilename:function(){return b(b(this.artifactMetadata)[0]).filename},$getArtifactType:function(){return b(b(this.artifactMetadata)[0]).artifactType},$getArtifactHeight:function(){return b(b(this.artifactMetadata)[0]).height},$getArtifactWidth:function(){return b(b(this.artifactMetadata)[0]).width},
$getCommentsUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).comments).href)},$getComments:function(){return this.$client.getMemoryComments(this.$getCommentsUrl()||this.id)},$setTitle:function(a){return this.titles=[{value:a}],this},$setDescription:function(a){return this.description=[{value:a}],this},$setArtifactFilename:function(a){return c.isArray(this.artifactMetadata)&&this.artifactMetadata.length||(this.artifactMetadata=[{}]),this.artifactMetadata[0].filename=a,this},$save:function(a,
b,l){var n=this,d=n.$helpers.chainHttpPromises(n.id?n.$plumbing.getUrl("memory-template",null,{mid:n.id}):n.$plumbing.getUrl("memories"),function(a){if(n.id)return n.$plumbing.post(a,{sourceDescriptions:[n]},{},l,function(){return n.id});var b={};return n.$getTitle()&&(b.title=n.$getTitle()),n.$getDescription()&&(b.description=n.$getDescription()),n.$getArtifactFilename()&&(b.filename=n.$getArtifactFilename()),n.$plumbing.post(n.$helpers.appendQueryParameters(a,b),n.$data,{"Content-Type":c.isString(n.$data)?
"text/plain":"multipart/form-data"},l,n.$helpers.getResponseEntityId)}),e=d.then(function(a){return n.$helpers.extendHttpPromise(e,d),b?n.$client.getMemory(a,{},l).then(function(b){return c.deletePropertiesPartial(n,c.appFieldRejector),c.extend(n,b.getMemory()),a}):a});return e},$delete:function(a,b){return this.$client.deleteMemory(this.$getMemoryUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],16:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.MemoryArtifactRef=
function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemoryArtifactRef=function(b){return new a(this,b)};a.prototype={constructor:a,$getQualifierName:function(){return b(b(this.qualifiers)[0]).name},$getQualifierValue:function(){return b(b(this.qualifiers)[0]).value},$setQualifierName:function(a){return c.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]),this.qualifiers[0].name=a,this},$setQualifierValue:function(a){return c.isArray(this.qualifiers)&&this.qualifiers.length||
(this.qualifiers=[{}]),this.qualifiers[0].value=a,this}}},{"./../FamilySearch":1,"./../utils":48}],17:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.MemoryPersona=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemoryPersona=function(b){return new a(this,b)};a.prototype={constructor:a,$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).persona).href)},$getMemoryArtifactRef:function(){return b(this.media)[0]},$getName:function(){return b(this.names)[0]},
$getDisplayName:function(){return b(this.display).name},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(b(this.$getMemoryArtifactRef()).description)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl()||this.$memoryId)},$setName:function(a){return a instanceof d.Name||(a=this.$client.createName(a)),this.names=[a],this},$setMemoryArtifactRef:function(a){return this.media=[a],this},$save:function(a,b,l){var n=this,d=n.$helpers.chainHttpPromises(n.$plumbing.getUrl(n.id?
"memory-persona-template":"memory-personas-template",null,{mid:n.$memoryId,pid:n.id}),function(a){if(!n.$getMemoryArtifactRef()){var b=n.$helpers.getUrlFromDiscoveryResource(n.$client.settings.discoveryResource,"memory-template",{mid:n.$memoryId});n.$setMemoryArtifactRef(n.$client.createMemoryArtifactRef({description:b}))}return n.$plumbing.post(a,{persons:[n]},{},l,function(a,b){return n.$getMemoryPersonaUrl()||n.$helpers.removeAccessToken(b.getResponseHeader("Location"))})}),e=d.then(function(a){return n.$helpers.extendHttpPromise(e,
d),b?n.$client.getMemoryPersona(a,null,{},l).then(function(b){return c.deletePropertiesPartial(n,c.appFieldRejector),c.extend(n,b.getMemoryPersona()),a}):a});return e},$delete:function(a,b){return this.$client.deleteMemoryPersona(this.$getMemoryPersonaUrl()||this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],18:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.MemoryPersonaRef=function(a,b){d.BaseClass.call(this,a,b);b&&b.$memoryPersona&&this.$setMemoryPersona(b.$memoryPersona)};
d.prototype.createMemoryPersonaRef=function(a){return new b(this,a)};b.prototype={constructor:b,$getMemoryPersonaRefUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links)["evidence-reference"]).href)},$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getMemoryPersona:function(){return this.$client.getMemoryPersona(this.$getMemoryPersonaUrl())},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links).memory).href)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl())},
$setMemoryPersona:function(a){return a instanceof d.MemoryPersona&&(a=a.$getMemoryPersonaUrl()),this.resource=this.$helpers.removeAccessToken(a),this},$save:function(a,b){var f=this;return f.$helpers.chainHttpPromises(f.$plumbing.getUrl("person-memory-persona-references-template",null,{pid:f.$personId}),function(a){return f.$plumbing.post(a,{persons:[{evidence:[f]}]},{},b,function(a,b){return f.id||(f.id=b.getResponseHeader("X-ENTITY-ID")),f.$getMemoryPersonaRefUrl()||(f.links={"evidence-reference":{href:b.getResponseHeader("Location")}}),
f.$getMemoryPersonaRefUrl()})})},$delete:function(a,b){return this.$client.deleteMemoryPersonaRef(this.$getMemoryPersonaRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],19:[function(e,k,h){function d(a,g){var c=g||0;for(b.isArray(a.nameForms)||(a.nameForms=[]);c>=a.nameForms.length;)a.nameForms.push({});return a.nameForms[c]}var c=e("./../FamilySearch"),b=e("./../utils"),a=b.maybe,g=c.Name=function(a,g){c.BaseClass.call(this,a,g);g&&(b.isString(g)?this.$setFullText(g):
(g.type&&this.$setType(g.type),g.$givenName&&(this.$setGivenName(g.$givenName),delete this.$givenName),g.$surname&&(this.$setSurname(g.$surname),delete this.$surname),g.$prefix&&(this.$setPrefix(g.$prefix),delete this.$prefix),g.$suffix&&(this.$setSuffix(g.$suffix),delete this.$suffix),g.$fullText&&(this.$setFullText(g.$fullText),delete this.$fullText),this.$setPreferred(!!g.preferred),g.$changeMessage&&(this.$setChangeMessage(g.$changeMessage),delete this.$changeMessage),!g.attribution||g.attribution instanceof
c.Attribution||(this.attribution=a.createAttribution(g.attribution))))};c.prototype.createName=function(a){return new g(this,a)};g.prototype={constructor:g,$getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},$getNameForm:function(b){return a(this.nameForms)[b||0]},$getFullText:function(b){return a(this.$getNameForm(b)).fullText},$getLang:function(b){return a(this.$getNameForm(b)).lang},$getNamePart:function(f,g){return a(b.find(a(this.$getNameForm(g)).parts,{type:f})).value},
$getGivenName:function(a){return this.$getNamePart("http://gedcomx.org/Given",a)},$getSurname:function(a){return this.$getNamePart("http://gedcomx.org/Surname",a)},$getPrefix:function(a){return this.$getNamePart("http://gedcomx.org/Prefix",a)},$getSuffix:function(a){return this.$getNamePart("http://gedcomx.org/Suffix",a)},$setType:function(a){return this.$changed=!0,a?this.type=a:delete this.type,this},$setPreferred:function(a){return this.$changed=!0,this.preferred=a,this},$setFullText:function(a,
b){this.$changed=!0;var g=d(this,b);return a?g.fullText=a:delete g.fullText,this},$setNamePart:function(a,g,c){this.$changed=!0;c=d(this,c);b.isArray(c.parts)||(c.parts=[]);var e=b.find(c.parts,{type:g});return a?(e||(e={type:g},c.parts.push(e)),e.value=a):e&&c.parts.splice(c.parts.indexOf(e),1),this},$setGivenName:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Given",b)},$setSurname:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Surname",b)},$setPrefix:function(a,b){return this.$setNamePart(a,
"http://gedcomx.org/Prefix",b)},$setSuffix:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Suffix",b)},$setChangeMessage:function(a){return this.attribution=this.$client.createAttribution(a),this}}},{"./../FamilySearch":1,"./../utils":48}],20:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Note=function(a,b){d.BaseClass.call(this,a,b);!this.attribution||this.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(this.attribution))};d.prototype.createNote=
function(b){return new a(this,b)};a.prototype={constructor:a,$getNoteUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).note).href)},$save:function(a,b,l){var n,d,e=this,h={};e.$personId?(n=e.id?"person-note-template":"person-notes-template",d="persons"):e.$coupleId?(n=e.id?"couple-relationship-note-template":"couple-relationship-notes-template",d="relationships"):e.$childAndParentsId&&(n=e.id?"child-and-parents-relationship-note-template":"child-and-parents-relationship-notes-template",
d="childAndParentsRelationships",h["Content-Type"]="application/x-fs-v1+json");var k=e.$helpers.chainHttpPromises(e.$plumbing.getUrl(n,null,{pid:e.$personId,crid:e.$coupleId,caprid:e.$childAndParentsId,nid:e.id}),function(b){var f={};return f[d]=[{notes:[e]}],a&&(f[d][0].attribution=e.$client.createAttribution(a)),e.$plumbing.post(b,f,h,l,function(a,b){return{id:e.id||b.getResponseHeader("X-ENTITY-ID"),location:e.$getNoteUrl()||e.$helpers.removeAccessToken(b.getResponseHeader("Location"))}})}),t=
k.then(function(a){return e.$helpers.extendHttpPromise(t,k),b?e.$client.getPersonNote(a.location,null,{},l).then(function(b){return c.deletePropertiesPartial(e,c.appFieldRejector),c.extend(e,b.getNote()),a.id}):a.id});return t},$delete:function(a,b){return this.$personId?this.$client.deletePersonNote(this.$getNoteUrl()||this.$personId,this.id,a,b):this.$coupleId?this.$client.deleteCoupleNote(this.$getNoteUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsNote(this.$getNoteUrl()||
this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],21:[function(e,k,h){function d(a){return a?" "+a:""}var c=e("../FamilySearch"),b=e("../utils"),a=b.maybe,g=c.Person=function(a,g){c.BaseClass.call(this,a,g);g&&(g.$gender&&(this.$setGender(g.$gender),delete this.$gender),g.names&&b.forEach(this.names,function(b,g){b instanceof c.Name||(this.names[g]=a.createName(b))},this),g.facts&&b.forEach(this.facts,function(b,g){b instanceof c.Fact||(this.facts[g]=a.createFact(b))},
this),!g.attribution||g.attribution instanceof c.Attribution||(this.attribution=a.createAttribution(g.attribution)))};c.prototype.createPerson=function(a){return new g(this,a)};g.prototype={constructor:g,$getFacts:function(a){return(a?b.filter(this.facts,{type:a}):this.facts)||[]},$getFact:function(a){return b.find(this.facts,{type:a})},$getBirth:function(){return this.$getFact("http://gedcomx.org/Birth")},$getBirthDate:function(){var a=this.$getBirth();return a?a.$getDate():""},$getBirthPlace:function(){var a=
this.$getBirth();return a?a.$getPlace():""},$getChristening:function(){return this.$getFact("http://gedcomx.org/Christening")},$getChristeningDate:function(){var a=this.$getChristening();return a?a.$getDate():""},$getChristeningPlace:function(){var a=this.$getChristening();return a?a.$getPlace():""},$getDeath:function(){return this.$getFact("http://gedcomx.org/Death")},$getDeathDate:function(){var a=this.$getDeath();return a?a.$getDate():""},$getDeathPlace:function(){var a=this.$getDeath();return a?
a.$getPlace():""},$getBurial:function(){return this.$getFact("http://gedcomx.org/Burial")},$getBurialDate:function(){var a=this.$getBurial();return a?a.$getDate():""},$getBurialPlace:function(){var a=this.$getBurial();return a?a.$getPlace():""},$getDisplayBirthDate:function(){return a(this.display).birthDate},$getDisplayBirthPlace:function(){return a(this.display).birthPlace},$getDisplayDeathDate:function(){return a(this.display).deathDate},$getDisplayDeathPlace:function(){return a(this.display).deathPlace},
$getDisplayGender:function(){return a(this.display).gender},$getDisplayLifeSpan:function(){return a(this.display).lifespan},$getDisplayName:function(){return a(this.display).name},$getNames:function(a){return(a?b.filter(this.names,{type:a}):this.names)||[]},$getPreferredName:function(){return b.findOrFirst(this.names,{preferred:!0})},$getGivenName:function(){var a=this.$getPreferredName();return a&&(a=a.$getGivenName()),a},$getSurname:function(){var a=this.$getPreferredName();return a&&(a=a.$getSurname()),
a},$getPersistentIdentifier:function(){return a(a(this.identifiers)["http://gedcomx.org/Persistent"])[0]},$getPersonUrl:function(){return this.$helpers.removeAccessToken(a(a(this.links).person).href)},$getChanges:function(a){return this.$client.getPersonChanges(this.$helpers.removeAccessToken(this.links["change-history"].href),a)},$getDiscussionRefs:function(){return this.$client.getPersonDiscussionRefs(this.$helpers.removeAccessToken(this.links["discussion-references"].href))},$getMemoryPersonaRefs:function(){return this.$client.getMemoryPersonaRefs(this.$helpers.removeAccessToken(this.links["evidence-references"].href))},
$getNotes:function(){return this.$client.getPersonNotes(this.$helpers.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return this.$client.getPersonSourceRefs(this.id)},$getSources:function(){return this.$client.getPersonSourcesQuery(this.id)},$getSpouses:function(){return this.$client.getSpouses(this.id)},$getParents:function(){return this.$client.getParents(this.id)},$getChildren:function(){return this.$client.getChildren(this.id)},$getMatches:function(){return this.$client.getPersonMatches(this.id)},
$getAncestry:function(a){return this.$client.getAncestry(this.id,a)},$getDescendancy:function(a){return this.$client.getDescendancy(this.id,a)},$getPersonPortraitUrl:function(a){return this.$client.getPersonPortraitUrl(this.id,a)},$setNames:function(a,g){return b.isArray(this.names)&&b.forEach(this.names,function(a){this.$deleteName(a,g)},this),this.names=[],b.forEach(a,function(a){this.$addName(a)},this),this},$addName:function(a){return b.isArray(this.names)||(this.names=[]),a instanceof c.Name||
(a=this.$client.createName(a)),this.names.push(a),this},$deleteName:function(a,g){a instanceof c.Name||(a=b.find(this.names,{id:a}));var n=b.indexOf(this.names,a);return 0<=n&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=g,this.names.splice(n,1)),this},$setFacts:function(a,g){return b.isArray(this.facts)&&b.forEach(this.facts,function(a){this.$deleteFact(a,g)},this),this.facts=[],b.forEach(a,function(a){this.$addFact(a)},this),this},$addFact:function(a){return b.isArray(this.facts)||
(this.facts=[]),a instanceof c.Fact||(a=this.$client.createFact(a)),this.facts.push(a),this},$deleteFact:function(a,g){a instanceof c.Fact||(a=b.find(this.facts,{id:a}));var n=b.indexOf(this.facts,a);return 0<=n&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=g,this.facts.splice(n,1)),this},$setGender:function(a,b){return this.gender||(this.gender={}),this.gender.$changed=!0,this.gender.type=a,b&&(this.gender.attribution=this.$client.createAttribution(b)),
this},$save:function(a,g,c){var e=this.$client.createPerson(),q=!1;this.id&&(e.id=this.id);this.id||(this.gender||this.$setGender("http://gedcomx.org/Unknown"),b.isArray(this.names)&&0!==this.names.length||this.$addName({$fullText:"Unknown",$givenName:"Unknown"}),b.find(this.names,{preferred:!0})||this.names[0].$setPreferred(!0),1!==this.names.length||this.names[0].type||this.names[0].$setType("http://gedcomx.org/BirthName"),b.isUndefined(this.living)&&(this.living=!1));a&&(e.attribution=this.$client.createAttribution(a));
this.id||(e.living=this.living);!this.gender||this.gender.id&&!this.gender.$changed||(e.gender=this.gender,q=!0);b.forEach(this.names,function(a){(!a.id||a.$changed)&&(a.$getFullText()||a.$setFullText((d(a.$getPrefix())+d(a.$getGivenName())+d(a.$getSurname())+d(a.$getSuffix())).trim()),e.$addName(a),q=!0)});b.forEach(this.facts,function(a){(!a.id||a.$changed)&&(e.$addFact(a),q=!0)});var h=[],k=this;q&&h.push(k.$helpers.chainHttpPromises(e.id?k.$plumbing.getUrl("person-template",null,{pid:e.id}):k.$plumbing.getUrl("persons"),
function(a){return k.$plumbing.post(a,{persons:[e]},{},c,k.$helpers.getResponseEntityId)}));this.id&&this.$deletedConclusions&&b.forEach(this.$deletedConclusions,function(b,g){b=b||a;h.push(k.$helpers.chainHttpPromises(k.$plumbing.getUrl("person-conclusion-template",null,{pid:e.id,cid:g}),function(a){return k.$plumbing.del(a,b?{"X-Reason":b}:{},c)}))});var t=this,v=k.$helpers.promiseAll(h).then(function(a){var f=e.id?e.id:a[0];return k.$helpers.extendHttpPromise(v,h[0]),g?k.$client.getPerson(f,{},
c).then(function(a){return b.deletePropertiesPartial(t,b.appFieldRejector),b.extend(t,a.getPerson()),f}):f});return v},$delete:function(a,b){return this.$client.deletePerson(this.$getPersonUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../utils":48}],22:[function(e,k,h){var d=e("./../FamilySearch"),c=d.Place=function(b,a){d.BaseClass.call(this,b,a)};d.prototype.createPlace=function(b){return new c(this,b)};c.prototype={constructor:c,$getNormalizedPlace:function(){return this.normalized?this.normalized[0]:
void 0}}},{"./../FamilySearch":1}],23:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.SearchResult=function(a,f){d.BaseClass.call(this,a,f);c.forEach(b(b(b(f).content).gedcomx).persons,function(b,f,c){c[f]=a.createPerson(b)})};d.prototype.createSearchResult=function(b){return new a(this,b)};a.prototype={constructor:a,$getPerson:function(a){return c.find(b(b(this.content).gedcomx).persons,{id:a})},$getPrimaryPerson:function(){return this.$getPerson(this.id)},$getFullPrimaryPerson:function(){return this.$client.getPerson(this.id)},
$getFatherIds:function(){var a=this.id,f=this;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,function(l){return"http://gedcomx.org/ParentChild"===l.type&&l.person2.resourceId===a&&l.person1&&"http://gedcomx.org/Male"===b(f.$getPerson(l.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getFathers:function(){return c.map(this.$getFatherIds(),this.$getPerson,this)},$getMotherIds:function(){var a=this.id,f=this;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,
function(l){return"http://gedcomx.org/ParentChild"===l.type&&l.person2.resourceId===a&&l.person1&&"http://gedcomx.org/Male"!==b(f.$getPerson(l.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getMothers:function(){return c.map(this.$getMotherIds(),this.$getPerson,this)},$getSpouseIds:function(){var a=this.id;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/Couple"===b.type&&(b.person1.resourceId===a||b.person2.resourceId===
a)}),function(b){return b.person1.resourceId===a?b.person2.resourceId:b.person1.resourceId}))},$getSpouses:function(){return c.map(this.$getSpouseIds(),this.$getPerson,this)},$getChildIds:function(){var a=this.id;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/ParentChild"===b.type&&b.person1.resourceId===a&&b.person2}),function(a){return a.person2.resourceId}))},$getChildren:function(){return c.map(this.$getChildIds(),this.$getPerson,this)}}},
{"./../FamilySearch":1,"./../utils":48}],24:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.SourceDescription=function(a,b){d.BaseClass.call(this,a,b);b&&(b.$citation&&this.$setCitation(b.$citation),b.$title&&this.$setTitle(b.$title),b.$text&&this.$setText(b.$text),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createSourceDescription=function(b){return new a(this,b)};a.prototype={constructor:a,
$getCitation:function(){return b(b(this.citations)[0]).value},$getTitle:function(){return b(b(this.titles)[0]).value},$getText:function(){return b(b(this.notes)[0]).text},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).description).href)},$getSourceRefsQuery:function(){return this.$client.getSourceRefsQuery(this.id)},$setCitation:function(a){return this.citations=[{value:a}],this},$setTitle:function(a){return this.titles=[{value:a}],this},$setText:function(a){return this.notes=
[{text:a}],this},$save:function(a,b,l){var n=this;a&&(n.attribution=n.$client.createAttribution(a));var d=n.$helpers.chainHttpPromises(n.id?n.$plumbing.getUrl("source-description-template",null,{sdid:n.id}):n.$plumbing.getUrl("source-descriptions"),function(a){return n.$plumbing.post(a,{sourceDescriptions:[n]},{},l,function(a,b){return n.id||b.getResponseHeader("X-ENTITY-ID")})}),e=d.then(function(a){return n.$helpers.extendHttpPromise(e,d),b?n.$client.getSourceDescription(a,{},l).then(function(b){return c.deletePropertiesPartial(n,
c.appFieldRejector),c.extend(n,b.getSourceDescription()),a}):a});return e},$delete:function(a,b){return this.$client.deleteSourceDescription(this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],25:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.SourceRef=function(a,b){d.BaseClass.call(this,a,b);b&&(this.$personId=b.$personId,this.$coupleId=b.$coupleId,this.$childAndParentsId=b.$childAndParentsId,b.$sourceDescription&&this.$setSourceDescription(b.$sourceDescription),
b.$tags&&this.$setTags(b.$tags),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createSourceRef=function(b){return new a(this,b)};a.prototype={constructor:a,$getSourceRefUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links)["source-reference"]).href)},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(this.description)},$getSourceDescription:function(){return this.$client.getSourceDescription(this.$getSourceDescriptionUrl())},
$getTags:function(){return c.map(this.tags,function(a){return a.resource})},$setSourceDescription:function(a){return a instanceof d.SourceDescription?(this.$sourceDescriptionId=a.id,this.description=a.$getSourceDescriptionUrl()):this.$helpers.isAbsoluteUrl(a)?(delete this.$sourceDescriptionId,this.description=this.$sourceDescriptionUrl):(this.$sourceDescriptionId=a,delete this.description),this},$setTags:function(a){return this.tags=c.map(a,function(a){return{resource:a}}),this},$addTag:function(a){return c.isArray(this.tags)||
(this.tags=[]),this.tags.push({resource:a}),this},$removeTag:function(a){return a=c.find(this.tags,{resource:a}),a&&this.tags.splice(c.indexOf(this.tags,a),1),this},$save:function(a,b){var l=this;a&&(l.attribution=l.$client.createAttribution(a));var c,d,e={};return l.$personId?(c="person-source-references-template",d="persons"):l.$coupleId?(c="couple-relationship-source-references-template",d="relationships"):l.$childAndParentsId&&(c="child-and-parents-relationship-source-references-template",c="child-and-parents-relationship-source-references-template",
d="childAndParentsRelationships",e["Content-Type"]="application/x-fs-v1+json"),l.$helpers.chainHttpPromises(l.$plumbing.getUrl(c,null,{pid:l.$personId,crid:l.$coupleId,caprid:l.$childAndParentsId,srid:l.id}),function(a){!l.description&&l.$sourceDescriptionId&&(l.description=l.$helpers.getUrlFromDiscoveryResource(l.$client.settings.discoveryResource,"source-description-template",{sdid:l.$sourceDescriptionId}));l.description=l.$helpers.removeAccessToken(l.description);var g={};return g[d]=[{sources:[l]}],
l.$plumbing.post(a,g,e,b,function(a,b){return l.id||(l.id=b.getResponseHeader("X-ENTITY-ID")),l.$getSourceRefUrl()||(l.links={"source-reference":{href:l.$helpers.removeAccessToken(b.getResponseHeader("Location"))}}),l.id})})},$delete:function(a,b){return this.$personId?this.$client.deletePersonSourceRef(this.$getSourceRefUrl()||this.$personID,this.id,a,b):this.$coupleId?this.$client.deleteCoupleSourceRef(this.$getSourceRefUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsSourceRef(this.$getSourceRefUrl()||
this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],26:[function(e,k,h){var d=e("../FamilySearch"),c=d.User=function(b,a){d.BaseClass.call(this,b,a)};d.prototype.createUser=function(b){return new c(this,b)};c.prototype={constructor:c}},{"../FamilySearch":1}],27:[function(e,k,h){k.exports={clientId:null,environment:null,httpWrapper:null,deferredWrapper:null,setTimeout:null,clearTimeout:null,redirectUri:null,autoSignin:!1,autoExpire:!1,accessToken:null,saveAccessToken:!1,
logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:2,maxAccessTokenInactivityTime:354E4,maxAccessTokenCreationTime:8634E4,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://beta.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",beta:"https://identbeta.familysearch.org/cis-web/oauth2/v3",
production:"https://ident.familysearch.org/cis-web/oauth2/v3"},authoritiesServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://apibeta.familysearch.org",production:"https://api.familysearch.org"},discoveryUrl:"/.well-known/app-meta"}},{}],28:[function(e,k,h){var d=e("./utils"),c=d.forEach;e=function(b){this.settings=b.settings;this.accessTokenCreationTimer=this.accessTokenInactiveTimer=null};e.prototype.getAbsoluteUrl=function(b,a){return this.isAbsoluteUrl(a)?
a:b+("/"!==a.charAt(0)?"/":"")+a};e.prototype.isOAuthServerUrl=function(b){return 0===b.indexOf(this.settings.oauthServer[this.settings.environment])};e.prototype.getAPIServerUrl=function(b){return this.getAbsoluteUrl(this.settings.apiServer[this.settings.environment],b)};e.prototype.getAuthoritiesServerUrl=function(b){return this.getAbsoluteUrl(this.settings.authoritiesServer[this.settings.environment],b)};e.prototype.appendAccessToken=function(b){if(b){var a=this.decodeQueryString(b);b=this.removeQueryString(b);
a.access_token=this.settings.accessToken;b=this.appendQueryParameters(b,a)}return b};e.prototype.log=function(){this.settings.debug&&console.log.apply(null,arguments)};e.prototype.nextTick=function(b){this.settings.setTimeout(function(){b()},0)};e.prototype.refPromise=function(b){if(b&&d.isFunction(b.then))return b;var a=this;return{then:function(g){var f=a.settings.deferredWrapper();return a.nextTick(function(){f.resolve(g(b))}),f.promise}}};e.prototype.promiseAll=function(b){var a=this.settings.deferredWrapper(),
g=0,f=d.isArray(b)?[]:{},l=this;return c(b,function(b,c){g++;l.refPromise(b).then(function(b){f.hasOwnProperty(c)||(f[c]=b,--g||a.resolve(f))},function(){f.hasOwnProperty(c)||a.reject.apply(a,arguments)})}),0===g&&a.resolve(f),a.promise};e.prototype.setTimer=function(b,a,g){return g&&this.settings.clearTimeout(g),this.settings.setTimeout(function(){b()},a)};e.prototype.setAccessTokenInactiveTimer=function(b){this.accessTokenInactiveTimer=this.setTimer(this.settings.eraseAccessToken,b,this.accessTokenInactiveTimer)};
e.prototype.setAccessTokenCreationTimer=function(b){this.accessTokenCreationTimer=this.setTimer(this.settings.eraseAccessToken,b,this.accessTokenCreationTimer)};e.prototype.clearAccessTokenTimers=function(){this.settings.clearTimeout(this.accessTokenInactiveTimer);this.accessTokenInactiveTimer=null;this.settings.clearTimeout(this.accessTokenCreationTimer);this.accessTokenCreationTimer=null};e.prototype.getAccessTokenCookieName=function(){return this.settings.accessTokenCookie+"_"+this.settings.instanceId};
e.prototype.readAccessToken=function(){if("undefined"!=typeof window){var b=(new Date).getTime(),a=this.readCookie(this.getAccessTokenCookieName());if(a&&(a=a.split("|",3),3===a.length)){var g=b-parseInt(a[0],10),b=b-parseInt(a[1],10);g<this.settings.maxAccessTokenInactivityTime&&b<this.settings.maxAccessTokenCreationTime&&(this.settings.accessToken=a[2],this.settings.autoExpire&&(this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime-g),this.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime-
b)))}}};e.prototype.setAccessToken=function(b){if(this.settings.accessToken=b,"undefined"!=typeof window&&(this.settings.autoExpire&&(this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime),this.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime)),this.settings.saveAccessToken)){var a=(new Date).getTime();b=a+"|"+a+"|"+b;this.createCookie(this.getAccessTokenCookieName(),b,0)}};e.prototype.refreshAccessToken=function(){var b=(new Date).getTime();if(this.settings.autoExpire&&
this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime),this.settings.saveAccessToken){var a=this.readCookie(this.getAccessTokenCookieName());if(a){var g=a.split("|",3);3===g.length&&(a=b+"|"+g[1]+"|"+g[2],this.createCookie(this.getAccessTokenCookieName(),a,0))}}};e.prototype.eraseAccessToken=function(b){this.settings.accessToken=null;"undefined"!=typeof window&&(this.settings.autoExpire&&this.clearAccessTokenTimers(),this.settings.saveAccessToken&&this.eraseCookie(this.getAccessTokenCookieName()),
this.settings.expireCallback&&!b&&this.settings.expireCallback())};e.prototype.extendHttpPromise=function(b,a){return d.wrapFunctions(b,a,["getResponseHeader","getAllResponseHeaders","getStatusCode","getRequest"])};e.prototype.chainHttpPromises=function(){var b=arguments[0],a={},g=this;return c(Array.prototype.slice.call(arguments,1),function(f){b=b.then(function(){var b=f.apply(null,arguments);return b&&b.then&&g.extendHttpPromise(a,b),b})}),g.extendHttpPromise(b,a),b};e.prototype.getLastUrlSegment=
function(b){return b&&(b=b.replace(/^.*\//,"").replace(/\?.*$/,"")),b};e.prototype.getResponseEntityId=function(b,a){return a.getResponseHeader("X-ENTITY-ID")};e.prototype.getResponseLocation=function(b,a){return this.removeAccessToken(a.getResponseHeader("Location"))};e.prototype.isAbsoluteUrl=function(b){return/^https?:\/\//.test(b)};e.prototype.isAuthoritiesServerUrl=function(b){return-1!==b.indexOf("/authorities/v1/")};e.prototype.encodeQueryString=function(b){var a=[];return c(b,function(b,f){f=
encodeURIComponent(f);var l;l=d.isArray(b)?d.map(b,function(a){return f+"="+encodeURIComponent(a)}).join("&"):null!=b?f+"="+encodeURIComponent(b):f;a.push(l)}),a.join("&")};e.prototype.appendQueryParameters=function(b,a){var g=this.encodeQueryString(a);return 0===g.length?b:b+(0<=b.indexOf("?")?"&":"?")+g};e.prototype.decodeQueryString=function(b){var a={};if(b){var g=b.indexOf("?");-1!==g&&(b=b.substring(g+1).split("&"),c(b,function(b){var g=b.split("=",2);g&&g[0]&&(b=decodeURIComponent(g[0]),g=
null!=g[1]?decodeURIComponent(g[1]):g[1],null==a[b]||d.isArray(a[b])||(a[b]=[a[b]]),null!=a[b]?a[b].push(g):a[b]=g)}))}return a};e.prototype.removeQueryString=function(b){if(b){var a=b.indexOf("?");-1!==a&&(b=b.substring(0,a))}return b};e.prototype.removeAccessToken=function(b){if(b){var a=this.decodeQueryString(b);b=this.removeQueryString(b);delete a.access_token;b=this.appendQueryParameters(b,a)}return b};e.prototype.populateUriTemplate=function(b,a){for(var g=b.split(/[{}]/),f=!1,l=0,c=g.length;c>
l;l++)if(1===l%2){var d=a[g[l]];g[l]=f?encodeURIComponent(d):encodeURI(d)}else-1!==g[l].indexOf("?")&&(f=!0);return g.join("")};e.prototype.getUrlFromDiscoveryResource=function(b,a,g){var f="";b=b.links[a];b.href?f=this.removeAccessToken(b.href):b.template&&(f=b.template.replace(/{\?[^}]*}/,""),f=this.populateUriTemplate(f,g||{}));return f};e.prototype.attributionNeeded=function(b){return!(b.attribution&&b.attribution.changeMessage&&!b.attribution.contributor)};e.prototype.createCookie=function(b,
a,g){var f="",l="https"===document.location.protocol&&"localhost"!==document.location.hostname;g&&(f=new Date,f.setTime(f.getTime()+86400*g),f="; expires="+f.toUTCString());document.cookie=b+"="+a+f+"; path=/"+(l?"; secure":"")};e.prototype.readCookie=function(b){b+="=";for(var a=document.cookie.split(";"),g=0;g<a.length;g++){for(var f=a[g];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b))return f.substring(b.length,f.length)}return null};e.prototype.eraseCookie=function(b){this.createCookie(b,
"",-1)};k.exports=e},{"./utils":48}],29:[function(e,k,h){var d=e("./utils");h={httpWrapper:function(c,b){return function(a,g,f,l,n){n=d.extend({url:g,type:a,dataType:"json",data:l,processData:!1},n);n.headers=d.extend({},f,n.headers);"multipart/form-data"===n.headers["Content-Type"]&&(n.contentType=!1,delete n.headers["Content-Type"]);a=c(n);var e=b.settings.deferredWrapper();g=e.promise;var q=null;return a.then(function(a,b,f){q=f.status;e.resolve(a)},function(a,b,f){q=a.status;200<=q&&299>=q&&!a.responseText?
e.resolve(null):e.reject(a,b,f)}),d.wrapFunctions(g,a,["getResponseHeader","getAllResponseHeaders"]),g.getStatusCode=function(){return q},g.getRequest=function(){return n},g}},deferredWrapper:function(c){return function(){var b=c();return{promise:b.promise(),resolve:b.resolve,reject:b.reject}}}};k.exports=h},{"./utils":48}],30:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils");k.prototype.getAuthCode=function(){var c=this,b=c.settings;if("undefined"==typeof window){var a=b.deferredWrapper();
return a.reject(),a.promise}return c.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(a){a=c.openPopup(a,{response_type:"code",client_id:b.clientId,redirect_uri:b.redirectUri});return c._pollForAuthCode(a)})};k.prototype.handleAccessTokenResponse=function(c,b){var a=this;c.then(function(g){var f=g.access_token;f?(a.helpers.setAccessToken(f),b.resolve(f)):b.reject(g.error)},function(){b.reject.apply(b,arguments)})};k.prototype.getAccessToken=function(c){var b=this,a=b.settings,
g=a.deferredWrapper(),f=b.plumbing,l=b.helpers;a.accessToken?l.nextTick(function(){g.resolve(a.accessToken)}):(c?l.refPromise(c):b.getAuthCode()).then(function(l){f.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(c){c=f.post(c,{grant_type:"authorization_code",code:l,client_id:a.clientId},{"Content-Type":"application/x-www-form-urlencoded"});b.handleAccessTokenResponse(c,g)})},function(){g.reject.apply(g,arguments)});return g.promise};k.prototype.getAccessTokenForMobile=function(c,
b){var a=this,g=a.settings.deferredWrapper(),f=a.plumbing,l=a.helpers;return a.settings.accessToken?l.nextTick(function(){g.resolve(a.settings.accessToken)}):f.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(l){l=f.post(l,{grant_type:"password",client_id:a.settings.clientId,username:c,password:b},{"Content-Type":"application/x-www-form-urlencoded"});a.handleAccessTokenResponse(l,g)}),g.promise};k.prototype.hasAccessToken=function(){return!!this.settings.accessToken};k.prototype.invalidateAccessToken=
function(){var c=this;return c.helpers.eraseAccessToken(!0),c.helpers.chainHttpPromises(c.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/token"),function(b){return c.plumbing.del(b)})};k.prototype.openPopup=function(c,b){var a=d.isUndefined(window.screenX)?window.screenLeft:window.screenX,g=d.isUndefined(window.screenY)?window.screenTop:window.screenY,f=d.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,l=d.isUndefined(window.outerHeight)?document.documentElement.clientHeight-
22:window.outerHeight,n=b.width||780,e=b.height||500,a=parseInt(a+(f-n)/2,10),g=parseInt(g+(l-e)/2.5,10),n="width="+n+",height="+e+",left="+a+",top="+g;return window.open(this.helpers.appendQueryParameters(c,b),"",n)};k.prototype.getCode=function(c,b){var a=this.helpers.decodeQueryString(c);a.code?b.resolve(a.code):b.reject(a.error)};k.prototype._pollForAuthCode=function(c){var b=this,a=b.settings.deferredWrapper();if(c){var g=setInterval(function(){try{c.location.hostname===window.location.hostname&&
(b.getCode(c.location.href,a),clearInterval(g),c.close())}catch(f){}},b.settings.authCodePollDelay);window.FamilySearchOauthReceiver=function(f){b.getCode(f,a);clearInterval(g)}}else a.reject("Popup blocked");return a.promise}},{"./../FamilySearch":1,"./../utils":48}],31:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils");k.prototype.getDate=function(c,b){var a=this,g={date:c,dataFormat:"application/json"};return a.plumbing.get(a.helpers.getAuthoritiesServerUrl("/authorities/v1/date"),
g,{Accept:"application/json"},b,d.compose(d.objectExtender({getDate:function(){return d.maybe(d.maybe(this.dates).date)[0]}}),function(b){return d.forEach(b.dates.date,function(b,f,g){g[f]=a.createDate(b)}),b}))};k.prototype.getPlaceSearch=function(c,b){var a=this,g={place:c,view:"simple",dataFormat:"application/json"};return a.plumbing.get(a.helpers.getAuthoritiesServerUrl("/authorities/v1/place"),g,{Accept:"application/json"},b,d.compose(d.objectExtender({getPlaces:function(){return d.maybe(this.places).place}}),
function(b){return d.forEach(b.places.place,function(b,f,g){g[f]=a.createPlace(b)}),b}))}},{"./../FamilySearch":1,"./../utils":48}],32:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils");k.prototype._changeHistoryResponseMapper=function(){var c=this;return d.compose(d.objectExtender({getChanges:function(){return this.entries||[]}}),function(b){for(var a=0;a<b.entries.length;a++)b.entries[a]=c.createChange(b.entries[a]);return b})};k.prototype.getPersonChanges=function(c,b,a){var g=this;
return g.helpers.chainHttpPromises(g.plumbing.getUrl("person-changes-template",c,{pid:c}),function(f){return g.plumbing.get(f,b,{Accept:"application/x-gedcomx-atom+json"},a,g._changeHistoryResponseMapper())})};k.prototype.getChildAndParentsChanges=function(c,b,a){var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("child-and-parents-relationship-changes-template",c,{caprid:c}),function(f){return g.plumbing.get(f,b,{Accept:"application/x-gedcomx-atom+json"},a,g._changeHistoryResponseMapper())})};
k.prototype.getCoupleChanges=function(c,b,a){var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("couple-relationship-changes-template",c,{crid:c}),function(f){return g.plumbing.get(f,b,{Accept:"application/x-gedcomx-atom+json"},a,g._changeHistoryResponseMapper())})};k.prototype.restoreChange=function(c,b){var a=this;return a.helpers.chainHttpPromises(a.plumbing.getUrl("change-restore-template",c,{chid:c}),function(g){return a.plumbing.post(g,null,{"Content-Type":void 0},b,function(){return c})})}},
{"./../FamilySearch":1,"./../utils":48}],33:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe;d.prototype.getDiscussion=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("discussion-template",a,{did:a}),function(a){return l.plumbing.get(a,g,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getDiscussion:function(){return b(b(this).discussions)[0]}}),function(a){for(var b=0;b<a.discussions.length;b++)a.discussions[b]=l.createDiscussion(a.discussions[b]);
return a}))})};d.prototype.getMultiDiscussion=function(a,b,f){var l=this,n={};return c.forEach(a,function(a){var c,e;a instanceof d.DiscussionRef?(e=a.$getDiscussionUrl(),c=a.resourceId):(e=a,c=a);n[c]=l.getDiscussion(e,b,f)}),l.helpers.promiseAll(n)};d.prototype.getPersonDiscussionRefs=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-discussion-references-template",a,{pid:a}),function(a){return l.plumbing.get(a,g,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getDiscussionRefs:function(){return b(b(b(this).persons)[0])["discussion-references"]||
[]}}),function(a){if(a&&a.persons&&a.persons[0]&&c.isArray(a.persons[0]["discussion-references"]))for(var b=a.persons[0]["discussion-references"],f=0;f<b.length;f++)b[f]=l.createDiscussionRef(b[f]);return a},c.objectExtender(function(a){return{$personId:b(b(b(a).persons)[0]).id}},function(a){return b(b(b(a).persons)[0])["discussion-references"]})))})};d.prototype._commentsResponseMapper=function(){var a=this;return c.compose(c.objectExtender({getComments:function(){return b(b(b(this).discussions)[0]).comments||
[]}}),function(b){if(b&&b.discussions&&b.discussions[0]&&c.isArray(b.discussions[0].comments))for(var f=b.discussions[0].comments,l=0;l<f.length;l++)f[l]=a.createComment(f[l]);return b})};d.prototype.getDiscussionComments=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("discussion-comments-template",a,{did:a}),function(a){return l.plumbing.get(a,g,{Accept:"application/x-fs-v1+json"},f,c.compose(l._commentsResponseMapper(),c.objectExtender(function(a){return{$discussionId:b(b(b(a).discussions)[0]).id}},
function(a){return b(b(b(a).discussions)[0]).comments})))})};d.prototype.deleteDiscussion=function(a,b,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("discussion-template",a,{did:a}),function(b){return l.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},f,function(){return a})})};d.prototype.deleteDiscussionRef=function(a,b,f,l){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-discussion-reference-template",a,{pid:a,drid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};
return f&&(g["X-Reason"]=f),c.plumbing.del(b,g,l,function(){return a})})};d.prototype.deleteDiscussionComment=function(a,b,f,l){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("discussion-comment-template",a,{did:a,cmid:b}),function(b){return c.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},l,function(){return a})})};d.prototype.deleteMemoryComment=function(a,b,f,l){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("memory-comment-template",a,{mid:a,cmid:b}),
function(b){return c.plumbing.del(b,{},l,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],34:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils"),c=d.maybe;k.prototype._memoriesResponseMapper=function(){var b=this;return function(a){if(a&&d.isArray(a.sourceDescriptions))for(var g=0;g<a.sourceDescriptions.length;g++)a.sourceDescriptions[g].attribution&&(a.sourceDescriptions[g].attribution=b.createAttribution(a.sourceDescriptions[g].attribution)),a.sourceDescriptions[g]=
b.createMemory(a.sourceDescriptions[g]);return a}};k.prototype.getPersonMemoriesQuery=function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("person-memories-query",b,{pid:b}),function(b){return f.plumbing.get(b,a,{},g,d.compose(d.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),f._memoriesResponseMapper()))})};k.prototype.getUserMemoriesQuery=function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("user-memories-query",
b,{cisUserId:b}),function(b){return f.plumbing.get(b,a,{},g,d.compose(d.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),f._memoriesResponseMapper()))})};k.prototype.getMemory=function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-template",b,{mid:b}),function(b){return f.plumbing.get(b,a,{},g,d.compose(d.objectExtender({getMemory:function(){return c(this.sourceDescriptions)[0]}}),f._memoriesResponseMapper()))})};k.prototype.getMemoryComments=
function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-comments-template",b,{mid:b}),function(b){return f.plumbing.get(b,a,{Accept:"application/x-fs-v1+json"},g,d.compose(f._commentsResponseMapper(),d.objectExtender(function(a){return{$memoryId:c(c(c(a).sourceDescriptions)[0]).id}},function(a){return c(c(c(a).discussions)[0]).comments})))})};k.prototype._memoryPersonasMapper=function(){var b=this;return d.compose(function(a){if(a&&d.isArray(a.persons))for(var g=0;g<
a.persons.length;g++)a.persons[g]=b.createMemoryPersona(a.persons[g]);return a},function(a){if(a&&d.isArray(a.persons))for(var g=0;g<a.persons.length;g++)if(d.isArray(a.persons[g].names))for(var f=0;f<a.persons[g].names.length;f++)a.persons[g].names[f]=b.createName(a.persons[g].names[f]);return a},function(a){if(a&&d.isArray(a.persons))for(var g=0;g<a.persons.length;g++)a.persons[g].media&&(a.persons[g].media=b.createMemoryArtifactRef(a.persons[g].media));return a},d.objectExtender(function(a){return{$memoryId:c(c(a.sourceDescriptions)[0]).id}},
function(a){return c(a).persons}))};k.prototype.getMemoryPersonas=function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-personas-template",b,{mid:b}),function(b){return f.plumbing.get(b,a,{},g,d.compose(d.objectExtender({getMemoryPersonas:function(){return this&&this.persons?this.persons:[]}}),f._memoryPersonasMapper()))})};k.prototype.getMemoryPersona=function(b,a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("memory-persona-template",b,{mid:b,
pid:a}),function(a){return l.plumbing.get(a,g,{},f,d.compose(d.objectExtender({getMemoryPersona:function(){return c(this.persons)[0]}}),l._memoryPersonasMapper()))})};k.prototype.getMemoryPersonaRefs=function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("person-memory-persona-references-template",b,{pid:b}),function(b){return f.plumbing.get(b,a,{},g,d.compose(d.objectExtender({getMemoryPersonaRefs:function(){return c(c(this.persons)[0]).evidence||[]}}),function(a){try{if(a&&
d.isArray(a.persons)&&a.persons[0]){var b=a.persons[0];if(b.evidence&&d.isArray(b.evidence))for(var g=0;g<b.evidence.length;g++)b.evidence[g]=f.createMemoryPersonaRef(b.evidence[g])}}catch(c){console.error(c.stack)}return a},d.objectExtender(function(a){return{$personId:c(c(c(a).persons)[0]).id}},function(a){return c(c(c(a).persons)[0]).evidence})))})};k.prototype.getPersonPortraitUrl=function(b,a,g){var f=this;return f.plumbing.getUrl("person-portrait-template",b,{pid:b}).then(function(b){if(a&&
a.followRedirect){a=d.extend({},a);delete a.followRedirect;var c=f.plumbing.get(b,a,{"X-Expect-Override":"200-ok"},g);return c.then(function(){return 204===c.getStatusCode()?"":f.helpers.appendAccessToken(c.getResponseHeader("Location"))})}return f.helpers.appendAccessToken(b)})};k.prototype.deleteMemory=function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-template",b,{mid:b}),function(a){return f.plumbing.del(a,{},g,function(){return b})})};k.prototype.deleteMemoryPersona=
function(b,a,g,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("memory-persona-template",b,{mid:b,pid:a}),function(a){return c.plumbing.del(a,{},f,function(){return b})})};k.prototype.deleteMemoryPersonaRef=function(b,a,g,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-memory-persona-reference-template",b,{pid:b,erid:a}),function(a){return c.plumbing.del(a,{},f,function(){return b})})}},{"./../FamilySearch":1,"./../utils":48}],35:[function(e,k,h){function d(a){if(a){if(a.persons)return a.persons;
if(a.childAndParentsRelationships)return a.childAndParentsRelationships;if(a.relationships)return a.relationships}return{}}k=e("./../FamilySearch");var c=e("./../utils"),b=c.maybe;k.prototype._getNote=function(a,g,f){var l=this;return l.plumbing.get(a,g,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getNote:function(){return b(b(d(this)[0]).notes)[0]}}),function(a){var f=b(d(a)[0]).notes;return c.forEach(f,function(a,b){f[b]=l.createNote(a)}),a},c.objectExtender(function(a){var f=
{};return f[a.persons?"$personId":a.childAndParentsRelationships?"$childAndParentsId":"$coupleId"]=b(d(a)[0]).id,f},function(a){return b(d(a)[0]).notes})))};k.prototype._getMultiNote=function(a,b,f,l,d){var e=this,q={};return c.isArray(a)?c.forEach(a,function(a){q[a]=d.call(e,a,null,f,l)}):c.forEach(b,function(b){q[b]=d.call(e,a,b,f,l)}),q};k.prototype.getPersonNote=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-note-template",a,{pid:a,nid:b}),function(a){return d._getNote(a,
f,c)})};k.prototype.getMultiPersonNote=function(a,b,f,c){a=this._getMultiNote(a,b,f,c,this.getPersonNote);return this.helpers.promiseAll(a)};k.prototype.getCoupleNote=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(a){return d._getNote(a,f,c)})};k.prototype.getMultiCoupleNote=function(a,b,f,c){a=this._getMultiNote(a,b,f,c,this.getCoupleNote);return this.helpers.promiseAll(a)};k.prototype.getChildAndParentsNote=
function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-note-template",a,{caprid:a,nid:b}),function(a){return d._getNote(a,f,c)})};k.prototype.getMultiChildAndParentsNote=function(a,b,f,c){a=this._getMultiNote(a,b,f,c,this.getChildAndParentsNote);return this.helpers.promiseAll(a)};k.prototype.getPersonNotes=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-notes-template",a,{pid:a}),function(a){return l.plumbing.get(a,
g,{},f,c.compose(c.objectExtender({getNotes:function(){return b(b(b(this).persons)[0]).notes||[]}}),function(a){var f=b(b(b(a).persons)[0]).notes;return c.forEach(f,function(a,b){f[b]=l.createNote(a)}),a},c.objectExtender(function(a){return{$personId:b(b(b(a).persons)[0]).id}},function(a){return b(b(b(a).persons)[0]).notes})))})};k.prototype.getCoupleNotes=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-notes-template",a,{crid:a}),function(a){return l.plumbing.get(a,
g,{},f,c.compose(c.objectExtender({getNotes:function(){return b(b(this.relationships)[0]).notes||[]}}),function(a){var f=b(b(b(a).relationships)[0]).notes;return c.forEach(f,function(a,b){f[b]=l.createNote(a)}),a},c.objectExtender(function(a){return{$coupleId:b(b(b(a).relationships)[0]).id}},function(a){return b(b(b(a).relationships)[0]).notes})))})};k.prototype.getChildAndParentsNotes=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("child-and-parents-relationship-notes-template",
a,{caprid:a}),function(a){return l.plumbing.get(a,g,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getNotes:function(){return b(b(this.childAndParentsRelationships)[0]).notes||[]}}),function(a){var f=b(b(b(a).childAndParentsRelationships)[0]).notes;return c.forEach(f,function(a,b){f[b]=l.createNote(a)}),a},c.objectExtender(function(a){return{$childAndParentsId:b(b(b(a).childAndParentsRelationships)[0]).id}},function(a){return b(b(b(a).childAndParentsRelationships)[0]).notes})))})};
k.prototype.deletePersonNote=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-note-template",a,{pid:a,nid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};return f&&(g["X-Reason"]=f),d.plumbing.del(b,g,c,function(){return a})})};k.prototype.deleteCoupleNote=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(b){var g={};return f&&(g["X-Reason"]=f),
d.plumbing.del(b,g,c,function(){return a})})};k.prototype.deleteChildAndParentsNote=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-note-template",a,{caprid:a,nid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};return f&&(g["X-Reason"]=f),d.plumbing.del(b,g,c,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],36:[function(e,k,h){k=e("../FamilySearch");var d=e("../utils"),c=d.maybe,b={getRelationship:function(){return c(this.childAndParentsRelationships)[0]},
getPerson:function(a){return d.find(this.persons,{id:a})}};k.prototype.getChildAndParents=function(a,g,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("child-and-parents-relationship-template",a,{caprid:a}),function(a){return c.plumbing.get(a,g,{Accept:"application/x-fs-v1+json"},f,d.compose(d.objectExtender(b),function(a){return d.forEach(a.persons,function(a,b,f){f[b]=c.createPerson(a)}),d.forEach(a.childAndParentsRelationships,function(a,b,f){f[b]=c.createChildAndParents(a)}),
a}))})};k.prototype.deleteChildAndParents=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("child-and-parents-relationship-template",a,{caprid:a}),function(d){var e={"Content-Type":"application/x-fs-v1+json"};return b&&(e["X-Reason"]=b),c.plumbing.del(d,e,f,function(){return a})})}},{"../FamilySearch":1,"../utils":48}],37:[function(e,k,h){function d(g){return{getPersons:function(){return this.persons},exists:function(f){return!!a(b.find(this.persons,c(g,f))).id},getPerson:function(a){return b.find(this.persons,
c(g,a))}}}function c(a,b){return function(c){return c.display[a]==b}}k=e("./../FamilySearch");var b=e("./../utils"),a=b.maybe;k.prototype.getAncestry=function(g,f,l){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("ancestry-query"),function(r){return e.plumbing.get(r,b.extend({person:g},f),{},l,b.compose(b.objectExtender(d("ascendancyNumber")),f&&f.descendants?b.objectExtender({getDescendant:function(a){return b.find(this.persons,c("descendancyNumber",a))},existsDescendant:function(f){return!!a(b.find(this.persons,
c("descendancyNumber",f))).id}}):null,function(a){return b.forEach(a.persons,function(a,b,f){f[b]=e.createPerson(a)}),a},b.objectExtender({$getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(b){return a(b).persons}),f&&f.descendants?b.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(b){return a(b).persons}):null))})};k.prototype.getDescendancy=function(g,f,c){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("descendancy-query"),
function(r){return e.plumbing.get(r,b.extend({person:g},f),{},c,b.compose(b.objectExtender(d("descendancyNumber")),function(a){return b.forEach(a.persons,function(a,b,f){f[b]=e.createPerson(a)}),a},b.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(b){return a(b).persons})))})}},{"./../FamilySearch":1,"./../utils":48}],38:[function(e,k,h){k=e("../FamilySearch");var d=e("../utils"),c=d.maybe,b={getPerson:function(a){return d.find(this.persons,{id:a})},
getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var a=this.getPrimaryId();return d.filter(this.childAndParentsRelationships,function(b){return c(b.child).resourceId===a})},getSpouseRelationships:function(){return d.filter(this.relationships,function(a){return"http://gedcomx.org/Couple"===a.type})},getSpouseRelationship:function(a){var b=this.getPrimaryId();return d.find(this.relationships,function(f){return"http://gedcomx.org/Couple"===f.type&&
(b===f.$getHusbandId()?f.$getWifeId():f.$getHusbandId())===a})},getChildRelationships:function(){var a=this.getPrimaryId();return d.filter(this.childAndParentsRelationships,function(b){return c(b.father).resourceId===a||c(b.mother).resourceId===a})},getChildRelationshipsOf:function(a){var b=this.getPrimaryId();return d.filter(this.childAndParentsRelationships,function(f){return!(c(f.father).resourceId!==b&&c(f.mother).resourceId!==b||c(f.father).resourceId!=a&&c(f.mother).resourceId!=a)})},getFatherIds:function(){return d.uniq(d.map(d.filter(this.getParentRelationships(),
function(a){return!!a.$getFatherId()}),function(a){return a.$getFatherId()},this))},getFathers:function(){return d.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return d.uniq(d.map(d.filter(this.getParentRelationships(),function(a){return!!a.$getMotherId()}),function(a){return a.$getMotherId()},this))},getMothers:function(){return d.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return d.uniq(d.map(d.filter(this.getSpouseRelationships(),function(a){return a.$getHusbandId()&&
a.$getWifeId()}),function(a){return this.getPrimaryId()===a.$getHusbandId()?a.$getWifeId():a.$getHusbandId()},this))},getSpouses:function(){return d.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return d.uniq(d.map(this.getChildRelationships(),function(a){return a.$getChildId()},this))},getChildren:function(){return d.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(a){return d.uniq(d.map(this.getChildRelationshipsOf(a),function(a){return a.$getChildId()},
this))},getChildrenOf:function(a){return d.map(this.getChildIdsOf(a),this.getPerson,this)}};k.prototype.getPerson=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-template",a,{pid:a}),function(a){return c.plumbing.get(a,b,{},f,d.compose(d.objectExtender({getPerson:function(){return this.persons[0]}}),function(a){return d.forEach(a.persons,function(a,b,f){f[b]=c.createPerson(a)}),a},function(a,b){return a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");
return!!a&&0>a.indexOf("POST")},a}))})};k.prototype.getMultiPerson=function(a,b,f){var c={},e=this;return d.forEach(a,function(a){c[a]=e.getPerson(a,b,f)}),e.helpers.promiseAll(c)};k.prototype._personsAndRelationshipsMapper=function(){var a=this;return d.compose(d.objectExtender({getCoupleRelationships:function(){return d.filter(c(this).relationships,{type:"http://gedcomx.org/Couple"})||[]},getChildAndParentsRelationships:function(){return c(this).childAndParentsRelationships||[]},getPerson:function(a){return d.find(this.persons,
{id:a})}}),function(b){return d.forEach(b.persons,function(b,g,c){c[g]=a.createPerson(b)}),d.forEach(b.relationships,function(b,g,c){c[g]=a.createCouple(b)}),d.forEach(b.childAndParentsRelationships,function(b,g,c){c[g]=a.createChildAndParents(b)}),b})};k.prototype.getPersonWithRelationships=function(a,g,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-with-relationships-query"),function(e){return c.plumbing.get(e,d.extend({person:a},g),{},f,d.compose(d.objectExtender({getPrimaryId:function(){return a}}),
c._personsAndRelationshipsMapper(),d.objectExtender(b),function(a,b){return a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");return!!a&&0>a.indexOf("POST")},a}))})};k.prototype.getSpouses=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("spouses-template",a,{pid:a}),function(a){return c.plumbing.get(a,b,{},f,c._personsAndRelationshipsMapper())})};k.prototype.getParents=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("parents-template",
a,{pid:a}),function(a){return c.plumbing.get(a,b,{},f,c._personsAndRelationshipsMapper())})};k.prototype.getChildren=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("children-template",a,{pid:a}),function(a){return c.plumbing.get(a,b,{},f,c._personsAndRelationshipsMapper())})};k.prototype.deletePerson=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-template",a,{pid:a}),function(d){return c.plumbing.del(d,b?{"X-Reason":b}:{},f,
function(){return a})})};k.prototype.getPreferredSpouse=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(b){b=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:b,pid:a})},function(a){var d=c.plumbing.get(a+".json",b,{"X-Expect-Override":"200-ok"},f);return d.then(function(){if(200===d.getStatusCode()){var a=d.getResponseHeader("Location");return 0<=a.indexOf("child-and-parents-relationships")?null:c.helpers.getLastUrlSegment(a)}})})};
k.prototype.setPreferredSpouse=function(a,b,f){var c,e=[],r=this;return null===b?e.push(r.getChildren(a),function(a){a=d.find(a.getChildAndParentsRelationships(),function(a){return!a.$getFatherId()||!a.$getMotherId()});return r.plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:a.id})}):e.push(r.plumbing.getUrl("couple-relationship-template",b,{crid:b})),e.push(function(a){return c=a,r.getCurrentUser()},function(b){b=b.getUser().treeUserId;return r.plumbing.getUrl("preferred-spouse-relationship-template",
null,{uid:b,pid:a})},function(b){return r.plumbing.put(b,null,{Location:c},f,function(){return a})}),r.helpers.chainHttpPromises.apply(r.helpers,e)};k.prototype.deletePreferredSpouse=function(a,b){var f=this;return f.helpers.chainHttpPromises(f.getCurrentUser(),function(b){b=b.getUser().treeUserId;return f.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:b,pid:a})},function(c){return f.plumbing.del(c,{},b,function(){return a})})};k.prototype.getPreferredParents=function(a,b,f){var c=
this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(b){b=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:b,pid:a})},function(a){var d=c.plumbing.get(a+".json",b,{Accept:"application/x-fs-v1+json","X-Expect-Override":"200-ok"},f);return d.then(function(){return 200===d.getStatusCode()?c.helpers.getLastUrlSegment(d.getResponseHeader("Location")):void 0})})};k.prototype.setPreferredParents=function(a,b,f){var c,d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-template",
b,{caprid:b}),function(a){return c=a,d.getCurrentUser()},function(b){b=b.getUser().treeUserId;return d.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:b,pid:a})},function(b){return d.plumbing.put(b,null,{Location:c},f,function(){return a})})};k.prototype.deletePreferredParents=function(a,b){var f=this;return f.helpers.chainHttpPromises(f.getCurrentUser(),function(b){b=b.getUser().treeUserId;return f.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:b,pid:a})},function(c){return f.plumbing.del(c,
{},b,function(){return a})})}},{"../FamilySearch":1,"../utils":48}],39:[function(e,k,h){e("./../FamilySearch").prototype.getRedirectUrl=function(d){return this.helpers.appendAccessToken(this.helpers.appendQueryParameters(this.helpers.getAPIServerUrl("/platform/redirect"),d))}},{"./../FamilySearch":1}],40:[function(e,k,h){function d(a){return c.map(c.filter(c.keys(a),function(a){return!b[a]}),function(b){var l,d=a[b];l=c.isString(d)?(d=d.replace(/[:"]/g,"").trim(),0<=d.indexOf(" ")?'"'+d+'"':d):d;
return b+":"+l}).join(" ")}k=e("./../FamilySearch");var c=e("./../utils"),b={start:!0,count:!0,context:!0},a={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results||0},getIndex:function(){return this.index||0}};k.prototype._getSearchMatchResponseMapper=function(){var b=this;return c.compose(c.objectExtender(a),function(a){return c.forEach(a.entries,function(a,f,c){c[f]=b.createSearchResult(a)}),a})};k.prototype.getPersonSearch=function(a,b){var l=this;
return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-search"),function(e){return l.plumbing.get(e,c.removeEmptyProperties({q:d(c.removeEmptyProperties(c.extend({},a))),start:a.start,count:a.count,context:a.context}),{Accept:"application/x-gedcomx-atom+json"},b,c.compose(l._getSearchMatchResponseMapper(),function(a,b){return a.getContext=function(){return b.getResponseHeader("X-FS-Page-Context")},a}))})};k.prototype.getPersonMatches=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-matches-template",
a,{pid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._getSearchMatchResponseMapper())})};k.prototype.getPersonMatchesQuery=function(a,b){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-matches-query"),function(e){try{return l.plumbing.get(e,c.removeEmptyProperties({q:d(c.removeEmptyProperties(c.extend({},a))),start:a.start,count:a.count}),{Accept:"application/x-gedcomx-atom+json"},b,l._getSearchMatchResponseMapper())}catch(r){console.log(r.stack)}})}},
{"./../FamilySearch":1,"./../utils":48}],41:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe;d.prototype.getCollectionsForUser=function(a,b,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("user-collections-for-user-template",a,{uid:a}),function(a){return l.plumbing.get(a,{},{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getCollections:function(){return this.collections||[]}}),function(a){return c.forEach(a.collections,function(a,b,f){f[b]=
l.createCollection(a)}),a}))})};d.prototype.getCollection=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(a){return l.plumbing.get(a,g,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getCollection:function(){return b(this.collections)[0]}}),function(a){return c.forEach(a.collections,function(a,b,f){f[b]=l.createCollection(a)}),a}))})};d.prototype.getCollectionSourceDescriptions=function(a,b,f){var l=
this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(a){return l.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){return c.forEach(a.sourceDescriptions,function(a,b,f){f[b]=l.createSourceDescription(a)}),a}))})};d.prototype.getCollectionSourceDescriptionsForUser=function(a,b,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("user-collections-source-descriptions-for-user-template",
a,{uid:a}),function(a){return l.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){return c.forEach(a.sourceDescriptions,function(a,b,f){f[b]=l.createSourceDescription(a)}),a}))})};d.prototype.moveSourceDescriptionsToCollection=function(a,b,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(e){var r=
c.map(b,function(a){return{id:a instanceof d.SourceDescription?a.id:a}});return l.plumbing.post(e,{sourceDescriptions:r},{},f,function(){return a})})};d.prototype.removeSourceDescriptionsFromCollections=function(a,b){var f=this;return f.helpers.chainHttpPromises(f.getCurrentUser(),function(a){a=a.getUser().treeUserId;return f.plumbing.getUrl("user-collections-source-descriptions-for-user-template",null,{uid:a})},function(l){var e=c.map(a,function(a){return a instanceof d.SourceDescription?a.id:a});
return f.plumbing.del(f.helpers.appendQueryParameters(l,{id:e}),{},b,function(){return a})})};d.prototype.deleteCollection=function(a,b){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(c){return f.plumbing.del(c,{},b,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],42:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe;d.prototype.getSourceDescription=function(a,g,f){a instanceof d.SourceRef&&
(a=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId);var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("source-description-template",a,{sdid:a}),function(a){return l.plumbing.get(a,g,{},f,c.compose(c.objectExtender({getSourceDescription:function(){return b(this.sourceDescriptions)[0]}}),function(a){for(var f=b(b(a).sourceDescriptions),g=0;g<f.length;g++)f[g]=l.createSourceDescription(f[g]);return a}))})};d.prototype.getMultiSourceDescription=function(a,b,f){var l={},e=this;return c.forEach(a,
function(a){var c,h;a instanceof d.SourceRef?(c=a.$sourceDescriptionId||a.$getSourceDescriptionUrl(),h=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId):(c=a,h=a);l[c]=e.getSourceDescription(h,b,f)}),e.helpers.promiseAll(l)};d.prototype.getSourceRefsQuery=function(a,g,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("source-references-query"),function(d){return d=l.helpers.appendQueryParameters(d,{source:a}),l.plumbing.get(d,g,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getPersonSourceRefs:function(){return c.flatMap(b(this.persons),
function(a){return a.sources})}}),c.objectExtender({getCoupleSourceRefs:function(){return c.flatMap(b(this.relationships),function(a){return a.sources})}}),c.objectExtender({getChildAndParentsSourceRefs:function(){return c.flatMap(b(this.childAndParentsRelationships),function(a){return a.sources})}}),function(a){return c.forEach(["persons","relationships","childAndParentsRelationships"],function(f){b(a)[f]=c.map(b(a)[f],function(a){return a.sources=c.map(a.sources,function(a){return l.createSourceRef(a)}),
a})}),a},c.objectExtender(function(f,g){return{$personId:c.find(b(f).persons,function(a){return!!c.find(b(a).sources,{id:g.id})}).id,$sourceDescriptionId:a}},function(a){return c.flatMap(b(a).persons,function(a){return a.sources})}),c.objectExtender(function(f,g){return{$coupleId:c.find(b(f).relationships,function(a){return!!c.find(b(a).sources,{id:g.id})}).id,$sourceDescriptionId:a}},function(a){return c.flatMap(b(a).relationships,function(a){return a.sources})}),c.objectExtender(function(f,g){return{$childAndParentsId:c.find(b(f).childAndParentsRelationships,
function(a){return!!c.find(b(a).sources,{id:g.id})}).id,$sourceDescriptionId:a}},function(a){return c.flatMap(b(a).childAndParentsRelationships,function(a){return a.sources})})))})};d.prototype._getSourcesResponseMapper=function(a,g,f){var l=this;return c.compose(c.objectExtender(c.removeEmptyProperties({getSourceRefs:function(){return b(b(this[a])[0]).sources||[]},getSourceDescriptions:f?function(){return this.sourceDescriptions||[]}:null,getSourceDescription:f?function(a){return c.find(this.sourceDescriptions,
{id:a})}:null})),function(f){return c.forEach(b(b(b(f)[a])[0]).sources,function(a,b,f){f[b]=l.createSourceRef(a)}),f},c.objectExtender(function(f,c){var d;l.helpers.isAbsoluteUrl(c.description)?d={$sourceDescriptionId:l.helpers.getLastUrlSegment(c.description)}:(d="#"===c.description.charAt(0)?c.description.substr(1):c.description,d={$sourceDescriptionId:d,description:l.helpers.getUrlFromDiscoveryResource(l.settings.discoveryResource,"source-description-template",{sdid:d})});return d[g]=b(b(b(f)[a])[0]).id,
d},function(f){return b(b(b(f)[a])[0]).sources}),f?function(a){return c.forEach(a.sourceDescriptions,function(a,b,f){f[b]=l.createSourceDescription(a)}),a}:null)};d.prototype.getPersonSourceRefs=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-source-references-template",a,{pid:a}),function(a){return c.plumbing.get(a,b,{},f,c._getSourcesResponseMapper("persons","$personId",!1))})};d.prototype.getPersonSourcesQuery=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-sources-query-template",
a,{pid:a}),function(a){return c.plumbing.get(a,b,{},f,c._getSourcesResponseMapper("persons","$personId",!0))})};d.prototype.getCoupleSourceRefs=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("couple-relationship-source-references-template",a,{crid:a}),function(a){return c.plumbing.get(a,b,{},f,c._getSourcesResponseMapper("relationships","$coupleId",!1))})};d.prototype.getCoupleSourcesQuery=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("couple-relationship-sources-query-template",
a,{crid:a}),function(a){return c.plumbing.get(a,b,{},f,c._getSourcesResponseMapper("relationships","$coupleId",!0))})};d.prototype.getChildAndParentsSourceRefs=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("child-and-parents-relationship-source-references-template",a,{caprid:a}),function(a){return c.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},f,c._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",!1))})};d.prototype.getChildAndParentsSourcesQuery=
function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("child-and-parents-relationship-sources-template",a,{caprid:a}),function(a){return c.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},f,c._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",!0))})};d.prototype.deleteSourceDescription=function(a,b,f){var d=this,e=d.getSourceRefsQuery(a,{},f).then(function(r){r=c.union(c.map(r.getPersonSourceRefs(),function(a){return d.deletePersonSourceRef(a.$getSourceRefUrl(),
null,b,f)}),c.map(r.getCoupleSourceRefs(),function(a){return d.deleteCoupleSourceRef(a.$getSourceRefUrl(),null,b,f)}),c.map(r.getChildAndParentsSourceRefs(),function(a){return d.deleteChildAndParentsSourceRef(a.$getSourceRefUrl(),null,b,f)}));return d.helpers.promiseAll(r).then(function(){var c=d.helpers.chainHttpPromises(d.plumbing.getUrl("source-description-template",null,{sdid:a}),function(c){return d.plumbing.del(c,b?{"X-Reason":b}:{},f,function(){return a})});return d.helpers.extendHttpPromise(e,
c),c})});return e};d.prototype.deletePersonSourceRef=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-source-reference-template",a,{pid:a,srid:b}),function(b){return d.plumbing.del(b,f?{"X-Reason":f}:{},c,function(){return a})})};d.prototype.deleteCoupleSourceRef=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-source-reference-template",a,{crid:a,srid:b}),function(b){return d.plumbing.del(b,f?{"X-Reason":f}:
{},c,function(){return a})})};d.prototype.deleteChildAndParentsSourceRef=function(a,b,f,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-source-reference-template",a,{caprid:a,srid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};return f&&(g["X-Reason"]=f),d.plumbing.del(b,g,c,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],43:[function(e,k,h){k=e("../FamilySearch");var d=e("../utils"),c=d.maybe,b={getRelationship:function(){return c(this.relationships)[0]},
getPerson:function(a){return d.find(this.persons,{id:a})}};k.prototype.getCouple=function(a,c,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-template",a,{crid:a}),function(a){return l.plumbing.get(a,c,{},f,d.compose(d.objectExtender(b),function(a){return d.forEach(a.persons,function(a,b,f){f[b]=l.createPerson(a)}),d.forEach(a.relationships,function(a,b,f){f[b]=l.createCouple(a)}),a}))})};k.prototype.deleteCouple=function(a,b,f){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("couple-relationship-template",
a,{crid:a}),function(d){return c.plumbing.del(d,b?{"X-Reason":b}:{},f,function(){return a})})}},{"../FamilySearch":1,"../utils":48}],44:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils"),c=d.maybe;k.prototype.getCurrentUser=function(b,a){var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("current-user"),function(f){return g.plumbing.get(f,b,{},a,d.compose(d.objectExtender({getUser:function(){return c(this.users)[0]}}),function(a){return d.forEach(a.users,function(a,b,f){f[b]=
g.createUser(a)}),a}))})};k.prototype.getAgent=function(b,a,g){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("agent-template",b,{uid:b}),function(b){return f.plumbing.get(b,a,{},g,d.compose(d.objectExtender({getAgent:function(){return c(this.agents)[0]}}),function(a){return d.forEach(a.agents,function(a,b,c){c[b]=f.createAgent(a)}),a}))})};k.prototype.getMultiAgent=function(b,a,c){var f=this,l={};return d.forEach(b,function(b){l[b]=f.getAgent(b,a,c)}),f.helpers.promiseAll(l)}},{"./../FamilySearch":1,
"./../utils":48}],45:[function(e,k,h){var d=e("./utils");h={httpWrapper:function(c,b){return function(a,g,f,l,e){e=d.extend({url:g,method:a,json:!0,body:l},e);e.headers=d.extend({},f,e.headers);"multipart/form-data"===e.headers["Content-Type"]&&(e.formData=e.body,delete e.body,delete e.headers["Content-Type"],delete e.json);var r=b.settings.deferredWrapper();a=r.promise;var h=null,k={};return c(e,function(a,b,f){b&&(b.headers&&(k=b.headers),h=b.statusCode);a?r.reject(a):400<=h?(a=f.errors?f.errors[0]:
Error("server responded with a "+h),r.reject(a)):r.resolve(f)}),a.getStatusCode=function(){return h},a.getResponseHeader=function(a){return k[a]},a.getAllResponseHeaders=function(){return k},a.getRequest=function(){return e},a}},deferredWrapper:function(c){return function(){var b=c();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}}};k.exports=h},{"./utils":48}],46:[function(e,k,h){function d(b){var a,c,f,l,e,r,h,k="";for(a in b)if(b.hasOwnProperty(a))if(c=b[a],c instanceof Array)for(h=
0;h<c.length;++h)e=c[h],f=a+"["+h+"]",r={},r[f]=e,k+=d(r)+"&";else if(c instanceof Object)for(l in c)c.hasOwnProperty(l)&&(e=c[l],f=a+"["+l+"]",r={},r[f]=e,k+=d(r)+"&");else void 0!==c&&null!==c&&(k+=encodeURIComponent(a)+"="+encodeURIComponent(c)+"&");return k.length?k.substr(0,k.length-1):k}var c=e("./utils");e=function(b){this.client=b;this.helpers=b.helpers;this.settings=b.settings;this.totalProcessingTime=0};e.prototype.getTotalProcessingTime=function(){return this.totalProcessingTime};e.prototype.setTotalProcessingTime=
function(b){this.totalProcessingTime=b};e.prototype.getUrl=function(b,a,c){var f=this;return this.settings.discoveryPromise.then(function(d){return f.helpers.isAbsoluteUrl(a)?a:f.helpers.getUrlFromDiscoveryResource(d,b,c)})};e.prototype.get=function(b,a,g,f,d){return this.http("GET",this.helpers.appendQueryParameters(b,a),c.extend({Accept:"application/x-gedcomx-v1+json"},g),null,f,d)};e.prototype.post=function(b,a,g,f,d){return this.http("POST",b,c.extend({"Content-Type":"application/x-gedcomx-v1+json"},
g),a,f,d)};e.prototype.put=function(b,a,g,f,d){return this.http("PUT",b,c.extend({"Content-Type":"application/x-gedcomx-v1+json"},g),a,f,d)};e.prototype.del=function(b,a,g,f){return this.http("DELETE",b,c.extend({"Content-Type":"application/x-gedcomx-v1+json"},a),null,g,f)};e.prototype.transformData=function(b,a){if(b&&c.isObject(b)&&"[object FormData]"!==String(b)){if(b=c.clonePartial(b,function(a){return!(c.isString(a)&&("$"===a.charAt(0)||"_"===a.charAt(0)))}),"application/x-www-form-urlencoded"===
a)return d(b);if(a&&-1!==a.indexOf("json"))return JSON.stringify(b)}return b};e.prototype.http=function(b,a,c,f,d,e,r){var h=this.settings.deferredWrapper(),k=h.promise,p=this,t=this.helpers.getAPIServerUrl(a);c=c||{};var v;return v=this.settings.accessToken||!this.settings.autoSignin||this.helpers.isOAuthServerUrl(t)||a===this.settings.discoveryUrl?this.helpers.refPromise(this.settings.accessToken):this.settings.getAccessToken(),v.then(function(){var x=p.helpers.isAuthoritiesServerUrl(t)?"sessionId":
"access_token";if(p.settings.accessToken&&-1===t.indexOf(x+"=")){var w={};w[x]=p.settings.accessToken;t=p.helpers.appendQueryParameters(t,w)}null==r&&(r=p.settings.maxHttpRequestRetries);var y=p.settings.httpWrapper(b,t,c,p.transformData(f,c["Content-Type"]),d||{});p.helpers.extendHttpPromise(k,y);y.then(function(a){"GET"===b&&204===y.getStatusCode()&&(a={});p.helpers.refreshAccessToken();var f=y.getResponseHeader("X-PROCESSING-TIME");f&&(p.totalProcessingTime+=parseInt(f,10));e&&(a=e(a,y));h.resolve(a)},
function(){var t=y.getStatusCode();(p.helpers.log("http failure",t,r,y.getAllResponseHeaders()),401===t&&p.helpers.eraseAccessToken(),"GET"===b&&500<=t&&0<r||429===t)?(t=(t=y.getResponseHeader("Retry-After"))?parseInt(t,10):p.settings.defaultThrottleRetryAfter,p.settings.setTimeout(function(){y=p.http(b,a,c,f,d,e,r-1);p.helpers.extendHttpPromise(k,y);y.then(function(a){h.resolve(a)},function(){h.reject.apply(h,arguments)})},t)):h.reject.apply(h,arguments)})},function(){h.reject.apply(h,arguments)}),
k};k.exports=e},{"./utils":48}],47:[function(e,k,h){var d=e("./FamilySearch"),c=e("./utils"),b=c.maybe;h={setMember:function(a,b){this[a]||(this[a]={});b instanceof d.Person?(this[a].resource=b.$getPersonUrl(),delete this[a].resourceId):this.$helpers.isAbsoluteUrl(b)?(this[a].resource=b,delete this[a].resourceId):c.isString(b)?(this[a].resourceId=b,delete this[a].resource):this[a]=b},deleteMember:function(a,b){this.$deletedMembers||(this.$deletedMembers={});this.$deletedMembers[a]=b;delete this[a]},
setFacts:function(a,b,f){c.isArray(this[a])&&c.forEach(this[a],function(b){h.deleteFact.call(this,a,b,f)},this);this[a]=[];c.forEach(b,function(b){h.addFact.call(this,a,b)},this)},addFact:function(a,b){c.isArray(this[a])||(this[a]=[]);b instanceof d.Fact||(b=this.$client.createFact(b));this[a].push(b)},deleteFact:function(a,g,f){g instanceof d.Fact||(g=c.find(this[a],{id:g}));var l=c.indexOf(this[a],g);0<=l&&((g=this.$helpers.removeAccessToken(b(b(b(g).links).conclusion).href))&&(this.$deletedFacts||
(this.$deletedFacts={}),this.$deletedFacts[g]=f),this[a].splice(l,1))}};k.exports=h},{"./FamilySearch":1,"./utils":48}],48:[function(e,k,h){function d(b,a){for(var c in b)if(b.hasOwnProperty(c)&&a[c]!==b[c])return!1;return!0}h=k.exports;Object.create||(Object.create=function(){function b(){}return function(a){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");return b.prototype=a,new b}}());"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=
"object"==typeof"".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});h.isArray=function(b){return Array.isArray?Array.isArray(b):"[object Array]"==Object.prototype.toString.call(b)};h.isString=function(b){return"[object String]"==Object.prototype.toString.call(b)};h.isFunction=function(b){return"function"!=typeof/./?"function"==typeof b:"[object Function]"==Object.prototype.toString.call(b)};h.isObject=function(b){return b===Object(b)};h.isUndefined=function(b){return void 0===
b};var c=h.forEach=function(b,a,c){if(null!=b)if(Array.prototype.forEach&&b.forEach===Array.prototype.forEach)b.forEach(a,c);else if(b.length===+b.length)for(var f=0,d=b.length;d>f&&a.call(c,b[f],f,b)!=={};f++);else for(f in b)if(b.hasOwnProperty(f)&&a.call(c,b[f],f,b)==={})break};h.removeEmptyProperties=function(b){return c(b,function(a,c){null!=a&&""!==a||delete b[c]}),b};h.keys=Object.keys||function(b){if(b!==Object(b))throw new TypeError("Invalid object");var a=[],c;for(c in b)b.hasOwnProperty(c)&&
a.push(c);return a};h.filter=function(b,a,g){var f=[],l=h.isFunction(a);return c(b,function(b){(l?a.call(g,b):d(a,b))&&f.push(b)}),f};h.map=function(b,a,g){var f=[];return c(b,function(b,c,d){f.push(a.call(g,b,c,d))}),f};h.contains=function(b,a){if(null==b)return!1;if(b.indexOf&&b.indexOf===Array.prototype.indexOf)return-1!==b.indexOf(a);var g=!1;return c(b,function(b){b===a&&(g=!0)}),g};h.indexOf=function(b,a){if(Array.prototype.indexOf===b.indexOf)return b.indexOf(a);for(var c=0,f=b.length;f>c;c++)if(b[c]===
a)return c;return-1};h.uniq=function(b){var a=[];return c(b,function(b){h.contains(a,b)||a.push(b)}),a};h.find=function(b,a,c){var f,l=h.isFunction(a);if(b)for(var e=0,r=b.length;r>e;e++){var k=b[e];if(l?a.call(c,k):d(a,k)){f=k;break}}return f};h.findIndex=function(b,a,c){var f=-1,l=h.isFunction(a);if(b)for(var e=0,r=b.length;r>e;e++){var k=b[e];if(l?a.call(c,k):d(a,k)){f=e;break}}return f};h.compose=function(){var b=arguments;return function(){for(var a=arguments,c=b.length-1;0<=c;c--)b[c]&&(a=[b[c].apply(this,
a)]);return a[0]}};h.flatten=function(b){var a=[];return c(b,function(b){h.isArray(b)&&Array.prototype.push.apply(a,b)}),a};h.flatMap=h.compose(h.flatten,h.map);h.union=function(){return h.uniq(h.flatten(arguments))};h.findOrFirst=function(b,a){if(!h.isUndefined(b)){var c=h.find(b,a);return h.isUndefined(c)?b[0]:c}};h.extend=function(b){return b=b||{},c(Array.prototype.slice.call(arguments,1),function(a){a&&c(a,function(a,f){b[f]=a})}),b};h.partialRight=function(b){var a=Array.prototype.slice.call(arguments,
1);return function(){return b.apply(this,Array.prototype.slice.call(arguments).concat(a))}};h.partial=function(b){var a=Array.prototype.slice.call(arguments,1);return function(){return b.apply(this,a.concat(Array.prototype.slice.call(arguments)))}};h.maybe=function(b){return null!=b?b:{}};h.clonePartial=function(b,a){var c;if(null==b||"object"!=typeof b)return b;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){c=[];for(var f=0,d=b.length;d>f;f++)a&&!a(f)||c.push(h.clonePartial(b[f],
a));return c}if(b instanceof Object){c=Object.create(Object.getPrototypeOf(b));for(f in b)!b.hasOwnProperty(f)||a&&!a(f)||(c[f]=h.clonePartial(b[f],a));return c}throw Error("Unable to copy obj");};h.objectExtender=function(b,a){return function(g){return g&&(a?c(a(g),function(a){h.extend(a,h.isFunction(b)?b(g,a):b)}):h.extend(g,h.isFunction(b)?b(g,g):b)),g}};h.appFieldRejector=function(b){return!(h.isString(b)&&"_"===b.charAt(0))};h.deletePropertiesPartial=function(b,a){for(var c in b)!b.hasOwnProperty(c)||
a&&!a(c)||delete b[c]};h.wrapFunctions=function(b,a,g){return c(g,function(f){b[f]=function(){return a[f].apply(a,arguments)}}),b}},{}]},{},[1])(1)});var Main;
(function(m){var e=Model.Definitions.Standard.StandardFactory,k=Model.Definitions.FamilyHistory.AncestorFactory,h=Presenter.AncestorPresenter,d=Presenter.StandardPresenter,c=Model.Generator.Definitions.StandardMazeCreator,b=Model.Generator.Definitions.AncestorMazeCreator,a=function(){function a(b){this.initVariables(b);this.initMoves()}a.Main=function(){new a("standard")};a.create=function(b){return new a(b)};a.prototype.initMoves=function(){this.moves={37:this.factory.createMove("left"),38:this.factory.createMove("up"),
40:this.factory.createMove("down"),39:this.factory.createMove("right"),65:this.factory.createMove("left"),87:this.factory.createMove("up"),83:this.factory.createMove("down"),68:this.factory.createMove("right")}};a.prototype.initVariables=function(a){if(a.valueOf()=="standard".valueOf())this.factory=new e,this.model=(new c(this.factory,19)).createMaze(45,45),this.presenter=new d(this.model);else if(a.valueOf()=="ancestor".valueOf()){this.factory=new k;a=document.getElementsByClassName("popupImage");
for(var g=[],n=0;n<a.length;n++)g.push(a[n].id);for(n=0;50>n;n++){var r=Math.floor(Math.random()*a.length),q=Math.floor(Math.random()*a.length),u=g[r];g[r]=g[q];g[q]=u}r=new b(this.factory,a.length);for(n=0;n<a.length;n++){for(var q=g[n],p=u="",m=0;m<q.length;m++){var v=q.charAt(m);"A"<=v&&"Z">=v&&(u=u.concat(p));u=u.concat(v);p=" "}r.addKey(u)}this.model=r.createMaze(45,45);this.presenter=new h(this.model,this.factory)}};a.prototype.setGender=function(a){this.presenter.setGender(a);this.presenter.executeMove(this.factory.createMove("none"))};
a.prototype.onKeyDown=function(a){this.presenter.isInPopup()||this.presenter.executeMove(this.moves[a.keyCode])};a.prototype.enterName=function(a){this.presenter.enterName(a)};a.prototype.leavePopup=function(){this.presenter.leavePopup()};return a}();m.KrazeClient=a})(Main||(Main={}));!function(m){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=m();else if("function"==typeof define&&define.amd)define([],m);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.FamilySearch=m()}}(function(){return function e(k,h,d){function c(a,f){if(!h[a]){if(!k[a]){var l="function"==typeof require&&require;if(!f&&l)return l(a,!0);if(b)return b(a,!0);l=Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",
l;}l=h[a]={exports:{}};k[a][0].call(l.exports,function(b){var f=k[a][1][b];return c(f?f:b)},l,l.exports,e,k,h,d)}return h[a].exports}for(var b="function"==typeof require&&require,a=0;a<d.length;a++)c(d[a]);return c}({1:[function(e,k,h){function d(a,b){q.prototype[b]=function(){return this[a][b].apply(this[a],arguments)}}var c=e("./globals"),b=e("./utils"),a=e("./angularjs-wrappers"),g=e("./jquery-wrappers"),f=e("./nodejs-wrappers"),l=e("./helpers"),n=e("./plumbing"),r=0,q=k.exports=function(d){var e=
this;e.settings=b.extend(e.settings,c);e.settings.instanceId=++r;e.helpers=new l(e);e.plumbing=new n(e);d=d||{};if(!d.client_id&&!d.app_key)throw"client_id must be set";e.settings.clientId=d.client_id||d.app_key;if(!d.environment)throw"environment must be set";e.settings.environment=d.environment;if(!d.http_function&&!window.jQuery)throw"http must be set; e.g., jQuery.ajax";var h=d.http_function||window.jQuery.ajax;e.settings.httpWrapper=h.pendingRequests?a.httpWrapper(h,e):h.cookie?f.httpWrapper(h,
e):g.httpWrapper(h,e);if(!d.deferred_function&&!window.jQuery)throw"deferred_function must be set; e.g., jQuery.Deferred";var h=d.deferred_function||window.jQuery.Deferred,k=h();k.resolve();b.isFunction(k.promise)?e.settings.deferredWrapper=g.deferredWrapper(h):b.isFunction(h.nfcall)?e.settings.deferredWrapper=f.deferredWrapper(h):e.settings.deferredWrapper=a.deferredWrapper(h);var q=d.timeout_function;q?(e.settings.setTimeout=function(a,b){return q(a,b)},e.settings.clearTimeout=function(a){q.cancel(a)}):
(e.settings.setTimeout=function(a,b){return setTimeout(a,b)},e.settings.clearTimeout=function(a){clearTimeout(a)});e.settings.redirectUri=d.redirect_uri||d.auth_callback;e.settings.autoSignin=d.auto_signin;e.settings.autoExpire=d.auto_expire;e.settings.expireCallback=d.expire_callback;d.save_access_token&&(e.settings.saveAccessToken=!0,e.helpers.readAccessToken());d.access_token&&(e.settings.accessToken=d.access_token);e.settings.debug=d.debug;e.settings.discoveryPromise=e.plumbing.get(e.settings.discoveryUrl);
e.settings.discoveryPromise.then(function(a){e.settings.discoveryResource=a})};e("./modules/authorities");e("./modules/authentication");e("./modules/changeHistory");e("./modules/discussions");e("./modules/memories");e("./modules/notes");e("./modules/parentsAndChildren");e("./modules/pedigree");e("./modules/persons");e("./modules/redirect");e("./modules/searchAndMatch");e("./modules/sourceBox");e("./modules/sources");e("./modules/spouses");e("./modules/users");e("./classes/base");e("./classes/agent");
e("./classes/attribution");e("./classes/change");e("./classes/childAndParents");e("./classes/collection");e("./classes/comment");e("./classes/couple");e("./classes/date");e("./classes/discussion");e("./classes/discussionRef");e("./classes/fact");e("./classes/memoryArtifactRef");e("./classes/memoryPersona");e("./classes/memoryPersonaRef");e("./classes/memory");e("./classes/name");e("./classes/note");e("./classes/person");e("./classes/place");e("./classes/searchResult");e("./classes/sourceDescription");
e("./classes/sourceRef");e("./classes/user");d("plumbing","del");d("plumbing","get");d("plumbing","getTotalProcessingTime");d("plumbing","getUrl");d("plumbing","http");d("plumbing","post");d("plumbing","put");d("plumbing","setTotalProcessingTime")},{"./angularjs-wrappers":2,"./classes/agent":3,"./classes/attribution":4,"./classes/base":5,"./classes/change":6,"./classes/childAndParents":7,"./classes/collection":8,"./classes/comment":9,"./classes/couple":10,"./classes/date":11,"./classes/discussion":12,
"./classes/discussionRef":13,"./classes/fact":14,"./classes/memory":15,"./classes/memoryArtifactRef":16,"./classes/memoryPersona":17,"./classes/memoryPersonaRef":18,"./classes/name":19,"./classes/note":20,"./classes/person":21,"./classes/place":22,"./classes/searchResult":23,"./classes/sourceDescription":24,"./classes/sourceRef":25,"./classes/user":26,"./globals":27,"./helpers":28,"./jquery-wrappers":29,"./modules/authentication":30,"./modules/authorities":31,"./modules/changeHistory":32,"./modules/discussions":33,
"./modules/memories":34,"./modules/notes":35,"./modules/parentsAndChildren":36,"./modules/pedigree":37,"./modules/persons":38,"./modules/redirect":39,"./modules/searchAndMatch":40,"./modules/sourceBox":41,"./modules/sources":42,"./modules/spouses":43,"./modules/users":44,"./nodejs-wrappers":45,"./plumbing":46,"./utils":48}],2:[function(e,k,h){var d=e("./utils");h={httpWrapper:function(c,b){return function(a,g,f,l,e){var h=d.extend({method:a,url:g,responseType:"json",data:l,transformRequest:function(a){return a}},
e);h.headers=d.extend({},f,e.headers);"multipart/form-data"===h.headers["Content-Type"]&&(h.headers["Content-Type"]=void 0);a=c(h);var k=b.settings.deferredWrapper();g=k.promise;var u=null,p=null;a.then(function(a){u=a.status;p=a.headers;k.resolve(a.data)},function(a){u=a.status;p=a.headers;k.reject(a)});g.getStatusCode=function(){return u};g.getResponseHeader=function(a){return p(a)};g.getAllResponseHeaders=function(){return p()};g.getRequest=function(){return h};return g}},deferredWrapper:function(c){return function(){var b=
c();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}}};k.exports=h},{"./utils":48}],3:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.Agent=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createAgent=function(a){return new b(this,a)};b.prototype={constructor:b,$getName:function(){return c(c(this.names)[0]).value},$getAccountName:function(){return c(c(this.accounts)[0]).accountName},$getEmail:function(){var a=c(c(this.emails)[0]).resource;return a?a.replace(/^mailto:/,
""):a},$getPhoneNumber:function(){return c(c(this.phones)[0]).resource},$getAddress:function(){return c(c(this.addresses)[0]).value}}},{"./../FamilySearch":1,"./../utils":48}],4:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Attribution=function(a,b){d.BaseClass.call(this,a,b);c.isString(b)&&(this.changeMessage=b)};d.prototype.createAttribution=function(b){return new a(this,b)};a.prototype={constructor:a,$getAgentId:function(){return b(this.contributor).resourceId},
$getAgentUrl:function(){return this.$client.helpers.removeAccessToken(b(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())}}},{"./../FamilySearch":1,"./../utils":48}],5:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils");k.BaseClass=function(c,b){d.isObject(b)&&d.extend(this,b);this.$client=c;this.$helpers=c.helpers;this.$plumbing=c.plumbing;this.$serialize=function(){return JSON.stringify(this,function(a,b){if(0!==a.indexOf("$"))return b})}}},
{"./../FamilySearch":1,"./../utils":48}],6:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.Change=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createChange=function(a){return new b(this,a)};b.prototype={constructor:b,$getAgentName:function(){return c(c(this.contributors)[0]).name},$getChangeReason:function(){return c(c(this.changeInfo)[0]).reason},$getAgentUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links).agent).href)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl())},
$restore:function(a){return this.$client.changeHistory.restoreChange(this.id,a)}}},{"./../FamilySearch":1,"./../utils":48}],7:[function(e,k,h){var d=e("../FamilySearch"),c=e("../relationshipHelpers"),b=e("../utils"),a=b.maybe,g=d.ChildAndParents=function(a,c){d.BaseClass.call(this,a,c);c&&(c.$father&&(this.$setFather(c.$father),delete this.$father),c.$mother&&(this.$setMother(c.$mother),delete this.$mother),c.$child&&(this.$setChild(c.$child),delete this.$child),c.fatherFacts&&b.forEach(this.fatherFacts,
function(b,c){b instanceof d.Fact||(this.fatherFacts[c]=a.createFact(b))},this),c.motherFacts&&b.forEach(this.motherFacts,function(b,c){b instanceof d.Fact||(this.motherFacts[c]=a.createFact(b))},this))};d.prototype.createChildAndParents=function(a){return new g(this,a)};g.prototype={constructor:g,$getChildAndParentsUrl:function(){return this.$helpers.removeAccessToken(a(a(this.links).relationship).href)},$getFatherFacts:function(){return this.fatherFacts||[]},$getMotherFacts:function(){return this.motherFacts||
[]},$getFatherId:function(){return a(this.father).resourceId},$getFatherUrl:function(){return this.$helpers.removeAccessToken(a(this.father).resource)},$getFather:function(){return this.$client.getPerson(this.$getFatherUrl()||this.$getFatherId())},$getMotherId:function(){return a(this.mother).resourceId},$getMotherUrl:function(){return this.$helpers.removeAccessToken(a(this.mother).resource)},$getMother:function(){return this.$client.getPerson(this.$getMotherUrl()||this.$getMotherId())},$getChildId:function(){return a(this.child).resourceId},
$getChildUrl:function(){return this.$helpers.removeAccessToken(a(this.child).resource)},$getChild:function(){return this.$client.getPerson(this.$getChildUrl()||this.$getChildId())},$getNotes:function(){return this.$client.getChildAndParentsNotes(this.$helpers.removeAccessToken(a(a(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getChildAndParentsSourceRefs(this.id)},$getSources:function(){return this.$client.getChildAndParentsSourcesQuery(this.id)},$getChanges:function(){return this.$client.getChildAndParentsChanges(this.$helpers.removeAccessToken(a(this.links["change-history"]).href))},
$setFather:function(a){c.setMember.call(this,"father",a);this.$fatherChanged=!0;return this},$setMother:function(a){c.setMember.call(this,"mother",a);this.$motherChanged=!0;return this},$setChild:function(a){c.setMember.call(this,"child",a);return this},$deleteFather:function(a){c.deleteMember.call(this,"father",a);return this},$deleteMother:function(a){c.deleteMember.call(this,"mother",a);return this},$setFatherFacts:function(a,b){c.setFacts.call(this,"fatherFacts",a,b);return this},$addFatherFact:function(a){c.addFact.call(this,
"fatherFacts",a);return this},$deleteFatherFact:function(a,b){c.deleteFact.call(this,"fatherFacts",a,b);return this},$setMotherFacts:function(a,b){c.setFacts.call(this,"motherFacts",a,b);return this},$addMotherFact:function(a){c.addFact.call(this,"motherFacts",a);return this},$deleteMotherFact:function(a,b){c.deleteFact.call(this,"motherFacts",a,b);return this},$save:function(a,g,d){var e=this.$client.createChildAndParents(),h=!1,k=this.id,p=this;if(!this.id||this.$fatherChanged)e.father=this.father,
h=!0;if(!this.id||this.$motherChanged)e.mother=this.mother,h=!0;this.id||(e.child=this.child,h=!0);a&&(e.attribution=p.$client.createAttribution(a));b.forEach(["fatherFacts","motherFacts"],function(a){b.forEach(p[a],function(b){k&&b.id&&!b.$changed||(c.addFact.call(e,a,b),h=!0)})});var t=[];h&&t.push(p.$helpers.chainHttpPromises(k?p.$plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:k}):p.$plumbing.getUrl("relationships"),function(a){b.forEach(["father","mother","child"],function(a){e[a]&&
!e[a].resource&&e[a].resourceId&&(e[a].resource=e[a].resourceId)});return p.$plumbing.post(a,{childAndParentsRelationships:[e]},{"Content-Type":"application/x-fs-v1+json"},d,p.$helpers.getResponseEntityId)}));b.forEach(["father","mother"],function(b){if(p.id&&p.$deletedMembers&&p.$deletedMembers.hasOwnProperty(b)&&!p[b]){var c=p.$deletedMembers[b]||a;t.push(p.$helpers.chainHttpPromises(p.$plumbing.getUrl("child-and-parents-relationship-parent-template",null,{caprid:k,role:b}),function(a){var b={"Content-Type":"application/x-fs-v1+json"};
c&&(b["X-Reason"]=c);return p.$plumbing.del(a,b,d)}))}});k&&p.$deletedFacts&&b.forEach(p.$deletedFacts,function(b,c){b=b||a;var g={"Content-Type":"application/x-fs-v1+json"};b&&(g["X-Reason"]=b);t.push(p.$plumbing.del(c,g,d))});var v=p.$helpers.promiseAll(t).then(function(a){var c=k?k:a[0];p.$helpers.extendHttpPromise(v,t[0]);return g?p.$client.getChildAndParents(c,{},d).then(function(a){b.deletePropertiesPartial(p,b.appFieldRejector);b.extend(p,a.getRelationship());return c}):c});return v},$delete:function(a,
b){return this.$client.deleteChildAndParents(this.$getChildAndParentsUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../relationshipHelpers":47,"../utils":48}],8:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Collection=function(a,b){d.BaseClass.call(this,a,b);b&&b.attribution&&(this.attribution=a.createAttribution(b.attribution))};d.prototype.createCollection=function(b){return new a(this,b)};a.prototype={constructor:a,$getCollectionUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).self).href)},
$getSourceDescriptions:function(a){return this.$client.getCollectionSourceDescriptions(this.$helpers.removeAccessToken(this.links["source-descriptions"].href),a)},$save:function(a,b){var d=this,e=d.$helpers.chainHttpPromises(d.id?d.$plumbing.getUrl("user-collection-template",null,{udcid:d.id}):d.$plumbing.getUrl("user-collections"),function(a){return d.$plumbing.post(a,{collections:[d]},{},b,function(a,b){return d.id||b.getResponseHeader("X-ENTITY-ID")})}),h=e.then(function(k){d.$helpers.extendHttpPromise(h,
e);return a?d.$client.getCollection(k,{},b).then(function(a){c.deletePropertiesPartial(d,c.appFieldRejector);c.extend(d,a.getCollection());return k}):k});return h},$delete:function(a){return this.$client.deleteCollection(this.$getCollectionUrl()||this.id,a)}}},{"./../FamilySearch":1,"./../utils":48}],9:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.Comment=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createComment=function(a){return new b(this,a)};b.prototype={constructor:b,
$getCommentUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links).comment).href)},$getAgentId:function(){return c(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(c(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(a,b){var c=this;return c.$helpers.chainHttpPromises(c.$plumbing.getUrl(this.$memoryId?"memory-comments-template":"discussion-comments-template",
null,{did:c.$discussionId,mid:c.$memoryId}),function(a){return c.$plumbing.post(a,{discussions:[{comments:[c]}]},{"Content-Type":"application/x-fs-v1+json"},b,function(a,b){c.id||(c.id=b.getResponseHeader("X-ENTITY-ID"));c.$getCommentUrl()||(c.links={comment:{href:b.getResponseHeader("Location")}});return c.id})})},$delete:function(a,b){return this.$discussionId?this.$client.deleteDiscussionComment(this.$getCommentUrl()||this.$discussionId,this.id,a,b):this.$client.deleteMemoryComment(this.$getCommentUrl()||
this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],10:[function(e,k,h){var d=e("../FamilySearch"),c=e("../relationshipHelpers"),b=e("../utils"),a=b.maybe,g=d.Couple=function(a,c){d.BaseClass.call(this,a,c);c&&(c.$husband&&this.$setHusband(c.$husband),c.$wife&&this.$setWife(c.$wife),c.facts&&b.forEach(this.facts,function(b,c){b instanceof d.Fact||(this.facts[c]=a.createFact(b))},this))};d.prototype.createCouple=function(a){return new g(this,a)};g.prototype={constructor:g,$getCoupleUrl:function(){return this.$helpers.removeAccessToken(a(a(this.links).relationship).href)},
$getFacts:function(){return this.facts||[]},$getMarriageFact:function(){return b.find(this.facts,{type:"http://gedcomx.org/Marriage"})},$getHusbandId:function(){return a(this.person1).resourceId},$getHusbandUrl:function(){return this.$helpers.removeAccessToken(a(this.person1).resource)},$getHusband:function(){return this.$client.getPerson(this.$getHusbandUrl()||this.$getHusbandId())},$getWifeId:function(){return a(this.person2).resourceId},$getWifeUrl:function(){return this.$helpers.removeAccessToken(a(this.person2).resource)},
$getWife:function(){return this.$client.getPerson(this.$getWifeUrl()||this.$getWifeId())},$getSpouseId:function(b){return a(this.person1).resourceId===b?a(this.person2).resourceId:a(this.person1).resourceId},$getSpouseUrl:function(b){return a(this.person1).resourceId===b?this.$helpers.removeAccessToken(a(this.person2).resource):this.$helpers.removeAccessToken(a(this.person1).resource)},$getSpouse:function(a){return this.$client.getPerson(this.$getSpouseUrl(a)||this.$getSpouseId(a))},$getNotes:function(){return this.$client.getCoupleNotes(this.$helpers.removeAccessToken(a(a(this.links).notes).href))},
$getSourceRefs:function(){return this.$client.getCoupleSourceRefs(this.id)},$getSources:function(){return this.$client.getCoupleSourcesQuery(this.id)},$getChanges:function(){return this.$client.getCoupleChanges(this.$helpers.removeAccessToken(a(this.links["change-history"]).href))},$setHusband:function(a){c.setMember.call(this,"person1",a);this.$husbandChanged=!0;return this},$setWife:function(a){c.setMember.call(this,"person2",a);this.$wifeChanged=!0;return this},$setFacts:function(a,b){c.setFacts.call(this,
"facts",a,b);return this},$addFact:function(a){c.addFact.call(this,"facts",a);return this},$deleteFact:function(a,b){c.deleteFact.call(this,"facts",a,b);return this},$save:function(a,g,d){var e=this.$client.createCouple(),h=!1,k=this.id,p=this;if(!this.id||this.$husbandChanged||this.$wifeChanged)e.person1=this.person1,e.person2=this.person2,h=!0;a&&(e.attribution=p.$client.createAttribution(a));b.forEach(this.facts,function(a){k&&a.id&&!a.$changed||(c.addFact.call(e,"facts",a),h=!0)});var t=[];h&&
(k||(e.type="http://gedcomx.org/Couple"),t.push(p.$helpers.chainHttpPromises(k?p.$plumbing.getUrl("couple-relationship-template",null,{crid:k}):p.$plumbing.getUrl("relationships"),function(a){b.forEach(["person1","person2"],function(a){e[a]&&!e[a].resource&&e[a].resourceId&&(e[a].resource=e[a].resourceId)});return p.$plumbing.post(a,{relationships:[e]},{},d,p.$helpers.getResponseEntityId)})));k&&this.$deletedFacts&&b.forEach(this.$deletedFacts,function(b,c){b=b||a;t.push(p.$plumbing.del(c,b?{"X-Reason":b}:
{},d))});var v=this,x=p.$helpers.promiseAll(t).then(function(a){var c=k?k:a[0];p.$helpers.extendHttpPromise(x,t[0]);return g?p.$client.getCouple(c,{},d).then(function(a){b.deletePropertiesPartial(v,b.appFieldRejector);b.extend(v,a.getRelationship());return c}):c});return x},$delete:function(a,b){return this.$client.deleteCouple(this.$getCoupleUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../relationshipHelpers":47,"../utils":48}],11:[function(e,k,h){var d=e("./../FamilySearch"),c=function(a,b){var c=
"",d="",e="",h="",k,u="+",p=0;"about"===a[p]?(b||(c="A"),p++):"before"===a[p]?(b||(c="A/"),p++):"after"===a[p]&&(b||(c="A",d="/"),p++);2>=a[p].length&&(e=(1===a[p].length?"0":"")+a[p],p++);k="january february march april may june july august september october november december".split(" ").indexOf(a[p])+1;0<k&&(h=(10>k?"0":"")+k.toString(),p++);k=a[p];p++;p<a.length&&"bc"===a[p]&&(u="-");return c+u+k+(h?"-":"")+h+(e?"-":"")+e+d},b=d.Date=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createDate=
function(a){return new b(this,a)};b.prototype={constructor:b,$getFormalDate:function(){var a="";if(this.normalized){var a=this.normalized.trim().toLowerCase().split(" "),b=a.indexOf("/");0<=b&&(a=a.slice(0,b));"from"===a[0]?(b=a.indexOf("to"),a=c(a.slice(1,b),!0)+"/"+c(a.slice(b+1),!0)):a=c(a,!1)}return a}}},{"./../FamilySearch":1}],12:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Discussion=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createDiscussion=function(b){return new a(this,
b)};a.prototype={constructor:a,$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).discussion).href)},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).comments).href)},$getComments:function(){return this.$client.getDiscussionComments(this.$getCommentsUrl())},$getAgentId:function(){return b(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(b(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||
this.$getAgentId())},$save:function(a,b,d){var e=this,h=e.$helpers.chainHttpPromises(e.id?e.$plumbing.getUrl("discussion-template",null,{did:e.id}):e.$plumbing.getUrl("discussions"),function(a){return e.$plumbing.post(a,{discussions:[e]},{"Content-Type":"application/x-fs-v1+json"},d,function(a,b){return e.id||b.getResponseHeader("X-ENTITY-ID")})}),k=h.then(function(a){e.$helpers.extendHttpPromise(k,h);return b?e.$client.getDiscussion(a,{},d).then(function(b){c.deletePropertiesPartial(e,c.appFieldRejector);
c.extend(e,b.getDiscussion());return a}):a});return k},$delete:function(a,b){return this.$client.deleteDiscussion(this.$getDiscussionUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],13:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.DiscussionRef=function(a,b){d.BaseClass.call(this,a,b);b&&b.discussion&&this.$setDiscussion(b.discussion)};d.prototype.createDiscussionRef=function(a){return new b(this,a)};b.prototype={constructor:b,$getDiscussionRefUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links)["discussion-reference"]).href)},
$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getDiscussion:function(){return this.$client.getDiscussion(this.$getDiscussionUrl()||this.resourceId)},$setDiscussion:function(a){a instanceof d.Discussion?(this.resource=a.$getDiscussionUrl(),this.resourceId=a.id):this.$helpers.isAbsoluteUrl(a)?this.resource=this.$helpers.removeAccessToken(a):this.resourceId=a;return this},$save:function(a,b){var c=this;return c.$helpers.chainHttpPromises(c.$plumbing.getUrl("person-discussion-references-template",
null,{pid:c.$personId}),function(d){!c.resource&&c.resourceId&&(c.resource=c.resourceId);var e={persons:[{id:c.$personId,"discussion-references":[{resource:c.resource}]}]};a&&(e.persons[0].attribution=c.$client.createAttribution(a));return c.$plumbing.post(d,e,{"Content-Type":"application/x-fs-v1+json"},b,function(a,b){c.$getDiscussionRefUrl()||(c.links={"discussion-reference":{href:b.getResponseHeader("Location"),title:"Discussion Reference"}});return c.$getDiscussionRefUrl()})})},$delete:function(a,
b){return this.$client.deleteDiscussionRef(this.$getDiscussionRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],14:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Fact=function(a,b){d.BaseClass.call(this,a,b);b&&(b.$date&&(this.$setDate(b.$date),delete this.$date),b.$formalDate&&(this.$setFormalDate(b.$formalDate),delete this.$formalDate),b.$place&&(this.$setPlace(b.$place),delete this.$place),b.$normalizedPlace&&(this.$setNormalizedPlace(b.$normalizedPlace),
delete this.$normalizedPlace),b.$changeMessage&&(this.$setChangeMessage(b.$changeMessage),delete this.$changeMessage),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createFact=function(b){return new a(this,b)};a.prototype={constructor:a,$getDate:function(){return b(this.date).original},$getNormalizedDate:function(){return b(b(b(this.date).normalized)[0]).value},$getFormalDate:function(){return b(this.date).formal},$getPlace:function(){return b(this.place).original},
$getNormalizedPlace:function(){return b(b(b(this.place).normalized)[0]).value},$getNormalizedPlaceId:function(){var a=b(this.place).description;return a&&"#"===a.charAt(0)?a.substr(1):""},$isCustomNonEvent:function(){if(this.qualifiers){var a=c.find(this.qualifiers,{name:"http://familysearch.org/v1/Event"});return!!a&&"false"===a.value}return!1},$setType:function(a){this.$changed=!0;this.type=a;return this},$setCustomNonEvent:function(a){a?(this.qualifiers||(this.qualifiers=[]),a=c.findIndex(this.qualifiers,
{name:"http://familysearch.org/v1/Event"}),0>a&&(a=this.qualifiers.push({name:"http://familysearch.org/v1/Event"})-1),this.qualifiers[a].value="false"):this.qualifiers&&(a=c.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),0<=a&&this.qualifiers.splice(a,1),0===this.qualifiers.length&&delete this.qualifiers);this.$changed=!0;return this},$setDate:function(a){this.$changed=!0;var b;c.isString(a)?b=a:a instanceof d.Date?(b=a.original,this.$setFormalDate(a.$getFormalDate()),this.$setNormalizedDate(a.normalized)):
c.isObject(a)&&(b=a.$original,this.$setFormalDate(a.$formal),this.$setNormalizedDate(a.$normalized));b?(this.date||(this.date={}),this.date.original=b):delete this.date;return this},$setFormalDate:function(a){this.$changed=!0;a?(this.date||(this.date={}),this.date.formal=a):this.date&&delete this.date.formal;return this},$setNormalizedDate:function(a){this.$changed=!0;a?(this.date||(this.date={}),this.date.normalized=[{value:a}]):this.date&&delete this.date.normalized;return this},$setPlace:function(a){this.$changed=
!0;var b;c.isString(a)||null==a?b=a:a instanceof d.Place?(b=a.original,this.$setNormalizedPlace(a.$getNormalizedPlace())):c.isObject(a)&&(b=a.$original,this.$setNormalizedPlace(a.$normalized));b?(this.place||(this.place={}),this.place.original=b):delete this.place;return this},$setNormalizedPlace:function(a){this.$changed=!0;a?(this.place||(this.place={}),this.place.normalized=[{value:a}]):this.place&&delete this.place.normalized;return this},$setChangeMessage:function(a){this.attribution=this.$client.createAttribution(a);
return this}}},{"./../FamilySearch":1,"./../utils":48}],15:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Memory=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemory=function(b){return new a(this,b)};a.prototype={constructor:a,$getTitle:function(){return b(b(this.titles)[0]).value},$getDescription:function(){return b(b(this.description)[0]).value},$getIconUrl:function(){return this.$helpers.appendAccessToken(b(b(this.links)["image-icon"]).href)},$getThumbnailUrl:function(){return this.$helpers.appendAccessToken(b(b(this.links)["image-thumbnail"]).href)},
$getImageUrl:function(){return this.$helpers.appendAccessToken(b(b(this.links).image).href)},$getMemoryArtifactUrl:function(){return this.$helpers.appendAccessToken(this.$helpers.removeAccessToken(this.about))},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).description).href)},$getArtifactFilename:function(){return b(b(this.artifactMetadata)[0]).filename},$getArtifactType:function(){return b(b(this.artifactMetadata)[0]).artifactType},$getArtifactHeight:function(){return b(b(this.artifactMetadata)[0]).height},
$getArtifactWidth:function(){return b(b(this.artifactMetadata)[0]).width},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).comments).href)},$getComments:function(){return this.$client.getMemoryComments(this.$getCommentsUrl()||this.id)},$setTitle:function(a){this.titles=[{value:a}];return this},$setDescription:function(a){this.description=[{value:a}];return this},$setArtifactFilename:function(a){c.isArray(this.artifactMetadata)&&this.artifactMetadata.length||(this.artifactMetadata=
[{}]);this.artifactMetadata[0].filename=a;return this},$save:function(a,b,d){var e=this,h=e.$helpers.chainHttpPromises(e.id?e.$plumbing.getUrl("memory-template",null,{mid:e.id}):e.$plumbing.getUrl("memories"),function(a){if(e.id)return e.$plumbing.post(a,{sourceDescriptions:[e]},{},d,function(){return e.id});var b={};e.$getTitle()&&(b.title=e.$getTitle());e.$getDescription()&&(b.description=e.$getDescription());e.$getArtifactFilename()&&(b.filename=e.$getArtifactFilename());return e.$plumbing.post(e.$helpers.appendQueryParameters(a,
b),e.$data,{"Content-Type":c.isString(e.$data)?"text/plain":"multipart/form-data"},d,e.$helpers.getResponseEntityId)}),k=h.then(function(a){e.$helpers.extendHttpPromise(k,h);return b?e.$client.getMemory(a,{},d).then(function(b){c.deletePropertiesPartial(e,c.appFieldRejector);c.extend(e,b.getMemory());return a}):a});return k},$delete:function(a,b){return this.$client.deleteMemory(this.$getMemoryUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],16:[function(e,k,h){var d=e("./../FamilySearch"),
c=e("./../utils"),b=c.maybe,a=d.MemoryArtifactRef=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemoryArtifactRef=function(b){return new a(this,b)};a.prototype={constructor:a,$getQualifierName:function(){return b(b(this.qualifiers)[0]).name},$getQualifierValue:function(){return b(b(this.qualifiers)[0]).value},$setQualifierName:function(a){c.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]);this.qualifiers[0].name=a;return this},$setQualifierValue:function(a){c.isArray(this.qualifiers)&&
this.qualifiers.length||(this.qualifiers=[{}]);this.qualifiers[0].value=a;return this}}},{"./../FamilySearch":1,"./../utils":48}],17:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.MemoryPersona=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemoryPersona=function(b){return new a(this,b)};a.prototype={constructor:a,$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).persona).href)},$getMemoryArtifactRef:function(){return b(this.media)[0]},
$getName:function(){return b(this.names)[0]},$getDisplayName:function(){return b(this.display).name},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(b(this.$getMemoryArtifactRef()).description)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl()||this.$memoryId)},$setName:function(a){a instanceof d.Name||(a=this.$client.createName(a));this.names=[a];return this},$setMemoryArtifactRef:function(a){this.media=[a];return this},$save:function(a,b,d){var e=this,h=e.$helpers.chainHttpPromises(e.$plumbing.getUrl(e.id?
"memory-persona-template":"memory-personas-template",null,{mid:e.$memoryId,pid:e.id}),function(a){if(!e.$getMemoryArtifactRef()){var b=e.$helpers.getUrlFromDiscoveryResource(e.$client.settings.discoveryResource,"memory-template",{mid:e.$memoryId});e.$setMemoryArtifactRef(e.$client.createMemoryArtifactRef({description:b}))}return e.$plumbing.post(a,{persons:[e]},{},d,function(a,b){return e.$getMemoryPersonaUrl()||e.$helpers.removeAccessToken(b.getResponseHeader("Location"))})}),k=h.then(function(a){e.$helpers.extendHttpPromise(k,
h);return b?e.$client.getMemoryPersona(a,null,{},d).then(function(b){c.deletePropertiesPartial(e,c.appFieldRejector);c.extend(e,b.getMemoryPersona());return a}):a});return k},$delete:function(a,b){return this.$client.deleteMemoryPersona(this.$getMemoryPersonaUrl()||this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],18:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils").maybe,b=d.MemoryPersonaRef=function(a,b){d.BaseClass.call(this,a,b);b&&b.$memoryPersona&&this.$setMemoryPersona(b.$memoryPersona)};
d.prototype.createMemoryPersonaRef=function(a){return new b(this,a)};b.prototype={constructor:b,$getMemoryPersonaRefUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links)["evidence-reference"]).href)},$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getMemoryPersona:function(){return this.$client.getMemoryPersona(this.$getMemoryPersonaUrl())},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(c(c(this.links).memory).href)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl())},
$setMemoryPersona:function(a){a instanceof d.MemoryPersona&&(a=a.$getMemoryPersonaUrl());this.resource=this.$helpers.removeAccessToken(a);return this},$save:function(a,b){var c=this;return c.$helpers.chainHttpPromises(c.$plumbing.getUrl("person-memory-persona-references-template",null,{pid:c.$personId}),function(a){return c.$plumbing.post(a,{persons:[{evidence:[c]}]},{},b,function(a,b){c.id||(c.id=b.getResponseHeader("X-ENTITY-ID"));c.$getMemoryPersonaRefUrl()||(c.links={"evidence-reference":{href:b.getResponseHeader("Location")}});
return c.$getMemoryPersonaRefUrl()})})},$delete:function(a,b){return this.$client.deleteMemoryPersonaRef(this.$getMemoryPersonaRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],19:[function(e,k,h){function d(a,c){var d=c||0;b.isArray(a.nameForms)||(a.nameForms=[]);for(;d>=a.nameForms.length;)a.nameForms.push({});return a.nameForms[d]}var c=e("./../FamilySearch"),b=e("./../utils"),a=b.maybe,g=c.Name=function(a,d){c.BaseClass.call(this,a,d);d&&(b.isString(d)?this.$setFullText(d):
(d.type&&this.$setType(d.type),d.$givenName&&(this.$setGivenName(d.$givenName),delete this.$givenName),d.$surname&&(this.$setSurname(d.$surname),delete this.$surname),d.$prefix&&(this.$setPrefix(d.$prefix),delete this.$prefix),d.$suffix&&(this.$setSuffix(d.$suffix),delete this.$suffix),d.$fullText&&(this.$setFullText(d.$fullText),delete this.$fullText),this.$setPreferred(!!d.preferred),d.$changeMessage&&(this.$setChangeMessage(d.$changeMessage),delete this.$changeMessage),!d.attribution||d.attribution instanceof
c.Attribution||(this.attribution=a.createAttribution(d.attribution))))};c.prototype.createName=function(a){return new g(this,a)};g.prototype={constructor:g,$getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},$getNameForm:function(b){return a(this.nameForms)[b||0]},$getFullText:function(b){return a(this.$getNameForm(b)).fullText},$getLang:function(b){return a(this.$getNameForm(b)).lang},$getNamePart:function(c,d){return a(b.find(a(this.$getNameForm(d)).parts,{type:c})).value},
$getGivenName:function(a){return this.$getNamePart("http://gedcomx.org/Given",a)},$getSurname:function(a){return this.$getNamePart("http://gedcomx.org/Surname",a)},$getPrefix:function(a){return this.$getNamePart("http://gedcomx.org/Prefix",a)},$getSuffix:function(a){return this.$getNamePart("http://gedcomx.org/Suffix",a)},$setType:function(a){this.$changed=!0;a?this.type=a:delete this.type;return this},$setPreferred:function(a){this.$changed=!0;this.preferred=a;return this},$setFullText:function(a,
b){this.$changed=!0;var c=d(this,b);a?c.fullText=a:delete c.fullText;return this},$setNamePart:function(a,c,g){this.$changed=!0;g=d(this,g);b.isArray(g.parts)||(g.parts=[]);var e=b.find(g.parts,{type:c});a?(e||(e={type:c},g.parts.push(e)),e.value=a):e&&g.parts.splice(g.parts.indexOf(e),1);return this},$setGivenName:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Given",b)},$setSurname:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Surname",b)},$setPrefix:function(a,b){return this.$setNamePart(a,
"http://gedcomx.org/Prefix",b)},$setSuffix:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Suffix",b)},$setChangeMessage:function(a){this.attribution=this.$client.createAttribution(a);return this}}},{"./../FamilySearch":1,"./../utils":48}],20:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.Note=function(a,b){d.BaseClass.call(this,a,b);!this.attribution||this.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(this.attribution))};d.prototype.createNote=
function(b){return new a(this,b)};a.prototype={constructor:a,$getNoteUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).note).href)},$save:function(a,b,d){var e=this,h,k,u={};e.$personId?(h=e.id?"person-note-template":"person-notes-template",k="persons"):e.$coupleId?(h=e.id?"couple-relationship-note-template":"couple-relationship-notes-template",k="relationships"):e.$childAndParentsId&&(h=e.id?"child-and-parents-relationship-note-template":"child-and-parents-relationship-notes-template",
k="childAndParentsRelationships",u["Content-Type"]="application/x-fs-v1+json");var p=e.$helpers.chainHttpPromises(e.$plumbing.getUrl(h,null,{pid:e.$personId,crid:e.$coupleId,caprid:e.$childAndParentsId,nid:e.id}),function(b){var c={};c[k]=[{notes:[e]}];a&&(c[k][0].attribution=e.$client.createAttribution(a));return e.$plumbing.post(b,c,u,d,function(a,b){return{id:e.id||b.getResponseHeader("X-ENTITY-ID"),location:e.$getNoteUrl()||e.$helpers.removeAccessToken(b.getResponseHeader("Location"))}})}),t=
p.then(function(a){e.$helpers.extendHttpPromise(t,p);return b?e.$client.getPersonNote(a.location,null,{},d).then(function(b){c.deletePropertiesPartial(e,c.appFieldRejector);c.extend(e,b.getNote());return a.id}):a.id});return t},$delete:function(a,b){return this.$personId?this.$client.deletePersonNote(this.$getNoteUrl()||this.$personId,this.id,a,b):this.$coupleId?this.$client.deleteCoupleNote(this.$getNoteUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsNote(this.$getNoteUrl()||
this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],21:[function(e,k,h){function d(a){return a?" "+a:""}var c=e("../FamilySearch"),b=e("../utils"),a=b.maybe,g=c.Person=function(a,d){c.BaseClass.call(this,a,d);d&&(d.$gender&&(this.$setGender(d.$gender),delete this.$gender),d.names&&b.forEach(this.names,function(b,d){b instanceof c.Name||(this.names[d]=a.createName(b))},this),d.facts&&b.forEach(this.facts,function(b,d){b instanceof c.Fact||(this.facts[d]=a.createFact(b))},
this),!d.attribution||d.attribution instanceof c.Attribution||(this.attribution=a.createAttribution(d.attribution)))};c.prototype.createPerson=function(a){return new g(this,a)};g.prototype={constructor:g,$getFacts:function(a){return(a?b.filter(this.facts,{type:a}):this.facts)||[]},$getFact:function(a){return b.find(this.facts,{type:a})},$getBirth:function(){return this.$getFact("http://gedcomx.org/Birth")},$getBirthDate:function(){var a=this.$getBirth();return a?a.$getDate():""},$getBirthPlace:function(){var a=
this.$getBirth();return a?a.$getPlace():""},$getChristening:function(){return this.$getFact("http://gedcomx.org/Christening")},$getChristeningDate:function(){var a=this.$getChristening();return a?a.$getDate():""},$getChristeningPlace:function(){var a=this.$getChristening();return a?a.$getPlace():""},$getDeath:function(){return this.$getFact("http://gedcomx.org/Death")},$getDeathDate:function(){var a=this.$getDeath();return a?a.$getDate():""},$getDeathPlace:function(){var a=this.$getDeath();return a?
a.$getPlace():""},$getBurial:function(){return this.$getFact("http://gedcomx.org/Burial")},$getBurialDate:function(){var a=this.$getBurial();return a?a.$getDate():""},$getBurialPlace:function(){var a=this.$getBurial();return a?a.$getPlace():""},$getDisplayBirthDate:function(){return a(this.display).birthDate},$getDisplayBirthPlace:function(){return a(this.display).birthPlace},$getDisplayDeathDate:function(){return a(this.display).deathDate},$getDisplayDeathPlace:function(){return a(this.display).deathPlace},
$getDisplayGender:function(){return a(this.display).gender},$getDisplayLifeSpan:function(){return a(this.display).lifespan},$getDisplayName:function(){return a(this.display).name},$getNames:function(a){return(a?b.filter(this.names,{type:a}):this.names)||[]},$getPreferredName:function(){return b.findOrFirst(this.names,{preferred:!0})},$getGivenName:function(){var a=this.$getPreferredName();a&&(a=a.$getGivenName());return a},$getSurname:function(){var a=this.$getPreferredName();a&&(a=a.$getSurname());
return a},$getPersistentIdentifier:function(){return a(a(this.identifiers)["http://gedcomx.org/Persistent"])[0]},$getPersonUrl:function(){return this.$helpers.removeAccessToken(a(a(this.links).person).href)},$getChanges:function(a){return this.$client.getPersonChanges(this.$helpers.removeAccessToken(this.links["change-history"].href),a)},$getDiscussionRefs:function(){return this.$client.getPersonDiscussionRefs(this.$helpers.removeAccessToken(this.links["discussion-references"].href))},$getMemoryPersonaRefs:function(){return this.$client.getMemoryPersonaRefs(this.$helpers.removeAccessToken(this.links["evidence-references"].href))},
$getNotes:function(){return this.$client.getPersonNotes(this.$helpers.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return this.$client.getPersonSourceRefs(this.id)},$getSources:function(){return this.$client.getPersonSourcesQuery(this.id)},$getSpouses:function(){return this.$client.getSpouses(this.id)},$getParents:function(){return this.$client.getParents(this.id)},$getChildren:function(){return this.$client.getChildren(this.id)},$getMatches:function(){return this.$client.getPersonMatches(this.id)},
$getAncestry:function(a){return this.$client.getAncestry(this.id,a)},$getDescendancy:function(a){return this.$client.getDescendancy(this.id,a)},$getPersonPortraitUrl:function(a){return this.$client.getPersonPortraitUrl(this.id,a)},$setNames:function(a,c){b.isArray(this.names)&&b.forEach(this.names,function(a){this.$deleteName(a,c)},this);this.names=[];b.forEach(a,function(a){this.$addName(a)},this);return this},$addName:function(a){b.isArray(this.names)||(this.names=[]);a instanceof c.Name||(a=this.$client.createName(a));
this.names.push(a);return this},$deleteName:function(a,d){a instanceof c.Name||(a=b.find(this.names,{id:a}));var e=b.indexOf(this.names,a);0<=e&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=d,this.names.splice(e,1));return this},$setFacts:function(a,c){b.isArray(this.facts)&&b.forEach(this.facts,function(a){this.$deleteFact(a,c)},this);this.facts=[];b.forEach(a,function(a){this.$addFact(a)},this);return this},$addFact:function(a){b.isArray(this.facts)||(this.facts=
[]);a instanceof c.Fact||(a=this.$client.createFact(a));this.facts.push(a);return this},$deleteFact:function(a,d){a instanceof c.Fact||(a=b.find(this.facts,{id:a}));var e=b.indexOf(this.facts,a);0<=e&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=d,this.facts.splice(e,1));return this},$setGender:function(a,b){this.gender||(this.gender={});this.gender.$changed=!0;this.gender.type=a;b&&(this.gender.attribution=this.$client.createAttribution(b));return this},
$save:function(a,c,e){var g=this.$client.createPerson(),h=!1;this.id&&(g.id=this.id);this.id||(this.gender||this.$setGender("http://gedcomx.org/Unknown"),b.isArray(this.names)&&0!==this.names.length||this.$addName({$fullText:"Unknown",$givenName:"Unknown"}),b.find(this.names,{preferred:!0})||this.names[0].$setPreferred(!0),1!==this.names.length||this.names[0].type||this.names[0].$setType("http://gedcomx.org/BirthName"),b.isUndefined(this.living)&&(this.living=!1));a&&(g.attribution=this.$client.createAttribution(a));
this.id||(g.living=this.living);!this.gender||this.gender.id&&!this.gender.$changed||(g.gender=this.gender,h=!0);b.forEach(this.names,function(a){if(!a.id||a.$changed)a.$getFullText()||a.$setFullText((d(a.$getPrefix())+d(a.$getGivenName())+d(a.$getSurname())+d(a.$getSuffix())).trim()),g.$addName(a),h=!0});b.forEach(this.facts,function(a){if(!a.id||a.$changed)g.$addFact(a),h=!0});var k=[],p=this;h&&k.push(p.$helpers.chainHttpPromises(g.id?p.$plumbing.getUrl("person-template",null,{pid:g.id}):p.$plumbing.getUrl("persons"),
function(a){return p.$plumbing.post(a,{persons:[g]},{},e,p.$helpers.getResponseEntityId)}));this.id&&this.$deletedConclusions&&b.forEach(this.$deletedConclusions,function(b,c){b=b||a;k.push(p.$helpers.chainHttpPromises(p.$plumbing.getUrl("person-conclusion-template",null,{pid:g.id,cid:c}),function(a){return p.$plumbing.del(a,b?{"X-Reason":b}:{},e)}))});var t=this,v=p.$helpers.promiseAll(k).then(function(a){var d=g.id?g.id:a[0];p.$helpers.extendHttpPromise(v,k[0]);return c?p.$client.getPerson(d,{},
e).then(function(a){b.deletePropertiesPartial(t,b.appFieldRejector);b.extend(t,a.getPerson());return d}):d});return v},$delete:function(a,b){return this.$client.deletePerson(this.$getPersonUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../utils":48}],22:[function(e,k,h){var d=e("./../FamilySearch"),c=d.Place=function(b,a){d.BaseClass.call(this,b,a)};d.prototype.createPlace=function(b){return new c(this,b)};c.prototype={constructor:c,$getNormalizedPlace:function(){return this.normalized?this.normalized[0]:
void 0}}},{"./../FamilySearch":1}],23:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.SearchResult=function(a,f){d.BaseClass.call(this,a,f);c.forEach(b(b(b(f).content).gedcomx).persons,function(b,c,d){d[c]=a.createPerson(b)})};d.prototype.createSearchResult=function(b){return new a(this,b)};a.prototype={constructor:a,$getPerson:function(a){return c.find(b(b(this.content).gedcomx).persons,{id:a})},$getPrimaryPerson:function(){return this.$getPerson(this.id)},$getFullPrimaryPerson:function(){return this.$client.getPerson(this.id)},
$getFatherIds:function(){var a=this.id,d=this;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,function(c){return"http://gedcomx.org/ParentChild"===c.type&&c.person2.resourceId===a&&c.person1&&"http://gedcomx.org/Male"===b(d.$getPerson(c.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getFathers:function(){return c.map(this.$getFatherIds(),this.$getPerson,this)},$getMotherIds:function(){var a=this.id,d=this;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,
function(c){return"http://gedcomx.org/ParentChild"===c.type&&c.person2.resourceId===a&&c.person1&&"http://gedcomx.org/Male"!==b(d.$getPerson(c.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getMothers:function(){return c.map(this.$getMotherIds(),this.$getPerson,this)},$getSpouseIds:function(){var a=this.id;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/Couple"===b.type&&(b.person1.resourceId===a||b.person2.resourceId===
a)}),function(b){return b.person1.resourceId===a?b.person2.resourceId:b.person1.resourceId}))},$getSpouses:function(){return c.map(this.$getSpouseIds(),this.$getPerson,this)},$getChildIds:function(){var a=this.id;return c.uniq(c.map(c.filter(b(b(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/ParentChild"===b.type&&b.person1.resourceId===a&&b.person2}),function(a){return a.person2.resourceId}))},$getChildren:function(){return c.map(this.$getChildIds(),this.$getPerson,this)}}},
{"./../FamilySearch":1,"./../utils":48}],24:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.SourceDescription=function(a,b){d.BaseClass.call(this,a,b);b&&(b.$citation&&this.$setCitation(b.$citation),b.$title&&this.$setTitle(b.$title),b.$text&&this.$setText(b.$text),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createSourceDescription=function(b){return new a(this,b)};a.prototype={constructor:a,
$getCitation:function(){return b(b(this.citations)[0]).value},$getTitle:function(){return b(b(this.titles)[0]).value},$getText:function(){return b(b(this.notes)[0]).text},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links).description).href)},$getSourceRefsQuery:function(){return this.$client.getSourceRefsQuery(this.id)},$setCitation:function(a){this.citations=[{value:a}];return this},$setTitle:function(a){this.titles=[{value:a}];return this},$setText:function(a){this.notes=
[{text:a}];return this},$save:function(a,b,d){var e=this;a&&(e.attribution=e.$client.createAttribution(a));var h=e.$helpers.chainHttpPromises(e.id?e.$plumbing.getUrl("source-description-template",null,{sdid:e.id}):e.$plumbing.getUrl("source-descriptions"),function(a){return e.$plumbing.post(a,{sourceDescriptions:[e]},{},d,function(a,b){return e.id||b.getResponseHeader("X-ENTITY-ID")})}),k=h.then(function(a){e.$helpers.extendHttpPromise(k,h);return b?e.$client.getSourceDescription(a,{},d).then(function(b){c.deletePropertiesPartial(e,
c.appFieldRejector);c.extend(e,b.getSourceDescription());return a}):a});return k},$delete:function(a,b){return this.$client.deleteSourceDescription(this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],25:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe,a=d.SourceRef=function(a,b){d.BaseClass.call(this,a,b);b&&(this.$personId=b.$personId,this.$coupleId=b.$coupleId,this.$childAndParentsId=b.$childAndParentsId,b.$sourceDescription&&this.$setSourceDescription(b.$sourceDescription),
b.$tags&&this.$setTags(b.$tags),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createSourceRef=function(b){return new a(this,b)};a.prototype={constructor:a,$getSourceRefUrl:function(){return this.$helpers.removeAccessToken(b(b(this.links)["source-reference"]).href)},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(this.description)},$getSourceDescription:function(){return this.$client.getSourceDescription(this.$getSourceDescriptionUrl())},
$getTags:function(){return c.map(this.tags,function(a){return a.resource})},$setSourceDescription:function(a){a instanceof d.SourceDescription?(this.$sourceDescriptionId=a.id,this.description=a.$getSourceDescriptionUrl()):this.$helpers.isAbsoluteUrl(a)?(delete this.$sourceDescriptionId,this.description=this.$sourceDescriptionUrl):(this.$sourceDescriptionId=a,delete this.description);return this},$setTags:function(a){this.tags=c.map(a,function(a){return{resource:a}});return this},$addTag:function(a){c.isArray(this.tags)||
(this.tags=[]);this.tags.push({resource:a});return this},$removeTag:function(a){(a=c.find(this.tags,{resource:a}))&&this.tags.splice(c.indexOf(this.tags,a),1);return this},$save:function(a,b){var c=this;a&&(c.attribution=c.$client.createAttribution(a));var d,e,h={};c.$personId?(d="person-source-references-template",e="persons"):c.$coupleId?(d="couple-relationship-source-references-template",e="relationships"):c.$childAndParentsId&&(d=d="child-and-parents-relationship-source-references-template",e=
"childAndParentsRelationships",h["Content-Type"]="application/x-fs-v1+json");return c.$helpers.chainHttpPromises(c.$plumbing.getUrl(d,null,{pid:c.$personId,crid:c.$coupleId,caprid:c.$childAndParentsId,srid:c.id}),function(a){!c.description&&c.$sourceDescriptionId&&(c.description=c.$helpers.getUrlFromDiscoveryResource(c.$client.settings.discoveryResource,"source-description-template",{sdid:c.$sourceDescriptionId}));c.description=c.$helpers.removeAccessToken(c.description);var d={};d[e]=[{sources:[c]}];
return c.$plumbing.post(a,d,h,b,function(a,b){c.id||(c.id=b.getResponseHeader("X-ENTITY-ID"));c.$getSourceRefUrl()||(c.links={"source-reference":{href:c.$helpers.removeAccessToken(b.getResponseHeader("Location"))}});return c.id})})},$delete:function(a,b){return this.$personId?this.$client.deletePersonSourceRef(this.$getSourceRefUrl()||this.$personID,this.id,a,b):this.$coupleId?this.$client.deleteCoupleSourceRef(this.$getSourceRefUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsSourceRef(this.$getSourceRefUrl()||
this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":48}],26:[function(e,k,h){var d=e("../FamilySearch"),c=d.User=function(b,a){d.BaseClass.call(this,b,a)};d.prototype.createUser=function(b){return new c(this,b)};c.prototype={constructor:c}},{"../FamilySearch":1}],27:[function(e,k,h){k.exports={clientId:null,environment:null,httpWrapper:null,deferredWrapper:null,setTimeout:null,clearTimeout:null,redirectUri:null,autoSignin:!1,autoExpire:!1,accessToken:null,saveAccessToken:!1,
logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:2,maxAccessTokenInactivityTime:354E4,maxAccessTokenCreationTime:8634E4,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://beta.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",beta:"https://identbeta.familysearch.org/cis-web/oauth2/v3",
production:"https://ident.familysearch.org/cis-web/oauth2/v3"},authoritiesServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://apibeta.familysearch.org",production:"https://api.familysearch.org"},discoveryUrl:"/.well-known/app-meta"}},{}],28:[function(e,k,h){var d=e("./utils"),c=d.forEach;e=function(b){this.settings=b.settings;this.accessTokenCreationTimer=this.accessTokenInactiveTimer=null};e.prototype.getAbsoluteUrl=function(b,a){return this.isAbsoluteUrl(a)?
a:b+("/"!==a.charAt(0)?"/":"")+a};e.prototype.isOAuthServerUrl=function(b){return 0===b.indexOf(this.settings.oauthServer[this.settings.environment])};e.prototype.getAPIServerUrl=function(b){return this.getAbsoluteUrl(this.settings.apiServer[this.settings.environment],b)};e.prototype.getAuthoritiesServerUrl=function(b){return this.getAbsoluteUrl(this.settings.authoritiesServer[this.settings.environment],b)};e.prototype.appendAccessToken=function(b){if(b){var a=this.decodeQueryString(b);b=this.removeQueryString(b);
a.access_token=this.settings.accessToken;b=this.appendQueryParameters(b,a)}return b};e.prototype.log=function(){this.settings.debug&&console.log.apply(null,arguments)};e.prototype.nextTick=function(b){this.settings.setTimeout(function(){b()},0)};e.prototype.refPromise=function(b){if(b&&d.isFunction(b.then))return b;var a=this;return{then:function(c){var d=a.settings.deferredWrapper();a.nextTick(function(){d.resolve(c(b))});return d.promise}}};e.prototype.promiseAll=function(b){var a=this.settings.deferredWrapper(),
e=0,f=d.isArray(b)?[]:{},l=this;c(b,function(b,c){e++;l.refPromise(b).then(function(b){f.hasOwnProperty(c)||(f[c]=b,--e||a.resolve(f))},function(){f.hasOwnProperty(c)||a.reject.apply(a,arguments)})});0===e&&a.resolve(f);return a.promise};e.prototype.setTimer=function(b,a,c){c&&this.settings.clearTimeout(c);return this.settings.setTimeout(function(){b()},a)};e.prototype.setAccessTokenInactiveTimer=function(b){this.accessTokenInactiveTimer=this.setTimer(this.settings.eraseAccessToken,b,this.accessTokenInactiveTimer)};
e.prototype.setAccessTokenCreationTimer=function(b){this.accessTokenCreationTimer=this.setTimer(this.settings.eraseAccessToken,b,this.accessTokenCreationTimer)};e.prototype.clearAccessTokenTimers=function(){this.settings.clearTimeout(this.accessTokenInactiveTimer);this.accessTokenInactiveTimer=null;this.settings.clearTimeout(this.accessTokenCreationTimer);this.accessTokenCreationTimer=null};e.prototype.getAccessTokenCookieName=function(){return this.settings.accessTokenCookie+"_"+this.settings.instanceId};
e.prototype.readAccessToken=function(){if("undefined"!==typeof window){var b=(new Date).getTime(),a=this.readCookie(this.getAccessTokenCookieName());if(a&&(a=a.split("|",3),3===a.length)){var c=b-parseInt(a[0],10),b=b-parseInt(a[1],10);c<this.settings.maxAccessTokenInactivityTime&&b<this.settings.maxAccessTokenCreationTime&&(this.settings.accessToken=a[2],this.settings.autoExpire&&(this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime-c),this.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime-
b)))}}};e.prototype.setAccessToken=function(b){this.settings.accessToken=b;if("undefined"!==typeof window&&(this.settings.autoExpire&&(this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime),this.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime)),this.settings.saveAccessToken)){var a=(new Date).getTime();b=a+"|"+a+"|"+b;this.createCookie(this.getAccessTokenCookieName(),b,0)}};e.prototype.refreshAccessToken=function(){var b=(new Date).getTime();this.settings.autoExpire&&
this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime);if(this.settings.saveAccessToken){var a=this.readCookie(this.getAccessTokenCookieName());a&&(a=a.split("|",3),3===a.length&&(a=b+"|"+a[1]+"|"+a[2],this.createCookie(this.getAccessTokenCookieName(),a,0)))}};e.prototype.eraseAccessToken=function(b){this.settings.accessToken=null;"undefined"!==typeof window&&(this.settings.autoExpire&&this.clearAccessTokenTimers(),this.settings.saveAccessToken&&this.eraseCookie(this.getAccessTokenCookieName()),
this.settings.expireCallback&&!b&&this.settings.expireCallback())};e.prototype.extendHttpPromise=function(b,a){return d.wrapFunctions(b,a,["getResponseHeader","getAllResponseHeaders","getStatusCode","getRequest"])};e.prototype.chainHttpPromises=function(){var b=arguments[0],a={},d=this;c(Array.prototype.slice.call(arguments,1),function(c){b=b.then(function(){var b=c.apply(null,arguments);b&&b.then&&d.extendHttpPromise(a,b);return b})});d.extendHttpPromise(b,a);return b};e.prototype.getLastUrlSegment=
function(b){b&&(b=b.replace(/^.*\//,"").replace(/\?.*$/,""));return b};e.prototype.getResponseEntityId=function(b,a){return a.getResponseHeader("X-ENTITY-ID")};e.prototype.getResponseLocation=function(b,a){return this.removeAccessToken(a.getResponseHeader("Location"))};e.prototype.isAbsoluteUrl=function(b){return/^https?:\/\//.test(b)};e.prototype.isAuthoritiesServerUrl=function(b){return-1!==b.indexOf("/authorities/v1/")};e.prototype.encodeQueryString=function(b){var a=[];c(b,function(b,c){c=encodeURIComponent(c);
var e;e=d.isArray(b)?d.map(b,function(a){return c+"="+encodeURIComponent(a)}).join("&"):null!=b?c+"="+encodeURIComponent(b):c;a.push(e)});return a.join("&")};e.prototype.appendQueryParameters=function(b,a){var c=this.encodeQueryString(a);return 0===c.length?b:b+(0<=b.indexOf("?")?"&":"?")+c};e.prototype.decodeQueryString=function(b){var a={};if(b){var e=b.indexOf("?");-1!==e&&(b=b.substring(e+1).split("&"),c(b,function(b){var c=b.split("=",2);c&&c[0]&&(b=decodeURIComponent(c[0]),c=null!=c[1]?decodeURIComponent(c[1]):
c[1],null==a[b]||d.isArray(a[b])||(a[b]=[a[b]]),null!=a[b]?a[b].push(c):a[b]=c)}))}return a};e.prototype.removeQueryString=function(b){if(b){var a=b.indexOf("?");-1!==a&&(b=b.substring(0,a))}return b};e.prototype.removeAccessToken=function(b){if(b){var a=this.decodeQueryString(b);b=this.removeQueryString(b);delete a.access_token;b=this.appendQueryParameters(b,a)}return b};e.prototype.populateUriTemplate=function(b,a){for(var c=b.split(/[{}]/),d=!1,e=0,h=c.length;e<h;e++)if(1===e%2){var k=a[c[e]];
c[e]=d?encodeURIComponent(k):encodeURI(k)}else-1!==c[e].indexOf("?")&&(d=!0);return c.join("")};e.prototype.getUrlFromDiscoveryResource=function(b,a,c){var d="";b=b.links[a];b.href?d=this.removeAccessToken(b.href):b.template&&(d=b.template.replace(/{\?[^}]*}/,""),d=this.populateUriTemplate(d,c||{}));return d};e.prototype.attributionNeeded=function(b){return!(b.attribution&&b.attribution.changeMessage&&!b.attribution.contributor)};e.prototype.createCookie=function(b,a,c){var d="",e="https"===document.location.protocol&&
"localhost"!==document.location.hostname;c&&(d=new Date,d.setTime(d.getTime()+86400*c),d="; expires="+d.toUTCString());document.cookie=b+"="+a+d+"; path=/"+(e?"; secure":"")};e.prototype.readCookie=function(b){b+="=";for(var a=document.cookie.split(";"),c=0;c<a.length;c++){for(var d=a[c];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(b))return d.substring(b.length,d.length)}return null};e.prototype.eraseCookie=function(b){this.createCookie(b,"",-1)};k.exports=e},{"./utils":48}],29:[function(e,
k,h){var d=e("./utils");h={httpWrapper:function(c,b){return function(a,e,f,l,h){h=d.extend({url:e,type:a,dataType:"json",data:l,processData:!1},h);h.headers=d.extend({},f,h.headers);"multipart/form-data"===h.headers["Content-Type"]&&(h.contentType=!1,delete h.headers["Content-Type"]);a=c(h);var k=b.settings.deferredWrapper();e=k.promise;var q=null;a.then(function(a,b,c){q=c.status;k.resolve(a)},function(a,b,c){q=a.status;200<=q&&299>=q&&!a.responseText?k.resolve(null):k.reject(a,b,c)});d.wrapFunctions(e,
a,["getResponseHeader","getAllResponseHeaders"]);e.getStatusCode=function(){return q};e.getRequest=function(){return h};return e}},deferredWrapper:function(c){return function(){var b=c();return{promise:b.promise(),resolve:b.resolve,reject:b.reject}}}};k.exports=h},{"./utils":48}],30:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils");k.prototype.getAuthCode=function(){var c=this,b=c.settings;if("undefined"===typeof window){var a=b.deferredWrapper();a.reject();return a.promise}return c.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(a){a=
c.openPopup(a,{response_type:"code",client_id:b.clientId,redirect_uri:b.redirectUri});return c._pollForAuthCode(a)})};k.prototype.handleAccessTokenResponse=function(c,b){var a=this;c.then(function(c){var d=c.access_token;d?(a.helpers.setAccessToken(d),b.resolve(d)):b.reject(c.error)},function(){b.reject.apply(b,arguments)})};k.prototype.getAccessToken=function(c){var b=this,a=b.settings,d=a.deferredWrapper(),e=b.plumbing,l=b.helpers;a.accessToken?l.nextTick(function(){d.resolve(a.accessToken)}):(c?
l.refPromise(c):b.getAuthCode()).then(function(c){e.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(l){l=e.post(l,{grant_type:"authorization_code",code:c,client_id:a.clientId},{"Content-Type":"application/x-www-form-urlencoded"});b.handleAccessTokenResponse(l,d)})},function(){d.reject.apply(d,arguments)});return d.promise};k.prototype.getAccessTokenForMobile=function(c,b){var a=this,d=a.settings.deferredWrapper(),e=a.plumbing,l=a.helpers;a.settings.accessToken?l.nextTick(function(){d.resolve(a.settings.accessToken)}):
e.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(l){l=e.post(l,{grant_type:"password",client_id:a.settings.clientId,username:c,password:b},{"Content-Type":"application/x-www-form-urlencoded"});a.handleAccessTokenResponse(l,d)});return d.promise};k.prototype.hasAccessToken=function(){return!!this.settings.accessToken};k.prototype.invalidateAccessToken=function(){var c=this;c.helpers.eraseAccessToken(!0);return c.helpers.chainHttpPromises(c.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/token"),
function(b){return c.plumbing.del(b)})};k.prototype.openPopup=function(c,b){var a=d.isUndefined(window.screenX)?window.screenLeft:window.screenX,e=d.isUndefined(window.screenY)?window.screenTop:window.screenY,f=d.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,l=d.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,h=b.width||780,k=b.height||500,a=parseInt(a+(f-h)/2,10),e=parseInt(e+(l-k)/2.5,10),h="width="+h+",height="+
k+",left="+a+",top="+e;return window.open(this.helpers.appendQueryParameters(c,b),"",h)};k.prototype.getCode=function(c,b){var a=this.helpers.decodeQueryString(c);a.code?b.resolve(a.code):b.reject(a.error)};k.prototype._pollForAuthCode=function(c){var b=this,a=b.settings.deferredWrapper();if(c){var d=setInterval(function(){try{c.location.hostname===window.location.hostname&&(b.getCode(c.location.href,a),clearInterval(d),c.close())}catch(e){}},b.settings.authCodePollDelay);window.FamilySearchOauthReceiver=
function(c){b.getCode(c,a);clearInterval(d)}}else a.reject("Popup blocked");return a.promise}},{"./../FamilySearch":1,"./../utils":48}],31:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils");k.prototype.getDate=function(c,b){var a=this,e={date:c,dataFormat:"application/json"};return a.plumbing.get(a.helpers.getAuthoritiesServerUrl("/authorities/v1/date"),e,{Accept:"application/json"},b,d.compose(d.objectExtender({getDate:function(){return d.maybe(d.maybe(this.dates).date)[0]}}),function(b){d.forEach(b.dates.date,
function(b,c,d){d[c]=a.createDate(b)});return b}))};k.prototype.getPlaceSearch=function(c,b){var a=this,e={place:c,view:"simple",dataFormat:"application/json"};return a.plumbing.get(a.helpers.getAuthoritiesServerUrl("/authorities/v1/place"),e,{Accept:"application/json"},b,d.compose(d.objectExtender({getPlaces:function(){return d.maybe(this.places).place}}),function(b){d.forEach(b.places.place,function(b,c,d){d[c]=a.createPlace(b)});return b}))}},{"./../FamilySearch":1,"./../utils":48}],32:[function(e,
k,h){k=e("./../FamilySearch");var d=e("./../utils");k.prototype._changeHistoryResponseMapper=function(){var c=this;return d.compose(d.objectExtender({getChanges:function(){return this.entries||[]}}),function(b){for(var a=0;a<b.entries.length;a++)b.entries[a]=c.createChange(b.entries[a]);return b})};k.prototype.getPersonChanges=function(c,b,a){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-changes-template",c,{pid:c}),function(c){return d.plumbing.get(c,b,{Accept:"application/x-gedcomx-atom+json"},
a,d._changeHistoryResponseMapper())})};k.prototype.getChildAndParentsChanges=function(c,b,a){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-changes-template",c,{caprid:c}),function(c){return d.plumbing.get(c,b,{Accept:"application/x-gedcomx-atom+json"},a,d._changeHistoryResponseMapper())})};k.prototype.getCoupleChanges=function(c,b,a){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-changes-template",c,{crid:c}),
function(c){return d.plumbing.get(c,b,{Accept:"application/x-gedcomx-atom+json"},a,d._changeHistoryResponseMapper())})};k.prototype.restoreChange=function(c,b){var a=this;return a.helpers.chainHttpPromises(a.plumbing.getUrl("change-restore-template",c,{chid:c}),function(d){return a.plumbing.post(d,null,{"Content-Type":void 0},b,function(){return c})})}},{"./../FamilySearch":1,"./../utils":48}],33:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe;d.prototype.getDiscussion=function(a,
d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("discussion-template",a,{did:a}),function(a){return l.plumbing.get(a,d,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getDiscussion:function(){return b(b(this).discussions)[0]}}),function(a){for(var b=0;b<a.discussions.length;b++)a.discussions[b]=l.createDiscussion(a.discussions[b]);return a}))})};d.prototype.getMultiDiscussion=function(a,b,e){var l=this,h={};c.forEach(a,function(a){var c;a instanceof d.DiscussionRef?
(c=a.$getDiscussionUrl(),a=a.resourceId):c=a;h[a]=l.getDiscussion(c,b,e)});return l.helpers.promiseAll(h)};d.prototype.getPersonDiscussionRefs=function(a,d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-discussion-references-template",a,{pid:a}),function(a){return l.plumbing.get(a,d,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getDiscussionRefs:function(){return b(b(b(this).persons)[0])["discussion-references"]||[]}}),function(a){if(a&&a.persons&&a.persons[0]&&
c.isArray(a.persons[0]["discussion-references"]))for(var b=a.persons[0]["discussion-references"],d=0;d<b.length;d++)b[d]=l.createDiscussionRef(b[d]);return a},c.objectExtender(function(a){return{$personId:b(b(b(a).persons)[0]).id}},function(a){return b(b(b(a).persons)[0])["discussion-references"]})))})};d.prototype._commentsResponseMapper=function(){var a=this;return c.compose(c.objectExtender({getComments:function(){return b(b(b(this).discussions)[0]).comments||[]}}),function(b){if(b&&b.discussions&&
b.discussions[0]&&c.isArray(b.discussions[0].comments))for(var d=b.discussions[0].comments,e=0;e<d.length;e++)d[e]=a.createComment(d[e]);return b})};d.prototype.getDiscussionComments=function(a,d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("discussion-comments-template",a,{did:a}),function(a){return l.plumbing.get(a,d,{Accept:"application/x-fs-v1+json"},e,c.compose(l._commentsResponseMapper(),c.objectExtender(function(a){return{$discussionId:b(b(b(a).discussions)[0]).id}},function(a){return b(b(b(a).discussions)[0]).comments})))})};
d.prototype.deleteDiscussion=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("discussion-template",a,{did:a}),function(b){return d.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},c,function(){return a})})};d.prototype.deleteDiscussionRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-discussion-reference-template",a,{pid:a,drid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};c&&(g["X-Reason"]=c);
return e.plumbing.del(b,g,d,function(){return a})})};d.prototype.deleteDiscussionComment=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("discussion-comment-template",a,{did:a,cmid:b}),function(b){return e.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},d,function(){return a})})};d.prototype.deleteMemoryComment=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-comment-template",a,{mid:a,cmid:b}),function(b){return e.plumbing.del(b,
{},d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],34:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils"),c=d.maybe;k.prototype._memoriesResponseMapper=function(){var b=this;return function(a){if(a&&d.isArray(a.sourceDescriptions))for(var c=0;c<a.sourceDescriptions.length;c++)a.sourceDescriptions[c].attribution&&(a.sourceDescriptions[c].attribution=b.createAttribution(a.sourceDescriptions[c].attribution)),a.sourceDescriptions[c]=b.createMemory(a.sourceDescriptions[c]);
return a}};k.prototype.getPersonMemoriesQuery=function(b,a,c){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-memories-query",b,{pid:b}),function(b){return e.plumbing.get(b,a,{},c,d.compose(d.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e._memoriesResponseMapper()))})};k.prototype.getUserMemoriesQuery=function(b,a,c){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-memories-query",b,{cisUserId:b}),function(b){return e.plumbing.get(b,
a,{},c,d.compose(d.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e._memoriesResponseMapper()))})};k.prototype.getMemory=function(b,a,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-template",b,{mid:b}),function(b){return f.plumbing.get(b,a,{},e,d.compose(d.objectExtender({getMemory:function(){return c(this.sourceDescriptions)[0]}}),f._memoriesResponseMapper()))})};k.prototype.getMemoryComments=function(b,a,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-comments-template",
b,{mid:b}),function(b){return f.plumbing.get(b,a,{Accept:"application/x-fs-v1+json"},e,d.compose(f._commentsResponseMapper(),d.objectExtender(function(a){return{$memoryId:c(c(c(a).sourceDescriptions)[0]).id}},function(a){return c(c(c(a).discussions)[0]).comments})))})};k.prototype._memoryPersonasMapper=function(){var b=this;return d.compose(function(a){if(a&&d.isArray(a.persons))for(var c=0;c<a.persons.length;c++)a.persons[c]=b.createMemoryPersona(a.persons[c]);return a},function(a){if(a&&d.isArray(a.persons))for(var c=
0;c<a.persons.length;c++)if(d.isArray(a.persons[c].names))for(var e=0;e<a.persons[c].names.length;e++)a.persons[c].names[e]=b.createName(a.persons[c].names[e]);return a},function(a){if(a&&d.isArray(a.persons))for(var c=0;c<a.persons.length;c++)a.persons[c].media&&(a.persons[c].media=b.createMemoryArtifactRef(a.persons[c].media));return a},d.objectExtender(function(a){return{$memoryId:c(c(a.sourceDescriptions)[0]).id}},function(a){return c(a).persons}))};k.prototype.getMemoryPersonas=function(b,a,
c){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-personas-template",b,{mid:b}),function(b){return e.plumbing.get(b,a,{},c,d.compose(d.objectExtender({getMemoryPersonas:function(){return this&&this.persons?this.persons:[]}}),e._memoryPersonasMapper()))})};k.prototype.getMemoryPersona=function(b,a,e,f){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("memory-persona-template",b,{mid:b,pid:a}),function(a){return l.plumbing.get(a,e,{},f,d.compose(d.objectExtender({getMemoryPersona:function(){return c(this.persons)[0]}}),
l._memoryPersonasMapper()))})};k.prototype.getMemoryPersonaRefs=function(b,a,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("person-memory-persona-references-template",b,{pid:b}),function(b){return f.plumbing.get(b,a,{},e,d.compose(d.objectExtender({getMemoryPersonaRefs:function(){return c(c(this.persons)[0]).evidence||[]}}),function(a){try{if(a&&d.isArray(a.persons)&&a.persons[0]){var b=a.persons[0];if(b.evidence&&d.isArray(b.evidence))for(var c=0;c<b.evidence.length;c++)b.evidence[c]=
f.createMemoryPersonaRef(b.evidence[c])}}catch(e){console.error(e.stack)}return a},d.objectExtender(function(a){return{$personId:c(c(c(a).persons)[0]).id}},function(a){return c(c(c(a).persons)[0]).evidence})))})};k.prototype.getPersonPortraitUrl=function(b,a,c){var e=this;return e.plumbing.getUrl("person-portrait-template",b,{pid:b}).then(function(b){if(a&&a.followRedirect){a=d.extend({},a);delete a.followRedirect;var h=e.plumbing.get(b,a,{"X-Expect-Override":"200-ok"},c);return h.then(function(){return 204===
h.getStatusCode()?"":e.helpers.appendAccessToken(h.getResponseHeader("Location"))})}return e.helpers.appendAccessToken(b)})};k.prototype.deleteMemory=function(b,a,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("memory-template",b,{mid:b}),function(a){return d.plumbing.del(a,{},c,function(){return b})})};k.prototype.deleteMemoryPersona=function(b,a,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-persona-template",b,{mid:b,pid:a}),function(a){return e.plumbing.del(a,
{},d,function(){return b})})};k.prototype.deleteMemoryPersonaRef=function(b,a,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-memory-persona-reference-template",b,{pid:b,erid:a}),function(a){return e.plumbing.del(a,{},d,function(){return b})})}},{"./../FamilySearch":1,"./../utils":48}],35:[function(e,k,h){function d(a){if(a){if(a.persons)return a.persons;if(a.childAndParentsRelationships)return a.childAndParentsRelationships;if(a.relationships)return a.relationships}return{}}
k=e("./../FamilySearch");var c=e("./../utils"),b=c.maybe;k.prototype._getNote=function(a,e,f){var l=this;return l.plumbing.get(a,e,{Accept:"application/x-fs-v1+json"},f,c.compose(c.objectExtender({getNote:function(){return b(b(d(this)[0]).notes)[0]}}),function(a){var e=b(d(a)[0]).notes;c.forEach(e,function(a,b){e[b]=l.createNote(a)});return a},c.objectExtender(function(a){var c={};c[a.persons?"$personId":a.childAndParentsRelationships?"$childAndParentsId":"$coupleId"]=b(d(a)[0]).id;return c},function(a){return b(d(a)[0]).notes})))};
k.prototype._getMultiNote=function(a,b,d,e,h){var k=this,q={};c.isArray(a)?c.forEach(a,function(a){q[a]=h.call(k,a,null,d,e)}):c.forEach(b,function(b){q[b]=h.call(k,a,b,d,e)});return q};k.prototype.getPersonNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-note-template",a,{pid:a,nid:b}),function(a){return e._getNote(a,c,d)})};k.prototype.getMultiPersonNote=function(a,b,c,d){a=this._getMultiNote(a,b,c,d,this.getPersonNote);return this.helpers.promiseAll(a)};
k.prototype.getCoupleNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(a){return e._getNote(a,c,d)})};k.prototype.getMultiCoupleNote=function(a,b,c,d){a=this._getMultiNote(a,b,c,d,this.getCoupleNote);return this.helpers.promiseAll(a)};k.prototype.getChildAndParentsNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-note-template",a,
{caprid:a,nid:b}),function(a){return e._getNote(a,c,d)})};k.prototype.getMultiChildAndParentsNote=function(a,b,c,d){a=this._getMultiNote(a,b,c,d,this.getChildAndParentsNote);return this.helpers.promiseAll(a)};k.prototype.getPersonNotes=function(a,d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-notes-template",a,{pid:a}),function(a){return l.plumbing.get(a,d,{},e,c.compose(c.objectExtender({getNotes:function(){return b(b(b(this).persons)[0]).notes||[]}}),function(a){var d=
b(b(b(a).persons)[0]).notes;c.forEach(d,function(a,b){d[b]=l.createNote(a)});return a},c.objectExtender(function(a){return{$personId:b(b(b(a).persons)[0]).id}},function(a){return b(b(b(a).persons)[0]).notes})))})};k.prototype.getCoupleNotes=function(a,d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("couple-relationship-notes-template",a,{crid:a}),function(a){return l.plumbing.get(a,d,{},e,c.compose(c.objectExtender({getNotes:function(){return b(b(this.relationships)[0]).notes||
[]}}),function(a){var d=b(b(b(a).relationships)[0]).notes;c.forEach(d,function(a,b){d[b]=l.createNote(a)});return a},c.objectExtender(function(a){return{$coupleId:b(b(b(a).relationships)[0]).id}},function(a){return b(b(b(a).relationships)[0]).notes})))})};k.prototype.getChildAndParentsNotes=function(a,d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("child-and-parents-relationship-notes-template",a,{caprid:a}),function(a){return l.plumbing.get(a,d,{Accept:"application/x-fs-v1+json"},
e,c.compose(c.objectExtender({getNotes:function(){return b(b(this.childAndParentsRelationships)[0]).notes||[]}}),function(a){var d=b(b(b(a).childAndParentsRelationships)[0]).notes;c.forEach(d,function(a,b){d[b]=l.createNote(a)});return a},c.objectExtender(function(a){return{$childAndParentsId:b(b(b(a).childAndParentsRelationships)[0]).id}},function(a){return b(b(b(a).childAndParentsRelationships)[0]).notes})))})};k.prototype.deletePersonNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-note-template",
a,{pid:a,nid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};c&&(g["X-Reason"]=c);return e.plumbing.del(b,g,d,function(){return a})})};k.prototype.deleteCoupleNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(b){var g={};c&&(g["X-Reason"]=c);return e.plumbing.del(b,g,d,function(){return a})})};k.prototype.deleteChildAndParentsNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-note-template",
a,{caprid:a,nid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};c&&(g["X-Reason"]=c);return e.plumbing.del(b,g,d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],36:[function(e,k,h){k=e("../FamilySearch");var d=e("../utils"),c=d.maybe,b={getRelationship:function(){return c(this.childAndParentsRelationships)[0]},getPerson:function(a){return d.find(this.persons,{id:a})}};k.prototype.getChildAndParents=function(a,c,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("child-and-parents-relationship-template",
a,{caprid:a}),function(a){return l.plumbing.get(a,c,{Accept:"application/x-fs-v1+json"},e,d.compose(d.objectExtender(b),function(a){d.forEach(a.persons,function(a,b,c){c[b]=l.createPerson(a)});d.forEach(a.childAndParentsRelationships,function(a,b,c){c[b]=l.createChildAndParents(a)});return a}))})};k.prototype.deleteChildAndParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-template",a,{caprid:a}),function(e){var h={"Content-Type":"application/x-fs-v1+json"};
b&&(h["X-Reason"]=b);return d.plumbing.del(e,h,c,function(){return a})})}},{"../FamilySearch":1,"../utils":48}],37:[function(e,k,h){function d(d){return{getPersons:function(){return this.persons},exists:function(e){return!!a(b.find(this.persons,c(d,e))).id},getPerson:function(a){return b.find(this.persons,c(d,a))}}}function c(a,b){return function(c){return c.display[a]==b}}k=e("./../FamilySearch");var b=e("./../utils"),a=b.maybe;k.prototype.getAncestry=function(e,f,l){var h=this;return h.helpers.chainHttpPromises(h.plumbing.getUrl("ancestry-query"),
function(k){return h.plumbing.get(k,b.extend({person:e},f),{},l,b.compose(b.objectExtender(d("ascendancyNumber")),f&&f.descendants?b.objectExtender({getDescendant:function(a){return b.find(this.persons,c("descendancyNumber",a))},existsDescendant:function(d){return!!a(b.find(this.persons,c("descendancyNumber",d))).id}}):null,function(a){b.forEach(a.persons,function(a,b,c){c[b]=h.createPerson(a)});return a},b.objectExtender({$getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(b){return a(b).persons}),
f&&f.descendants?b.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(b){return a(b).persons}):null))})};k.prototype.getDescendancy=function(c,e,l){var h=this;return h.helpers.chainHttpPromises(h.plumbing.getUrl("descendancy-query"),function(k){return h.plumbing.get(k,b.extend({person:c},e),{},l,b.compose(b.objectExtender(d("descendancyNumber")),function(a){b.forEach(a.persons,function(a,b,c){c[b]=h.createPerson(a)});return a},b.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},
function(b){return a(b).persons})))})}},{"./../FamilySearch":1,"./../utils":48}],38:[function(e,k,h){k=e("../FamilySearch");var d=e("../utils"),c=d.maybe,b={getPerson:function(a){return d.find(this.persons,{id:a})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var a=this.getPrimaryId();return d.filter(this.childAndParentsRelationships,function(b){return c(b.child).resourceId===a})},getSpouseRelationships:function(){return d.filter(this.relationships,
function(a){return"http://gedcomx.org/Couple"===a.type})},getSpouseRelationship:function(a){var b=this.getPrimaryId();return d.find(this.relationships,function(c){return"http://gedcomx.org/Couple"===c.type&&(b===c.$getHusbandId()?c.$getWifeId():c.$getHusbandId())===a})},getChildRelationships:function(){var a=this.getPrimaryId();return d.filter(this.childAndParentsRelationships,function(b){return c(b.father).resourceId===a||c(b.mother).resourceId===a})},getChildRelationshipsOf:function(a){var b=this.getPrimaryId();
return d.filter(this.childAndParentsRelationships,function(d){return(c(d.father).resourceId===b||c(d.mother).resourceId===b)&&(c(d.father).resourceId==a||c(d.mother).resourceId==a)})},getFatherIds:function(){return d.uniq(d.map(d.filter(this.getParentRelationships(),function(a){return!!a.$getFatherId()}),function(a){return a.$getFatherId()},this))},getFathers:function(){return d.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return d.uniq(d.map(d.filter(this.getParentRelationships(),
function(a){return!!a.$getMotherId()}),function(a){return a.$getMotherId()},this))},getMothers:function(){return d.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return d.uniq(d.map(d.filter(this.getSpouseRelationships(),function(a){return a.$getHusbandId()&&a.$getWifeId()}),function(a){return this.getPrimaryId()===a.$getHusbandId()?a.$getWifeId():a.$getHusbandId()},this))},getSpouses:function(){return d.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return d.uniq(d.map(this.getChildRelationships(),
function(a){return a.$getChildId()},this))},getChildren:function(){return d.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(a){return d.uniq(d.map(this.getChildRelationshipsOf(a),function(a){return a.$getChildId()},this))},getChildrenOf:function(a){return d.map(this.getChildIdsOf(a),this.getPerson,this)}};k.prototype.getPerson=function(a,b,c){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-template",a,{pid:a}),function(a){return e.plumbing.get(a,b,{},c,
d.compose(d.objectExtender({getPerson:function(){return this.persons[0]}}),function(a){d.forEach(a.persons,function(a,b,c){c[b]=e.createPerson(a)});return a},function(a,b){a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");return!!a&&0>a.indexOf("POST")};return a}))})};k.prototype.getMultiPerson=function(a,b,c){var e={},h=this;d.forEach(a,function(a){e[a]=h.getPerson(a,b,c)});return h.helpers.promiseAll(e)};k.prototype._personsAndRelationshipsMapper=function(){var a=this;return d.compose(d.objectExtender({getCoupleRelationships:function(){return d.filter(c(this).relationships,
{type:"http://gedcomx.org/Couple"})||[]},getChildAndParentsRelationships:function(){return c(this).childAndParentsRelationships||[]},getPerson:function(a){return d.find(this.persons,{id:a})}}),function(b){d.forEach(b.persons,function(b,c,d){d[c]=a.createPerson(b)});d.forEach(b.relationships,function(b,c,d){d[c]=a.createCouple(b)});d.forEach(b.childAndParentsRelationships,function(b,c,d){d[c]=a.createChildAndParents(b)});return b})};k.prototype.getPersonWithRelationships=function(a,c,e){var l=this;
return l.helpers.chainHttpPromises(l.plumbing.getUrl("person-with-relationships-query"),function(h){return l.plumbing.get(h,d.extend({person:a},c),{},e,d.compose(d.objectExtender({getPrimaryId:function(){return a}}),l._personsAndRelationshipsMapper(),d.objectExtender(b),function(a,b){a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");return!!a&&0>a.indexOf("POST")};return a}))})};k.prototype.getSpouses=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("spouses-template",
a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})};k.prototype.getParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("parents-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})};k.prototype.getChildren=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("children-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})};
k.prototype.deletePerson=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-template",a,{pid:a}),function(e){return d.plumbing.del(e,b?{"X-Reason":b}:{},c,function(){return a})})};k.prototype.getPreferredSpouse=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.getCurrentUser(),function(b){b=b.getUser().treeUserId;return d.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:b,pid:a})},function(a){var e=d.plumbing.get(a+".json",b,{"X-Expect-Override":"200-ok"},
c);return e.then(function(){if(200===e.getStatusCode()){var a=e.getResponseHeader("Location");return 0<=a.indexOf("child-and-parents-relationships")?null:d.helpers.getLastUrlSegment(a)}})})};k.prototype.setPreferredSpouse=function(a,b,c){var e,h=[],k=this;null===b?h.push(k.getChildren(a),function(a){a=d.find(a.getChildAndParentsRelationships(),function(a){return!a.$getFatherId()||!a.$getMotherId()});return k.plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:a.id})}):h.push(k.plumbing.getUrl("couple-relationship-template",
b,{crid:b}));h.push(function(a){e=a;return k.getCurrentUser()},function(b){b=b.getUser().treeUserId;return k.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:b,pid:a})},function(b){return k.plumbing.put(b,null,{Location:e},c,function(){return a})});return k.helpers.chainHttpPromises.apply(k.helpers,h)};k.prototype.deletePreferredSpouse=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(b){b=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-spouse-relationship-template",
null,{uid:b,pid:a})},function(d){return c.plumbing.del(d,{},b,function(){return a})})};k.prototype.getPreferredParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.getCurrentUser(),function(b){b=b.getUser().treeUserId;return d.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:b,pid:a})},function(a){var e=d.plumbing.get(a+".json",b,{Accept:"application/x-fs-v1+json","X-Expect-Override":"200-ok"},c);return e.then(function(){return 200===e.getStatusCode()?d.helpers.getLastUrlSegment(e.getResponseHeader("Location")):
void 0})})};k.prototype.setPreferredParents=function(a,b,c){var d,e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-template",b,{caprid:b}),function(a){d=a;return e.getCurrentUser()},function(b){b=b.getUser().treeUserId;return e.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:b,pid:a})},function(b){return e.plumbing.put(b,null,{Location:d},c,function(){return a})})};k.prototype.deletePreferredParents=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),
function(b){b=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:b,pid:a})},function(d){return c.plumbing.del(d,{},b,function(){return a})})}},{"../FamilySearch":1,"../utils":48}],39:[function(e,k,h){e("./../FamilySearch").prototype.getRedirectUrl=function(d){return this.helpers.appendAccessToken(this.helpers.appendQueryParameters(this.helpers.getAPIServerUrl("/platform/redirect"),d))}},{"./../FamilySearch":1}],40:[function(e,k,h){function d(a){return c.map(c.filter(c.keys(a),
function(a){return!b[a]}),function(b){var d;d=a[b];c.isString(d)&&(d=d.replace(/[:"]/g,"").trim(),d=0<=d.indexOf(" ")?'"'+d+'"':d);return b+":"+d}).join(" ")}k=e("./../FamilySearch");var c=e("./../utils"),b={start:!0,count:!0,context:!0},a={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results||0},getIndex:function(){return this.index||0}};k.prototype._getSearchMatchResponseMapper=function(){var b=this;return c.compose(c.objectExtender(a),function(a){c.forEach(a.entries,
function(a,c,d){d[c]=b.createSearchResult(a)});return a})};k.prototype.getPersonSearch=function(a,b){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-search"),function(h){return e.plumbing.get(h,c.removeEmptyProperties({q:d(c.removeEmptyProperties(c.extend({},a))),start:a.start,count:a.count,context:a.context}),{Accept:"application/x-gedcomx-atom+json"},b,c.compose(e._getSearchMatchResponseMapper(),function(a,b){a.getContext=function(){return b.getResponseHeader("X-FS-Page-Context")};
return a}))})};k.prototype.getPersonMatches=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-matches-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._getSearchMatchResponseMapper())})};k.prototype.getPersonMatchesQuery=function(a,b){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-matches-query"),function(h){try{return e.plumbing.get(h,c.removeEmptyProperties({q:d(c.removeEmptyProperties(c.extend({},
a))),start:a.start,count:a.count}),{Accept:"application/x-gedcomx-atom+json"},b,e._getSearchMatchResponseMapper())}catch(k){console.log(k.stack)}})}},{"./../FamilySearch":1,"./../utils":48}],41:[function(e,k,h){var d=e("./../FamilySearch"),c=e("./../utils"),b=c.maybe;d.prototype.getCollectionsForUser=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-collections-for-user-template",a,{uid:a}),function(a){return e.plumbing.get(a,{},{Accept:"application/x-fs-v1+json"},
d,c.compose(c.objectExtender({getCollections:function(){return this.collections||[]}}),function(a){c.forEach(a.collections,function(a,b,c){c[b]=e.createCollection(a)});return a}))})};d.prototype.getCollection=function(a,d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(a){return l.plumbing.get(a,d,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getCollection:function(){return b(this.collections)[0]}}),function(a){c.forEach(a.collections,
function(a,b,c){c[b]=l.createCollection(a)});return a}))})};d.prototype.getCollectionSourceDescriptions=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(a){return e.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},d,c.compose(c.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){c.forEach(a.sourceDescriptions,function(a,b,c){c[b]=e.createSourceDescription(a)});
return a}))})};d.prototype.getCollectionSourceDescriptionsForUser=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-collections-source-descriptions-for-user-template",a,{uid:a}),function(a){return e.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},d,c.compose(c.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){c.forEach(a.sourceDescriptions,function(a,b,c){c[b]=e.createSourceDescription(a)});return a}))})};d.prototype.moveSourceDescriptionsToCollection=
function(a,b,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(h){var k=c.map(b,function(a){return{id:a instanceof d.SourceDescription?a.id:a}});return l.plumbing.post(h,{sourceDescriptions:k},{},e,function(){return a})})};d.prototype.removeSourceDescriptionsFromCollections=function(a,b){var e=this;return e.helpers.chainHttpPromises(e.getCurrentUser(),function(a){a=a.getUser().treeUserId;return e.plumbing.getUrl("user-collections-source-descriptions-for-user-template",
null,{uid:a})},function(l){var h=c.map(a,function(a){return a instanceof d.SourceDescription?a.id:a});return e.plumbing.del(e.helpers.appendQueryParameters(l,{id:h}),{},b,function(){return a})})};d.prototype.deleteCollection=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(d){return c.plumbing.del(d,{},b,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],42:[function(e,k,h){var d=e("./../FamilySearch"),c=
e("./../utils"),b=c.maybe;d.prototype.getSourceDescription=function(a,e,f){a instanceof d.SourceRef&&(a=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId);var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("source-description-template",a,{sdid:a}),function(a){return l.plumbing.get(a,e,{},f,c.compose(c.objectExtender({getSourceDescription:function(){return b(this.sourceDescriptions)[0]}}),function(a){for(var c=b(b(a).sourceDescriptions),d=0;d<c.length;d++)c[d]=l.createSourceDescription(c[d]);
return a}))})};d.prototype.getMultiSourceDescription=function(a,b,e){var l={},h=this;c.forEach(a,function(a){var c;a instanceof d.SourceRef?(c=a.$sourceDescriptionId||a.$getSourceDescriptionUrl(),a=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId):c=a;l[c]=h.getSourceDescription(a,b,e)});return h.helpers.promiseAll(l)};d.prototype.getSourceRefsQuery=function(a,d,e){var l=this;return l.helpers.chainHttpPromises(l.plumbing.getUrl("source-references-query"),function(h){h=l.helpers.appendQueryParameters(h,
{source:a});return l.plumbing.get(h,d,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getPersonSourceRefs:function(){return c.flatMap(b(this.persons),function(a){return a.sources})}}),c.objectExtender({getCoupleSourceRefs:function(){return c.flatMap(b(this.relationships),function(a){return a.sources})}}),c.objectExtender({getChildAndParentsSourceRefs:function(){return c.flatMap(b(this.childAndParentsRelationships),function(a){return a.sources})}}),function(a){c.forEach(["persons",
"relationships","childAndParentsRelationships"],function(d){b(a)[d]=c.map(b(a)[d],function(a){a.sources=c.map(a.sources,function(a){return l.createSourceRef(a)});return a})});return a},c.objectExtender(function(d,e){return{$personId:c.find(b(d).persons,function(a){return!!c.find(b(a).sources,{id:e.id})}).id,$sourceDescriptionId:a}},function(a){return c.flatMap(b(a).persons,function(a){return a.sources})}),c.objectExtender(function(d,e){return{$coupleId:c.find(b(d).relationships,function(a){return!!c.find(b(a).sources,
{id:e.id})}).id,$sourceDescriptionId:a}},function(a){return c.flatMap(b(a).relationships,function(a){return a.sources})}),c.objectExtender(function(d,e){return{$childAndParentsId:c.find(b(d).childAndParentsRelationships,function(a){return!!c.find(b(a).sources,{id:e.id})}).id,$sourceDescriptionId:a}},function(a){return c.flatMap(b(a).childAndParentsRelationships,function(a){return a.sources})})))})};d.prototype._getSourcesResponseMapper=function(a,d,e){var l=this;return c.compose(c.objectExtender(c.removeEmptyProperties({getSourceRefs:function(){return b(b(this[a])[0]).sources||
[]},getSourceDescriptions:e?function(){return this.sourceDescriptions||[]}:null,getSourceDescription:e?function(a){return c.find(this.sourceDescriptions,{id:a})}:null})),function(d){c.forEach(b(b(b(d)[a])[0]).sources,function(a,b,c){c[b]=l.createSourceRef(a)});return d},c.objectExtender(function(c,e){var f;l.helpers.isAbsoluteUrl(e.description)?f={$sourceDescriptionId:l.helpers.getLastUrlSegment(e.description)}:(f="#"===e.description.charAt(0)?e.description.substr(1):e.description,f={$sourceDescriptionId:f,
description:l.helpers.getUrlFromDiscoveryResource(l.settings.discoveryResource,"source-description-template",{sdid:f})});f[d]=b(b(b(c)[a])[0]).id;return f},function(c){return b(b(b(c)[a])[0]).sources}),e?function(a){c.forEach(a.sourceDescriptions,function(a,b,c){c[b]=l.createSourceDescription(a)});return a}:null)};d.prototype.getPersonSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-source-references-template",a,{pid:a}),function(a){return d.plumbing.get(a,
b,{},c,d._getSourcesResponseMapper("persons","$personId",!1))})};d.prototype.getPersonSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-sources-query-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("persons","$personId",!0))})};d.prototype.getCoupleSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-source-references-template",a,{crid:a}),function(a){return d.plumbing.get(a,
b,{},c,d._getSourcesResponseMapper("relationships","$coupleId",!1))})};d.prototype.getCoupleSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-sources-query-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("relationships","$coupleId",!0))})};d.prototype.getChildAndParentsSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-source-references-template",
a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,d._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",!1))})};d.prototype.getChildAndParentsSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-sources-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,d._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",
!0))})};d.prototype.deleteSourceDescription=function(a,b,d){var e=this,h=e.getSourceRefsQuery(a,{},d).then(function(k){k=c.union(c.map(k.getPersonSourceRefs(),function(a){return e.deletePersonSourceRef(a.$getSourceRefUrl(),null,b,d)}),c.map(k.getCoupleSourceRefs(),function(a){return e.deleteCoupleSourceRef(a.$getSourceRefUrl(),null,b,d)}),c.map(k.getChildAndParentsSourceRefs(),function(a){return e.deleteChildAndParentsSourceRef(a.$getSourceRefUrl(),null,b,d)}));return e.helpers.promiseAll(k).then(function(){var c=
e.helpers.chainHttpPromises(e.plumbing.getUrl("source-description-template",null,{sdid:a}),function(c){return e.plumbing.del(c,b?{"X-Reason":b}:{},d,function(){return a})});e.helpers.extendHttpPromise(h,c);return c})});return h};d.prototype.deletePersonSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-source-reference-template",a,{pid:a,srid:b}),function(b){return e.plumbing.del(b,c?{"X-Reason":c}:{},d,function(){return a})})};d.prototype.deleteCoupleSourceRef=
function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-source-reference-template",a,{crid:a,srid:b}),function(b){return e.plumbing.del(b,c?{"X-Reason":c}:{},d,function(){return a})})};d.prototype.deleteChildAndParentsSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-source-reference-template",a,{caprid:a,srid:b}),function(b){var g={"Content-Type":"application/x-fs-v1+json"};c&&
(g["X-Reason"]=c);return e.plumbing.del(b,g,d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":48}],43:[function(e,k,h){k=e("../FamilySearch");var d=e("../utils"),c=d.maybe,b={getRelationship:function(){return c(this.relationships)[0]},getPerson:function(a){return d.find(this.persons,{id:a})}};k.prototype.getCouple=function(a,c,e){var h=this;return h.helpers.chainHttpPromises(h.plumbing.getUrl("couple-relationship-template",a,{crid:a}),function(a){return h.plumbing.get(a,c,{},e,d.compose(d.objectExtender(b),
function(a){d.forEach(a.persons,function(a,b,c){c[b]=h.createPerson(a)});d.forEach(a.relationships,function(a,b,c){c[b]=h.createCouple(a)});return a}))})};k.prototype.deleteCouple=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-template",a,{crid:a}),function(e){return d.plumbing.del(e,b?{"X-Reason":b}:{},c,function(){return a})})}},{"../FamilySearch":1,"../utils":48}],44:[function(e,k,h){k=e("./../FamilySearch");var d=e("./../utils"),c=d.maybe;
k.prototype.getCurrentUser=function(b,a){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("current-user"),function(f){return e.plumbing.get(f,b,{},a,d.compose(d.objectExtender({getUser:function(){return c(this.users)[0]}}),function(a){d.forEach(a.users,function(a,b,c){c[b]=e.createUser(a)});return a}))})};k.prototype.getAgent=function(b,a,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("agent-template",b,{uid:b}),function(b){return f.plumbing.get(b,a,{},e,d.compose(d.objectExtender({getAgent:function(){return c(this.agents)[0]}}),
function(a){d.forEach(a.agents,function(a,b,c){c[b]=f.createAgent(a)});return a}))})};k.prototype.getMultiAgent=function(b,a,c){var e=this,h={};d.forEach(b,function(b){h[b]=e.getAgent(b,a,c)});return e.helpers.promiseAll(h)}},{"./../FamilySearch":1,"./../utils":48}],45:[function(e,k,h){var d=e("./utils");h={httpWrapper:function(c,b){return function(a,e,f,h,k){k=d.extend({url:e,method:a,json:!0,body:h},k);k.headers=d.extend({},f,k.headers);"multipart/form-data"===k.headers["Content-Type"]&&(k.formData=
k.body,delete k.body,delete k.headers["Content-Type"],delete k.json);var r=b.settings.deferredWrapper();a=r.promise;var q=null,u={};c(k,function(a,b,c){b&&(b.headers&&(u=b.headers),q=b.statusCode);a?r.reject(a):400<=q?(a=c.errors?c.errors[0]:Error("server responded with a "+q),r.reject(a)):r.resolve(c)});a.getStatusCode=function(){return q};a.getResponseHeader=function(a){return u[a]};a.getAllResponseHeaders=function(){return u};a.getRequest=function(){return k};return a}},deferredWrapper:function(c){return function(){var b=
c();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}}};k.exports=h},{"./utils":48}],46:[function(e,k,h){function d(b){var a="",c,e,h,k,r,q,u;for(c in b)if(b.hasOwnProperty(c))if(e=b[c],e instanceof Array)for(u=0;u<e.length;++u)r=e[u],h=c+"["+u+"]",q={},q[h]=r,a+=d(q)+"&";else if(e instanceof Object)for(k in e)e.hasOwnProperty(k)&&(r=e[k],h=c+"["+k+"]",q={},q[h]=r,a+=d(q)+"&");else void 0!==e&&null!==e&&(a+=encodeURIComponent(c)+"="+encodeURIComponent(e)+"&");return a.length?a.substr(0,
a.length-1):a}var c=e("./utils");e=function(b){this.client=b;this.helpers=b.helpers;this.settings=b.settings;this.totalProcessingTime=0};e.prototype.getTotalProcessingTime=function(){return this.totalProcessingTime};e.prototype.setTotalProcessingTime=function(b){this.totalProcessingTime=b};e.prototype.getUrl=function(b,a,c){var d=this;return this.settings.discoveryPromise.then(function(e){var h="";return h=d.helpers.isAbsoluteUrl(a)?a:d.helpers.getUrlFromDiscoveryResource(e,b,c)})};e.prototype.get=
function(b,a,d,e,h){return this.http("GET",this.helpers.appendQueryParameters(b,a),c.extend({Accept:"application/x-gedcomx-v1+json"},d),null,e,h)};e.prototype.post=function(b,a,d,e,h){return this.http("POST",b,c.extend({"Content-Type":"application/x-gedcomx-v1+json"},d),a,e,h)};e.prototype.put=function(b,a,d,e,h){return this.http("PUT",b,c.extend({"Content-Type":"application/x-gedcomx-v1+json"},d),a,e,h)};e.prototype.del=function(b,a,d,e){return this.http("DELETE",b,c.extend({"Content-Type":"application/x-gedcomx-v1+json"},
a),null,d,e)};e.prototype.transformData=function(b,a){if(b&&c.isObject(b)&&"[object FormData]"!==String(b)){b=c.clonePartial(b,function(a){return!(c.isString(a)&&("$"===a.charAt(0)||"_"===a.charAt(0)))});if("application/x-www-form-urlencoded"===a)return d(b);if(a&&-1!==a.indexOf("json"))return JSON.stringify(b)}return b};e.prototype.http=function(b,a,c,d,e,h,k){var q=this.settings.deferredWrapper(),u=q.promise,p=this,t=this.helpers.getAPIServerUrl(a);c=c||{};(this.settings.accessToken||!this.settings.autoSignin||
this.helpers.isOAuthServerUrl(t)||a===this.settings.discoveryUrl?this.helpers.refPromise(this.settings.accessToken):this.settings.getAccessToken()).then(function(){var v=p.helpers.isAuthoritiesServerUrl(t)?"sessionId":"access_token";if(p.settings.accessToken&&-1===t.indexOf(v+"=")){var x={};x[v]=p.settings.accessToken;t=p.helpers.appendQueryParameters(t,x)}null==k&&(k=p.settings.maxHttpRequestRetries);var w=p.settings.httpWrapper(b,t,c,p.transformData(d,c["Content-Type"]),e||{});p.helpers.extendHttpPromise(u,
w);w.then(function(a){"GET"===b&&204===w.getStatusCode()&&(a={});p.helpers.refreshAccessToken();var c=w.getResponseHeader("X-PROCESSING-TIME");c&&(p.totalProcessingTime+=parseInt(c,10));h&&(a=h(a,w));q.resolve(a)},function(){var t=w.getStatusCode();p.helpers.log("http failure",t,k,w.getAllResponseHeaders());401===t&&p.helpers.eraseAccessToken();"GET"===b&&500<=t&&0<k||429===t?(t=(t=w.getResponseHeader("Retry-After"))?parseInt(t,10):p.settings.defaultThrottleRetryAfter,p.settings.setTimeout(function(){w=
p.http(b,a,c,d,e,h,k-1);p.helpers.extendHttpPromise(u,w);w.then(function(a){q.resolve(a)},function(){q.reject.apply(q,arguments)})},t)):q.reject.apply(q,arguments)})},function(){q.reject.apply(q,arguments)});return u};k.exports=e},{"./utils":48}],47:[function(e,k,h){var d=e("./FamilySearch"),c=e("./utils"),b=c.maybe;h={setMember:function(a,b){this[a]||(this[a]={});b instanceof d.Person?(this[a].resource=b.$getPersonUrl(),delete this[a].resourceId):this.$helpers.isAbsoluteUrl(b)?(this[a].resource=
b,delete this[a].resourceId):c.isString(b)?(this[a].resourceId=b,delete this[a].resource):this[a]=b},deleteMember:function(a,b){this.$deletedMembers||(this.$deletedMembers={});this.$deletedMembers[a]=b;delete this[a]},setFacts:function(a,b,d){c.isArray(this[a])&&c.forEach(this[a],function(b){h.deleteFact.call(this,a,b,d)},this);this[a]=[];c.forEach(b,function(b){h.addFact.call(this,a,b)},this)},addFact:function(a,b){c.isArray(this[a])||(this[a]=[]);b instanceof d.Fact||(b=this.$client.createFact(b));
this[a].push(b)},deleteFact:function(a,e,f){e instanceof d.Fact||(e=c.find(this[a],{id:e}));var h=c.indexOf(this[a],e);if(0<=h){if(e=this.$helpers.removeAccessToken(b(b(b(e).links).conclusion).href))this.$deletedFacts||(this.$deletedFacts={}),this.$deletedFacts[e]=f;this[a].splice(h,1)}}};k.exports=h},{"./FamilySearch":1,"./utils":48}],48:[function(e,k,h){function d(b,a){for(var c in b)if(b.hasOwnProperty(c)&&a[c]!==b[c])return!1;return!0}h=k.exports;Object.create||(Object.create=function(){function b(){}
return function(a){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");b.prototype=a;return new b}}());"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});h.isArray=function(b){return Array.isArray?Array.isArray(b):"[object Array]"==Object.prototype.toString.call(b)};h.isString=function(b){return"[object String]"==Object.prototype.toString.call(b)};
h.isFunction=function(b){return"function"!==typeof/./?"function"===typeof b:"[object Function]"==Object.prototype.toString.call(b)};h.isObject=function(b){return b===Object(b)};h.isUndefined=function(b){return void 0===b};var c=h.forEach=function(b,a,c){if(null!=b)if(Array.prototype.forEach&&b.forEach===Array.prototype.forEach)b.forEach(a,c);else if(b.length===+b.length)for(var d=0,e=b.length;d<e&&a.call(c,b[d],d,b)!=={};d++);else for(d in b)if(b.hasOwnProperty(d)&&a.call(c,b[d],d,b)==={})break};
h.removeEmptyProperties=function(b){c(b,function(a,c){null!=a&&""!==a||delete b[c]});return b};h.keys=Object.keys||function(b){if(b!==Object(b))throw new TypeError("Invalid object");var a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(c);return a};h.filter=function(b,a,e){var f=[],k=h.isFunction(a);c(b,function(b){(k?a.call(e,b):d(a,b))&&f.push(b)});return f};h.map=function(b,a,d){var e=[];c(b,function(b,c,h){e.push(a.call(d,b,c,h))});return e};h.contains=function(b,a){if(null==b)return!1;if(b.indexOf&&
b.indexOf===Array.prototype.indexOf)return-1!==b.indexOf(a);var d=!1;c(b,function(b){b===a&&(d=!0)});return d};h.indexOf=function(b,a){if(Array.prototype.indexOf===b.indexOf)return b.indexOf(a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c;return-1};h.uniq=function(b){var a=[];c(b,function(b){h.contains(a,b)||a.push(b)});return a};h.find=function(b,a,c){var e,k=h.isFunction(a);if(b)for(var n=0,r=b.length;n<r;n++){var q=b[n];if(k?a.call(c,q):d(a,q)){e=q;break}}return e};h.findIndex=function(b,
a,c){var e=-1,k=h.isFunction(a);if(b)for(var n=0,r=b.length;n<r;n++){var q=b[n];if(k?a.call(c,q):d(a,q)){e=n;break}}return e};h.compose=function(){var b=arguments;return function(){for(var a=arguments,c=b.length-1;0<=c;c--)b[c]&&(a=[b[c].apply(this,a)]);return a[0]}};h.flatten=function(b){var a=[];c(b,function(b){h.isArray(b)&&Array.prototype.push.apply(a,b)});return a};h.flatMap=h.compose(h.flatten,h.map);h.union=function(){return h.uniq(h.flatten(arguments))};h.findOrFirst=function(b,a){if(!h.isUndefined(b)){var c=
h.find(b,a);return h.isUndefined(c)?b[0]:c}};h.extend=function(b){b=b||{};c(Array.prototype.slice.call(arguments,1),function(a){a&&c(a,function(a,c){b[c]=a})});return b};h.partialRight=function(b){var a=Array.prototype.slice.call(arguments,1);return function(){return b.apply(this,Array.prototype.slice.call(arguments).concat(a))}};h.partial=function(b){var a=Array.prototype.slice.call(arguments,1);return function(){return b.apply(this,a.concat(Array.prototype.slice.call(arguments)))}};h.maybe=function(b){return null!=
b?b:{}};h.clonePartial=function(b,a){var c;if(null==b||"object"!==typeof b)return b;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){c=[];for(var d=0,e=b.length;d<e;d++)a&&!a(d)||c.push(h.clonePartial(b[d],a));return c}if(b instanceof Object){c=Object.create(Object.getPrototypeOf(b));for(d in b)!b.hasOwnProperty(d)||a&&!a(d)||(c[d]=h.clonePartial(b[d],a));return c}throw Error("Unable to copy obj");};h.objectExtender=function(b,a){return function(d){d&&(a?c(a(d),
function(a){h.extend(a,h.isFunction(b)?b(d,a):b)}):h.extend(d,h.isFunction(b)?b(d,d):b));return d}};h.appFieldRejector=function(b){return!(h.isString(b)&&"_"===b.charAt(0))};h.deletePropertiesPartial=function(b,a){for(var c in b)!b.hasOwnProperty(c)||a&&!a(c)||delete b[c]};h.wrapFunctions=function(b,a,d){c(d,function(c){b[c]=function(){return a[c].apply(a,arguments)}});return b}},{}]},{},[1])(1)});var View;
(function(m){var e=function(){function e(h,d,c){this.presenter=h;this.viewHeight=d;this.viewWidth=c;this.outOfMazeSpaceString="OutOfMaze";this.unvisitedSpaceString="MazeMist";h=document.getElementById(this.unvisitedSpaceString);h=window.getComputedStyle(h);this.spaceHeight=parseInt(h.height.replace(/\D/g,""));this.spaceWidth=parseInt(h.width.replace(/\D/g,""));this.gender="f"}e.prototype.draw=function(e){var d=document.getElementById("viewScreen");d.height=this.viewHeight*this.spaceHeight;d.width=
this.viewWidth*this.spaceWidth;for(var d=d.getContext("2d"),c=e.getCurrentSpace(),b=0;b<this.viewHeight;b++)for(var a=0;a<this.viewWidth;a++){var g=c.getX()+Math.ceil(b-this.viewHeight/2),f=c.getY()+Math.ceil(a-this.viewWidth/2),g=e.getSpace(g,f),k;null!=g?g.seen()?g.getSpaceObject().objectIsOfType("IDoor")?(k=document.getElementById(g.getSpaceObject().getSpaceType()),g=k.width,f=k.height):(k=document.getElementById(g.getSpaceObject().getSpaceType()),g=this.spaceWidth,f=this.spaceHeight):(k=document.getElementById(this.unvisitedSpaceString),
g=this.spaceWidth,f=this.spaceHeight):(k=document.getElementById(this.outOfMazeSpaceString),g=this.spaceWidth,f=this.spaceHeight);var n=window.getComputedStyle(k),m=n.getPropertyValue("left"),n=n.getPropertyValue("top"),m=parseInt(m.replace(/\D/g,""))*this.spaceWidth,n=parseInt(n.replace(/\D/g,""))*this.spaceHeight;d.drawImage(k,m,n,g,f,a*this.spaceWidth,b*this.spaceHeight,this.spaceWidth,this.spaceHeight)}e=document.getElementById(this.gender+this.presenter.getLastMove().getMoveString());n=window.getComputedStyle(e);
m=n.getPropertyValue("left");n=n.getPropertyValue("top");m=parseInt(m.replace(/\D/g,""))*this.spaceWidth;n=parseInt(n.replace(/\D/g,""))*this.spaceHeight;d.drawImage(e,m,n,this.spaceWidth,this.spaceHeight,this.spaceWidth*Math.floor(this.viewWidth/2),this.spaceHeight*Math.floor(this.viewHeight/2),this.spaceWidth,this.spaceHeight)};e.prototype.setGender=function(e){this.gender=e};return e}();m.AncestorMapView=e})(View||(View={}));(function(m){var e=function(){function e(h,d,c){this.presenter=h;this.viewHeight=d;this.viewWidth=c;this.blankSpaceString="OutOfMaze";this.unvisitedSpaceString="MazeMist";h=document.getElementById(this.unvisitedSpaceString);h=window.getComputedStyle(h);this.spaceHeight=parseInt(h.height.replace(/\D/g,""));this.spaceWidth=parseInt(h.width.replace(/\D/g,""))}e.prototype.draw=function(e){var d=document.getElementById("viewScreen");d.height=this.viewHeight*this.spaceHeight;d.width=this.viewWidth*this.spaceWidth;
for(var d=d.getContext("2d"),c=e.getCurrentSpace(),b=0;b<this.viewHeight;b++)for(var a=0;a<this.viewWidth;a++){var g=c.getX()+Math.ceil(b-this.viewHeight/2),f=c.getY()+Math.ceil(a-this.viewWidth/2),g=e.getSpace(g,f),g=null!=g?g.seen()?document.getElementById(g.getSpaceObject().getSpaceType()):document.getElementById(this.unvisitedSpaceString):document.getElementById(this.blankSpaceString),k=window.getComputedStyle(g),f=k.getPropertyValue("left"),k=k.getPropertyValue("top"),f=parseInt(f.replace(/\D/g,
""))*this.spaceWidth,k=parseInt(k.replace(/\D/g,""))*this.spaceHeight;d.drawImage(g,f,k,this.spaceWidth,this.spaceHeight,a*this.spaceWidth,b*this.spaceHeight,this.spaceWidth,this.spaceHeight)}c=document.getElementById(this.gender+this.presenter.getLastMove().getMoveString());k=window.getComputedStyle(c);f=k.getPropertyValue("left");k=k.getPropertyValue("top");f=parseInt(f.replace(/\D/g,""))*this.spaceWidth;k=parseInt(k.replace(/\D/g,""))*this.spaceHeight;d.drawImage(c,f,k,this.spaceWidth,this.spaceHeight,
this.spaceWidth*Math.floor(this.viewWidth/2),this.spaceHeight*Math.floor(this.viewHeight/2),this.spaceWidth,this.spaceHeight);document.getElementById("keyNumber").textContent=e.getPlayer().numberOfKeys().toString()};e.prototype.setGender=function(e){this.gender=e};return e}();m.MapView=e})(View||(View={}));var Presenter;
(function(m){var e=View.MapView,k=m.AbstractPresenter,h=function(){function d(c){c.registerObserver(this);this.presenter=new k(c,new e(this,15,15))}d.prototype.update=function(c){c.attemptedToGetInADoor();this.presenter.update(c)};d.prototype.getLastMove=function(){return this.presenter.getLastMove()};d.prototype.executeMove=function(c){this.presenter.executeMove(c)};d.prototype.isInPopup=function(){return!1};d.prototype.setGender=function(c){this.presenter.setGender(c)};return d}();m.StandardPresenter=
h})(Presenter||(Presenter={}));(function(m){var e=function(){function e(h,d){this.model=h;this.view=d;this.lastMove=null}e.prototype.getView=function(){return this.view};e.prototype.checkWon=function(e){e.won()&&alert("YOU WON!")};e.prototype.checkRedraw=function(e){this.view.draw(e)};e.prototype.outputToLog=function(e){document.getElementById("log").value+=e+"\n"};e.prototype.checkPickedUpKey=function(e){e.pickedUpNewKey()&&(this.outputToLog("Picked up a new key!!!!"),e.getPlayer().addKey(e.newKey()))};e.prototype.update=function(e){this.checkWon(e);
this.checkRedraw(e);this.checkPickedUpKey(e)};e.prototype.getLastMove=function(){return this.lastMove};e.prototype.executeMove=function(e){this.lastMove=e;this.model.canMovePlayer(e)?this.model.movePlayer(e):this.model.update()};e.prototype.setGender=function(e){this.view.setGender(e)};return e}();m.AbstractPresenter=e})(Presenter||(Presenter={}));(function(m){var e=View.AncestorMapView,k=m.AbstractPresenter,h=function(){function d(c,b){c.registerObserver(this);this.presenter=new k(c,new e(this,15,15));this.pickedUpKeys=[];this.goingThroughDoor=this.justEnteredName=!1;this.factory=b}d.prototype.getKey=function(c){return this.factory.createKey(this.factory.createKeyParams(c))};d.prototype.update=function(c){if(c.attemptedToGetInADoor())if(c.doorRequirement().playerFulfillsRequirement(c.getPlayer())){var b=document.getElementById("imagePopup");
b.style.visibility="hidden";b=document.getElementById("canvas-container");b.style.visibility="visible"}else if(this.justEnteredName)this.justEnteredName=!1,b=this.getKey(this.lastEnteredName),c.getPlayer().addKey(b);else{var b=document.getElementById("imagePopup"),a=c.doorRequirement().toString().replace(/ /g,""),a=document.getElementById(a);document.getElementById("ancestorPicture").setAttribute("src",a.getAttribute("src"));document.getElementById("doorAnswer").value="";b.style.visibility="visible";
b=document.getElementById("canvas-container");b.style.visibility="hidden";this.goingThroughDoor=!0;this.justEnteredName=!1}c.pickedUpNewKey()&&(this.presenter.outputToLog("The slip of paper says: "+c.newKey().toString()),this.pickedUpKeys.push(c.newKey()));this.presenter.checkWon(c);this.presenter.checkRedraw(c)};d.prototype.enterName=function(c){this.lastEnteredName=c;this.justEnteredName=!0;document.getElementById("imagePopup").style.visibility="hidden";document.getElementById("canvas-container").style.visibility=
"visible";this.goingThroughDoor=!1;this.executeMove(this.getLastMove())};d.prototype.leavePopup=function(){document.getElementById("imagePopup").style.visibility="hidden";document.getElementById("canvas-container").style.visibility="visible";this.goingThroughDoor=!1};d.prototype.getLastMove=function(){return this.presenter.getLastMove()};d.prototype.executeMove=function(c){this.goingThroughDoor||this.presenter.executeMove(c)};d.prototype.isInPopup=function(){return this.goingThroughDoor};d.prototype.setGender=
function(c){this.presenter.setGender(c)};return d}();m.AncestorPresenter=h})(Presenter||(Presenter={}));
